<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>C1 Application thorns</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- html,2,fn-in --> 
<meta name="src" content="UsersGuide.tex"> 
<meta name="date" content="2011-10-25 18:01:00"> 
<link rel="stylesheet" type="text/css" href="UsersGuide.css"> 
</head><body 
>
<!--l. 23--><div class="crosslinks"><p class="noindent">[<a 
href="UsersGuidech10.html" >next</a>] [<a 
href="#tailUsersGuidech9.html">tail</a>] [<a 
href="UsersGuidepa3.html#UsersGuidech9.html" >up</a>] </p></div>
<h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;C1</span><br /><a 
 id="x13-43000C1"></a>Application thorns</h2>
<!--l. 29--><p class="noindent" >This chapter goes into the nitty-gritty of writing a thorn. It introduces key concepts for thorns, then goes
on to give a brief outline of how to configure a thorn. There is then some detail about concepts
                                                                                       
                                                                                       
introduced by the configuration step, followed by discussion of code which you must put into your
files in order to use Cactus functionality, and details of utility functions you may use to gain extra
functionality.
<h3 class="sectionHead"><span class="titlemark">C1.1   </span> <a 
 id="x13-44000C1.1"></a>Thorn Concepts</h3>
<!--l. 45--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.1.1   </span> <a 
 id="x13-45000C1.1.1"></a>Thorns</h4>
<!--l. 47--><p class="noindent" >A thorn is the basic working module within Cactus. All user supplied code goes into thorns, which are, by and
large, independent of each other. Thorns communicate with each other via calls to the flesh API, plus, more
rarely, custom APIs of other thorns.
<!--l. 52--><p class="noindent" >The connection from a thorn to the flesh, or to other thorns, is specified in configuration files which are parsed
at compile time and used to generate glue code which encapsulates the external appearance of a
thorn.
<!--l. 56--><p class="noindent" >Thorn names must be (case independently) unique, must start with a letter, can only contain letters, numbers or
underscores, and must contain 27 characters or less. In addition, a thorn cannot have the name <span 
class="cmtt-10">doc</span>, this is
reserved for arrangement documentation. Arrangement names which start with a &#8216;<span 
class="cmtt-10">#</span>&#8217;, or finish with &#8216;<span 
class="cmtt-10">~</span>&#8217; or &#8216;<span 
class="cmtt-10">.bak</span>&#8217;
will be ignored.
<!--l. 66--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.1.2   </span> <a 
 id="x13-46000C1.1.2"></a>Arrangements</h4>
<!--l. 69--><p class="noindent" >Thorns are grouped into <span 
class="cmti-10">arrangements</span>. This is a logical grouping of thorns which is purely for organisational
purposes. For example, you might wish to keep all your initial data thorns in one arrangement, and all your
evolution thorns in another arrangement, or you may want to have separate arrangements for your
developments, private and shared thorns.
<!--l. 76--><p class="noindent" >The arrangements live in the <span 
class="cmtt-10">arrangements </span>directory of the main Cactus directory. Arrangement
names must be (case independently) unique, must start with a letter, and can only contain letters,
numbers or underscores. Arrangement names which start with a &#8216;<span 
class="cmtt-10">#</span>&#8217;, or finish with &#8216;<span 
class="cmtt-10">~</span>&#8217; or &#8216;<span 
class="cmtt-10">.bak</span>&#8217; will be
ignored.
<!--l. 84--><p class="noindent" >Inside an arrangement directory there are directories for each thorn belonging to the arrangement.
<!--l. 89--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.1.3   </span> <a 
 id="x13-47000C1.1.3"></a>Implementations</h4>
                                                                                       
                                                                                       
<!--l. 93--><p class="noindent" >One of the key concepts for thorns is the concept of the <span 
class="cmti-10">implementation</span>. Relationships among thorns are all
based upon relationships among the implementations they provide. In principle, it should be possible to swap
one thorn providing an implementation with another thorn providing that implementation, without affecting any
other thorn.
<!--l. 100--><p class="noindent" >An implementation defines a group of variables and parameters which are used to implement some functionality.
For example, the thorn <span 
class="cmtt-10">CactusPUGH/PUGH </span>provides the implementation <span 
class="cmtt-10">driver</span>. This implementation is
responsible for providing memory for grid variables and for communication. Another thorn can
also implement <span 
class="cmtt-10">driver</span>, and both thorns can be compiled in <span 
class="cmti-10">at the same time</span>. At runtime, the
user can decide which thorn providing <span 
class="cmtt-10">driver </span>is used. No other thorn should be affected by this
choice.
<!--l. 109--><p class="noindent" >When a thorn decides it needs access to a variable or a parameter provided by another thorn, it defines a
relationship between itself and the other thorn&#8217;s <span 
class="cmti-10">implementation</span>, not explicitly with the other <span 
class="cmti-10">thorn</span>. This allows
the transparent replacement, at compile or runtime, of one thorn with another thorn providing the same
functionality as seen by the other thorns.
<!--l. 119--><p class="noindent" >
<h3 class="sectionHead"><span class="titlemark">C1.2   </span> <a 
 id="x13-48000C1.2"></a>Anatomy of a Thorn</h3>
<!--l. 124--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.2.1   </span> <a 
 id="x13-49000C1.2.1"></a>Thorns</h4>
<!--l. 126--><p class="noindent" >A thorn consists of a subdirectory of an arrangement containing four administrative files:
<!--l. 129--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">interface.ccl</span>     </dt><dd 
class="list">
                  <!--l. 130--><p class="noindent" >the Cactus interface, which defines the grid functions, variables, etc. See Appendix
                  <a 
href="UsersGuidech12.html#x17-186000D2.2">D2.2<!--tex4ht:ref: sec:Appendix.interface --></a>.
                  </dd><dt class="list">
<span 
class="cmtt-10">param.ccl</span>         </dt><dd 
class="list">
                  <!--l. 132--><p class="noindent" >the parameters introduced by this thorn, and the parameters needed from other
                  thorns. See Appendix <a 
href="UsersGuidech12.html#x17-191000D2.3">D2.3<!--tex4ht:ref: sec:Appendix.param --></a>.
                  </dd><dt class="list">
<span 
class="cmtt-10">schedule.ccl</span>      </dt><dd 
class="list">
                  <!--l. 135--><p class="noindent" >scheduling information for routines called by the flesh. See Appendix <a 
href="UsersGuidech12.html#x17-194000D2.4">D2.4<!--tex4ht:ref: sec:Appendix.schedule --></a>.
                  </dd><dt class="list">
<span 
class="cmtt-10">configuration.ccl</span> </dt><dd 
class="list">
                  <!--l. 137--><p class="noindent" >configuration options for the thorn. See Appendix <a 
href="UsersGuidech12.html#x17-199000D2.5">D2.5<!--tex4ht:ref: sec:Appendix.configuration.ccl --></a>.</dd></dl>
                                                                                       
                                                                                       
<!--l. 141--><p class="noindent" >Thorns can also contain
     <ul class="itemize1">
     <li class="itemize">a subdirectory called <span 
class="cmtt-10">src</span>, which should hold source files and compilation instructions for the thorn
     </li>
     <li class="itemize">a subdirectory <span 
class="cmtt-10">src/include </span>for include files
     </li>
     <li class="itemize">a <span 
class="cmtt-10">README </span>containing a brief description of the thorn
     </li>
     <li class="itemize">a <span 
class="cmtt-10">doc </span>directory for documentation
     </li>
     <li class="itemize">a <span 
class="cmtt-10">par </span>directory for example parameter files
     </li>
     <li class="itemize">a <span 
class="cmtt-10">test </span>subdirectory may also be added, to hold the thorn&#8217;s test suite. See Section <a 
href="#x13-124000C1.8.5">C1.8.5<!--tex4ht:ref: sec:adding_test_suite --></a> for details.</li></ul>
<!--l. 155--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.2.2   </span> <a 
 id="x13-50000C1.2.2"></a>Creating a Thorn</h4>
<!--l. 158--><p class="noindent" >To simplify the creation of a thorn, a <span 
class="cmtt-10">make </span>target <span 
class="cmtt-10">gmake newthorn </span>has been provided. When this is
run:
<!--l. 161--><p class="noindent" >
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x13-50002x1"> You will be prompted for the name of the new thorn.
     </li>
     <li 
  class="enumerate" id="x13-50004x2"> You will be prompted for the name of the arrangement in which you would like to include your
     thorn. Either enter a new arrangement name or pick one from the list of available arrangements
     that are shown.</li></ol>
<!--l. 170--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.2.3   </span> <a 
 id="x13-51000C1.2.3"></a>Configuring your Thorn</h4>
<!--l. 172--><p class="noindent" >The interaction of a thorn with the flesh and other thorns is controlled by certain configuration
files.
<!--l. 175--><p class="noindent" >These are:
<!--l. 177--><p class="noindent" >
                                                                                       
                                                                                       
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">interface.ccl</span>     </dt><dd 
class="list">
                  <!--l. 179--><p class="noindent" >This  defines  the  <span 
class="cmti-10">implementation  </span>(Section&#x00A0;<a 
href="#x13-47000C1.1.3">C1.1.3<!--tex4ht:ref: sec:implementations --></a>)  the  thorn  provides,  and  the
                  variables the thorn needs, along with their visibility to other implementations.
                  </dd><dt class="list">
<span 
class="cmtt-10">param.ccl</span>         </dt><dd 
class="list">
                  <!--l. 184--><p class="noindent" >This defines the parameters that are used to control the thorn, along with their
                  visibility to other implementations.
                  </dd><dt class="list">
<span 
class="cmtt-10">schedule.ccl</span>      </dt><dd 
class="list">
                  <!--l. 188--><p class="noindent" >This defines which functions are called from the thorn and when they are called. It
                  also handles memory and communication assignment for grid variables.
                  </dd><dt class="list">
<span 
class="cmtt-10">configuration.ccl</span> </dt><dd 
class="list">
                  <!--l. 192--><p class="noindent" >This file is optional for a thorn. If it exists, it contains extra configuration options
                  of this thorn.
                  </dd></dl>
<!--l. 198--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-52000C1.2.3"></a>General Syntax of CCL Files</h5>
<!--l. 200--><p class="noindent" ><span 
class="cmti-10">Cactus Configuration Language </span>(CCL) files are simple text files used to define configuration information for
a thorn. CCL files are case independent, and may contain comments introduced by the hash &#8216;<span 
class="cmtt-10">#</span>&#8217;
character, which indicates that the rest of the line is a comment. If the last non-blank character of a
line in a CCL file is a backslash &#8216;<span 
class="cmsy-10">\</span>&#8217;, the following line is treated as a continuation of the current
line.
<!--l. 208--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-53000C1.2.3"></a>The <span 
class="cmtt-10">interface.ccl </span>File</h5>
<!--l. 211--><p class="noindent" >The <span 
class="cmtt-10">interface.ccl </span>file is used to declare
     <ul class="itemize1">
     <li class="itemize">the implementation provided by the thorn
     </li>
     <li class="itemize">the variables provided by the thorn
     </li>
     <li class="itemize">the include files provided by the thorn
                                                                                       
                                                                                       
     </li>
     <li class="itemize">the functions provided by the thorn (in development)</li></ul>
<!--l. 221--><p class="noindent" >The implementation is declared by a single line at the top of the file <div class="alltt">
<!--l. 222--><p class="noindent" ><div class="obeylines-v">
<span 
class="cmtt-10">implements:</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">name</span><span 
class="cmtt-10">&#x003E;</span>
</div>
</div> Where <span 
class="cmtt-10">&#x003C;</span><span 
class="cmsltt-10">name</span><span 
class="cmtt-10">&#x003E; </span>can be any combination of alphanumeric characters and underscores, and is case
independent.
<!--l. 228--><p class="noindent" >There are three different access levels available for variables
<!--l. 230--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">Public</span>            </dt><dd 
class="list">
                  <!--l. 231--><p class="noindent" >Can be &#8216;inherited&#8217; by other implementations (see below).
                  </dd><dt class="list">
<span 
class="cmtt-10">Protected</span>         </dt><dd 
class="list">
                  <!--l. 233--><p class="noindent" >Can be shared with other implementations which declare themselves to be friends
                  of this one (see below).
                  </dd><dt class="list">
<span 
class="cmtt-10">Private</span>           </dt><dd 
class="list">
                  <!--l. 236--><p class="noindent" >Can only be seen by this thorn.</dd></dl>
<!--l. 240--><p class="noindent" >Corresponding to the first two access levels there are two relationship statements that can be used to get
variables (actually groups of variables, see below) from other implementations.
<!--l. 244--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">Inherits: &#x003C;</span><span 
class="cmsltt-10">name</span><span 
class="cmtt-10">&#x003E;</span>  </dt><dd 
class="list">
                  <!--l. 245--><p class="noindent" >This gets all <span 
class="cmtt-10">Public </span>variables from implementation <span 
class="cmtt-10">&#x003C;</span><span 
class="cmsltt-10">name</span><span 
class="cmtt-10">&#x003E;</span>, and all variables that
                  <span 
class="cmtt-10">&#x003C;</span><span 
class="cmsltt-10">name</span><span 
class="cmtt-10">&#x003E; </span>has in turn inherited. An implementation may inherit from any number of
                  other implementations.
                  </dd><dt class="list">
<span 
class="cmtt-10">Friend: &#x003C;</span><span 
class="cmsltt-10">name</span><span 
class="cmtt-10">&#x003E;</span>    </dt><dd 
class="list">
                  <!--l. 249--><p class="noindent" >This  gets  all  <span 
class="cmtt-10">Protected </span>variables  from  implementation  <span 
class="cmtt-10">&#x003C;</span><span 
class="cmsltt-10">name</span><span 
class="cmtt-10">&#x003E;</span>,  but,  unlike
                  <span 
class="cmtt-10">inherits</span>, it is symmetric and also defines a transitive relation by pushing its own
                  implementation&#8217;s <span 
class="cmtt-10">Protected </span>variables onto implementation <span 
class="cmsltt-10">name</span>. This keyword is
                  used to define a group of implementations which all end up with the same <span 
class="cmtt-10">Protected</span>
                  variables.</dd></dl>
                                                                                       
                                                                                       
<!--l. 257--><p class="noindent" >So, for example, an <span 
class="cmtt-10">interface.ccl </span>starting <div class="alltt">
<!--l. 258--><p class="noindent" ><div class="obeylines-v">
<span 
class="cmtt-10">implements:</span><span 
class="cmtt-10">&#x00A0;wavetoy</span>
<br /><span 
class="cmtt-10">inherits:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;grid</span>
<br /><span 
class="cmtt-10">friend:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;wave_extract</span>
</div>
</div> declares that the thorn provides an implementation called <span 
class="cmtt-10">wavetoy</span>, gets all the <span 
class="cmtt-10">public </span>variables declared by
an implementation called <span 
class="cmtt-10">grid</span>, and shares all <span 
class="cmtt-10">protected </span>variables with <span 
class="cmtt-10">wave</span><span 
class="cmtt-10">_extract </span>and its
friends.
<!--l. 268--><p class="noindent" >Cactus variables, described in Chapter&#x00A0;<a 
href="#x13-63000C1.3">C1.3<!--tex4ht:ref: chap:cactus_variables --></a>, are placed in groups with homogeneous attributes, where the
attributes describe properties such as the data type, group type, dimension, ghostsize, number of timelevels, type
of staggering and distribution.
<!--l. 274--><p class="noindent" >For example, a group, called <span 
class="cmtt-10">realfields </span>of 5 real grid functions (<span 
class="cmtt-10">phi</span>, <span 
class="cmtt-10">a</span>, <span 
class="cmtt-10">b</span>, <span 
class="cmtt-10">c</span>, <span 
class="cmtt-10">d</span>), on a 3D grid, would be defined
by
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-9">
CCTK_REAL&#x00A0;realfields&#x00A0;type=GF&#x00A0;TimeLevels=3&#x00A0;Dim=3
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;&#x00A0;phi
&#x00A0;<br />&#x00A0;&#x00A0;a,b,c,d
&#x00A0;<br />}&#x00A0;"Example&#x00A0;grid&#x00A0;functions"
</div>
<!--l. 283--><p class="nopar" > or, for a group called <span 
class="cmtt-10">intfields </span>consisting of just one distributed 2D array of integers,
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-10">
CCTK_INT&#x00A0;intfields&#x00A0;type=ARRAY&#x00A0;size=xsize,ysize&#x00A0;ghostsize=gxsize,gysize&#x00A0;dim=2
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;anarray
&#x00A0;<br />}&#x00A0;"My&#x00A0;2D&#x00A0;arrays"
</div>
<!--l. 291--><p class="nopar" > where <span 
class="cmtt-10">xsize</span>, <span 
class="cmtt-10">ysize</span>, <span 
class="cmtt-10">gxsize</span>, <span 
class="cmtt-10">gysize </span>are all parameters defined in the thorn&#8217;s <span 
class="cmtt-10">param.ccl</span>.
<!--l. 296--><p class="noindent" >By default, all groups are <span 
class="cmtt-10">private</span>, to change this, an access specification of the form <span 
class="cmtt-10">public: </span>or <span 
class="cmtt-10">protected:</span>
(or <span 
class="cmtt-10">private: </span>to change it back) may be placed on a line by itself. This changes the access level for any group
defined in the file from that point on.
<!--l. 301--><p class="noindent" >All variables seen by any one thorn must have distinct names.
<!--l. 303--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-54000C1.2.3"></a>The <span 
class="cmtt-10">param.ccl </span>File</h5>
<!--l. 306--><p class="noindent" >Users control the operation of thorns via parameters given in a file at runtime. The <span 
class="cmtt-10">param.ccl </span>file is used to
specify the parameters used to control an individual thorn, and to specify the values these parameters are
allowed to take. When the code is run, it reads a parameter file and sets the parameters if they fall
within the allowed values. If a parameter is not assigned in a parameter file, it is given its default
value.
<!--l. 314--><p class="noindent" >There are three access levels available for parameters:
<!--l. 316--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">Global</span>            </dt><dd 
class="list">
                  <!--l. 317--><p class="noindent" >These parameters are seen by all thorns.
                  </dd><dt class="list">
<span 
class="cmtt-10">Restricted</span>        </dt><dd 
class="list">
                  <!--l. 319--><p class="noindent" >These parameters may be used by other implementations if they so desire.
                  </dd><dt class="list">
<span 
class="cmtt-10">Private</span>           </dt><dd 
class="list">
                  <!--l. 321--><p class="noindent" >These are only seen by this thorn.</dd></dl>
<!--l. 325--><p class="noindent" >A parameter specification consists of:
     <ul class="itemize1">
     <li class="itemize">The parameter type (each may have an optional <span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_</span></span> in front)
                                                                                       
                                                                                       
                       <dl class="list2"><dt class="list">
     <span 
class="cmtt-10">REAL</span>              </dt><dd 
class="list">
                       <!--l. 330--><p class="noindent" >
                       </dd><dt class="list">
     <span 
class="cmtt-10">INT</span>               </dt><dd 
class="list">
                       <!--l. 331--><p class="noindent" >
                       </dd><dt class="list">
     <span 
class="cmtt-10">KEYWORD</span>           </dt><dd 
class="list">
                       <!--l. 332--><p class="noindent" >A distinct string with only a few known allowed values.
                       </dd><dt class="list">
     <span 
class="cmtt-10">STRING</span>            </dt><dd 
class="list">
                       <!--l. 334--><p class="noindent" >An arbitrary string, which must conform to a given regular expression.
                       </dd><dt class="list">
     <span 
class="cmtt-10">BOOLEAN</span>           </dt><dd 
class="list">
                       <!--l. 336--><p class="noindent" >A boolean type which can take values <span class="obeylines-h"><span 
class="cmtt-10">1</span></span>, <span class="obeylines-h"><span 
class="cmtt-10">t</span></span>, <span class="obeylines-h"><span 
class="cmtt-10">true</span></span>, <span class="obeylines-h"><span 
class="cmtt-10">yes</span></span> or <span class="obeylines-h"><span 
class="cmtt-10">0</span></span>, <span class="obeylines-h"><span 
class="cmtt-10">f</span></span>, <span class="obeylines-h"><span 
class="cmtt-10">false</span></span>, <span class="obeylines-h"><span 
class="cmtt-10">no</span></span>.</dd></dl>
     </li>
     <li class="itemize">The parameter name
     </li>
     <li class="itemize">An optional size (in square brackets)&#8211;if this is present, the parameter is a &#8220;parameter array&#8221;, i.e.&#x00A0;it will
     actually be an array of parameters, each of which has the same properties, but a different value. Such
     arrays appear as normal arrays in C or Fortran, 0-based in C, and 1-based in Fortran. In the parameter file
     the value of each element is specified with square brackets and is 0-based. The size must be an
     integer.
     </li>
     <li class="itemize">A description of the parameter
     </li>
     <li class="itemize">An allowed value block&#8211;this consists of a brace-delimited block of
     lines<span class="footnote-mark"><a 
href="#fn1x9" id="fn1x9-bk"><sup class="textsuperscript">1</sup></a></span><a 
 id="x13-54001f1"></a>
     describing the allowed values of the parameter. Each range may have a description associated with it by
     placing a <span 
class="cmtt-10">:: </span>on the line, and putting the description afterwards.
     </li>
     <li class="itemize">The default value&#8211;this must be one of the allowed values.
     </li></ul>
<!--l. 364--><p class="noindent" >For the numeric types <span 
class="cmtt-10">INT </span>and <span 
class="cmtt-10">REAL</span>, a range consists of a string of the form lower-bound:upper-bound:step,
where a missing number or an asterisk &#8216;<span 
class="cmtt-10">*</span>&#8217; denotes anything (i.e.&#x00A0;infinite bounds or an infinitesimal
step).
<!--l. 369--><p class="noindent" >For example,
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-11">
REAL&#x00A0;Coeff&#x00A0;"Important&#x00A0;coefficient"
&#x00A0;<br />{
&#x00A0;<br />0:3.14&#x00A0;::&#x00A0;"Range&#x00A0;has&#x00A0;to&#x00A0;be&#x00A0;from&#x00A0;zero&#x00A0;to&#x00A0;Pi,&#x00A0;default&#x00A0;is&#x00A0;zero"
&#x00A0;<br />}&#x00A0;0.0
&#x00A0;<br />
&#x00A0;<br />#No&#x00A0;need&#x00A0;to&#x00A0;define&#x00A0;a&#x00A0;range&#x00A0;for&#x00A0;BOOLEAN
&#x00A0;<br />BOOLEAN&#x00A0;nice&#x00A0;"Nice&#x00A0;weather?"
&#x00A0;<br />{
&#x00A0;<br />}"yes"
&#x00A0;<br />
&#x00A0;<br />#&#x00A0;A&#x00A0;example&#x00A0;for&#x00A0;a&#x00A0;set&#x00A0;of&#x00A0;keywords&#x00A0;and&#x00A0;its&#x00A0;default&#x00A0;(which&#x00A0;has&#x00A0;to&#x00A0;be
&#x00A0;<br />#&#x00A0;defined&#x00A0;in&#x00A0;the&#x00A0;body)
&#x00A0;<br />KEYWORD&#x00A0;confused&#x00A0;"Are&#x00A0;we&#x00A0;getting&#x00A0;confused?"
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;&#x00A0;"yes"&#x00A0;&#x00A0;&#x00A0;&#x00A0;::&#x00A0;"absolutely&#x00A0;positively"
&#x00A0;<br />&#x00A0;&#x00A0;"perhaps"&#x00A0;::&#x00A0;"we&#x00A0;are&#x00A0;not&#x00A0;sure"
&#x00A0;<br />&#x00A0;&#x00A0;"never"&#x00A0;&#x00A0;&#x00A0;::&#x00A0;"never"
&#x00A0;<br />}&#x00A0;"never"
&#x00A0;<br />
&#x00A0;<br />REAL&#x00A0;Length[2]&#x00A0;"Length&#x00A0;in&#x00A0;each&#x00A0;direction"
&#x00A0;<br />{
&#x00A0;<br />0:*&#x00A0;::&#x00A0;"Range&#x00A0;has&#x00A0;to&#x00A0;be&#x00A0;from&#x00A0;zero&#x00A0;to&#x00A0;infinity,&#x00A0;default&#x00A0;is&#x00A0;one"
&#x00A0;<br />}&#x00A0;1.0
&#x00A0;<br />
</div>
<!--l. 395--><p class="nopar" > defines a <span 
class="cmtt-10">REAL </span>parameter, a <span 
class="cmtt-10">BOOLEAN </span>parameter, a <span 
class="cmtt-10">KEYWORD</span>, and an array of <span 
class="cmtt-10">REAL </span>parameters.
<!--l. 399--><p class="noindent" >By default, all parameters are <span 
class="cmtt-10">private</span>; to change this, an access specification of the form <span 
class="cmtt-10">global: </span>or
<span 
class="cmtt-10">restricted: </span>(or <span 
class="cmtt-10">private: </span>to change it back) may be placed on a line by itself. This changes the access level for
any parameter defined in the file from that point on.
<!--l. 404--><p class="noindent" >To access <span 
class="cmtt-10">restricted </span>parameters from another implementation, a line containing <span 
class="cmtt-10">shares: &#x003C;</span><span 
class="cmsltt-10">name</span><span 
class="cmtt-10">&#x003E;</span>
declares that all parameters mentioned in the file, from now until the next access specification,
originate in implementation <span 
class="cmtt-10">&#x003C;</span><span 
class="cmsltt-10">name</span><span 
class="cmtt-10">&#x003E;</span>. (Note that only one implementation can be specified on each
<span 
class="cmtt-10">shares: </span>line.) Each of these parameters must be qualified by the initial token <span 
class="cmtt-10">USES </span>or <span 
class="cmtt-10">EXTENDS</span>,
where
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">USES</span>              </dt><dd 
class="list">
                  <!--l. 410--><p class="noindent" >indicates that the parameters range remains unchanged.
                  </dd><dt class="list">
<span 
class="cmtt-10">EXTENDS</span>           </dt><dd 
class="list">
                  <!--l. 411--><p class="noindent" >indicates that the parameters range is going to be extended.</dd></dl>
<!--l. 414--><p class="noindent" >In contrast to parameter declarations in other access blocks, the default value must be omitted&#8212;it is impossible
                                                                                       
                                                                                       
to set the default value of any parameter not originating in this thorn. For example, the following block adds
possible values to the keyword <span 
class="cmtt-10">initial</span><span 
class="cmtt-10">_data </span>originally defined in the implementation <span 
class="cmtt-10">einstein</span>, and uses the
<span 
class="cmtt-10">REAL </span>parameter <span 
class="cmtt-10">speed</span>.
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-12">
shares:einstein
&#x00A0;<br />
&#x00A0;<br />EXTENDS&#x00A0;KEYWORD&#x00A0;initial_data
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;&#x00A0;"bl_bh"&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;::&#x00A0;"Brill&#x00A0;Lindquist&#x00A0;black&#x00A0;holes"
&#x00A0;<br />&#x00A0;&#x00A0;"misner_bh"&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;::&#x00A0;"Misner&#x00A0;black&#x00A0;holes"
&#x00A0;<br />&#x00A0;&#x00A0;"schwarzschild"&#x00A0;::&#x00A0;"One&#x00A0;Schwarzschild&#x00A0;black&#x00A0;hole"
&#x00A0;<br />}
&#x00A0;<br />
&#x00A0;<br />USES&#x00A0;CCTK_REAL&#x00A0;speed
&#x00A0;<br />
</div>
<!--l. 433--><p class="nopar" >
<!--l. 435--><p class="noindent" >Note that you must compile at least one thorn which implements <span 
class="cmtt-10">einstein</span>.
<!--l. 441--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-55000C1.2.3"></a>The <span 
class="cmtt-10">schedule.ccl </span>File</h5>
<!--l. 443--><p class="noindent" >By default, no routine of a thorn will be run. The <span 
class="cmtt-10">schedule.ccl </span>file defines those that should be run, and when
and under which conditions they should be run.
<!--l. 447--><p class="noindent" >The specification of routine scheduling is via a schedule block which consists of lines of the form
<div class="alltt">
<!--l. 450--><p class="noindent" ><div class="obeylines-v">
<span 
class="cmtt-10">schedule</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">name</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;at</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">time</span><span 
class="cmsltt-10">&#x00A0;bin</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;[</span><span 
class="cmsltt-10">other</span><span 
class="cmsltt-10">&#x00A0;options</span><span 
class="cmtt-10">]</span>
<br /><span 
class="cmsy-10">{</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;LANG:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;&#x003C;FORTRAN|C&#x003E;</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;STORAGE:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;[</span><span 
class="cmsltt-10">group</span><span 
class="cmsltt-10">&#x00A0;list</span><span 
class="cmsltt-10">&#x00A0;with</span><span 
class="cmsltt-10">&#x00A0;timelevels</span><span 
class="cmtt-10">]</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;TRIGGERS:</span><span 
class="cmtt-10">&#x00A0;[</span><span 
class="cmsltt-10">group</span><span 
class="cmsltt-10">&#x00A0;list</span><span 
class="cmtt-10">]</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;SYNC:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;[</span><span 
class="cmsltt-10">group</span><span 
class="cmsltt-10">&#x00A0;list</span><span 
class="cmtt-10">]</span>
<br /><span 
class="cmsy-10">}</span><span 
class="cmtt-10">&#x00A0;"</span><span 
class="cmsltt-10">A</span><span 
class="cmsltt-10">&#x00A0;description</span><span 
class="cmtt-10">"</span>
</div>
</div> where <span 
class="cmtt-10">&#x003C;</span><span 
class="cmsltt-10">name</span><span 
class="cmtt-10">&#x003E; </span>is the name of the routine, and <span 
class="cmtt-10">&#x003C;</span><span 
class="cmsltt-10">time bin</span><span 
class="cmtt-10">&#x003E; </span>is the name of a schedule bin (the <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ </span>prefix is
optional). A list of the most useful schedule bins for application thorns is given here, a complete and more
descriptive list is provided in Appendix&#x00A0;<a 
href="UsersGuidech14.html#x19-213000D4">D4<!--tex4ht:ref: sec:Appendix.schedule_bins --></a>:
<!--l. 465--><p class="noindent" >
                                                                                       
                                                                                       
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STARTUP</span>      </dt><dd 
class="list">
                  <!--l. 467--><p class="noindent" >For  routines,  run  before  the  grid  hierarchy  is  set  up,  for  example,  function
                  registration.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_PARAMCHECK</span>   </dt><dd 
class="list">
                  <!--l. 471--><p class="noindent" >For routines that check parameter combinations, routines registered here only have
                  access to the grid size and the parameters.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_BASEGRID</span>     </dt><dd 
class="list">
                  <!--l. 475--><p class="noindent" >Responsible for setting up coordinates, etc.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INITIAL</span>      </dt><dd 
class="list">
                  <!--l. 478--><p class="noindent" >For generating initial data.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_POSTINITIAL</span>  </dt><dd 
class="list">
                  <!--l. 481--><p class="noindent" >Tasks which must be applied after initial data is created.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_PRESTEP</span>      </dt><dd 
class="list">
                  <!--l. 484--><p class="noindent" >Stuff done before the evolution step.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_EVOL</span>         </dt><dd 
class="list">
                  <!--l. 487--><p class="noindent" >The evolution step.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_POSTSTEP</span>     </dt><dd 
class="list">
                  <!--l. 490--><p class="noindent" >Stuff done after the evolution step.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ANALYSIS</span>     </dt><dd 
class="list">
                  <!--l. 493--><p class="noindent" >For analysing data.
                  </dd></dl>
<!--l. 498--><p class="noindent" >The <span 
class="cmsltt-10">other options </span>allow finer-grained control of the scheduling. It is possible to state that the routine must
run <span 
class="cmtt-10">BEFORE </span>or <span 
class="cmtt-10">AFTER </span>another routine or set of routines. It is also possible to schedule the routine under an alias
name by using <span 
class="cmtt-10">AS &#x003C;</span><span 
class="cmsltt-10">alias</span><span 
class="cmsltt-10">_name</span><span 
class="cmtt-10">&#x003E;</span>.
<!--l. 504--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">LANG</span>              </dt><dd 
class="list">
                  <!--l. 506--><p class="noindent" >The <span 
class="cmtt-10">LANG </span>keyword specifies the linkage of the scheduled routine which determines
                  how to call it from the scheduler. C and Fortran linkage are possible here. C++
                  routines should be defined as <span 
class="cmtt-10">extern "C" </span>and registered as <span 
class="cmtt-10">LANG: C</span>.
                                                                                       
                                                                                       
                  </dd><dt class="list">
<span 
class="cmtt-10">STORAGE</span>           </dt><dd 
class="list">
                  <!--l. 512--><p class="noindent" >The <span 
class="cmtt-10">STORAGE </span>keyword specifies any groups for which memory should be allocated
                  for the duration of the routine. The storage status reverts to its previous status
                  after the routine returns. The format of the <span 
class="cmtt-10">STORAGE </span>statement includes specifying
                  the number of timelevels of each group for which storage should be activated.
                  <!--l. 519--><p class="noindent" ><span 
class="cmtt-10">STORAGE: &#x003C;</span><span 
class="cmsltt-10">group1</span><span 
class="cmtt-10">&#x003E;[</span><span 
class="cmsltt-10">timelevels1</span><span 
class="cmtt-10">], &#x003C;</span><span 
class="cmsltt-10">group2</span><span 
class="cmtt-10">&#x003E;[</span><span 
class="cmsltt-10">timelevels2</span><span 
class="cmtt-10">]</span>
                  <!--l. 521--><p class="noindent" >This number can range from one to the maximum number of timelevels for the
                  group, as specified in the group definition in its <span 
class="cmtt-10">interface.ccl </span>file. If this maximum
                  number  is  one,  the  timelevel  specification  can  be  omitted  from  the  <span 
class="cmtt-10">STORAGE</span>
                  statement. Alternatively <span 
class="cmsltt-10">timelevels </span>can be the name of a parameter accessible to
                  the thorn. The parameter name is the same as used in C routines of the thorn, fully
                  qualified parameter names of the form <span 
class="cmsltt-10">thorn</span><span 
class="cmtt-10">::</span><span 
class="cmsltt-10">parameter </span>are not allowed.
                  </dd><dt class="list">
<span 
class="cmtt-10">TRIGGERS</span>          </dt><dd 
class="list">
                  <!--l. 528--><p class="noindent" ><span 
class="cmtt-10">TRIGGERS </span>is used when the routine is registered at <span 
class="cmtt-10">ANALYSIS</span>. This is a special time
                  bin; a routine registered here will only be called if one of the variables from a group
                  in <span 
class="cmtt-10">TRIGGERS </span>is due for output. (A routine without <span 
class="cmtt-10">TRIGGERS </span>declaration will always
                  be called.)
                  </dd><dt class="list">
<span 
class="cmtt-10">SYNC</span>              </dt><dd 
class="list">
                  <!--l. 534--><p class="noindent" >The  keyword  <span 
class="cmtt-10">SYNC </span>specifies  groups  of  variables  which  should  be  synchronised
                  (that is, their ghostzones should be exchanged between processors) on exit from
                  the routine. Specifying synchronisation of grid variables in <span 
class="cmtt-10">schedule.ccl </span>is an
                  alternative  to  calling  the  functions  <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_SyncGroup() </span>or  <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_SyncGroupsI()</span>
                  (see  the  Reference  Manual)  from  inside  a  routine.  Using  the  <span 
class="cmtt-10">SYNC </span>keyword  in
                  the <span 
class="cmtt-10">schedule.ccl </span>is the preferred method, since it provides the flesh with more
                  information about the behaviour of your code.
                  </dd></dl>
<!--l. 546--><p class="noindent" >Besides schedule blocks, it&#8217;s possible to embed C style <span 
class="cmtt-10">if/else </span>statements in the <span 
class="cmtt-10">schedule.ccl </span>file. These can
be used to schedule things based upon the value of a parameter.
<!--l. 551--><p class="noindent" ><span 
class="cmbx-10">Example I:</span>
<!--l. 553--><p class="noindent" >If the parameter <span 
class="cmtt-10">evolve</span><span 
class="cmtt-10">_hydro </span>is positively set, the Fortran routine <span 
class="cmtt-10">hydro</span><span 
class="cmtt-10">_predictor </span>is scheduled to run in the
<span 
class="cmti-10">evolution </span>loop, after the routine <span 
class="cmtt-10">metric</span><span 
class="cmtt-10">_predictor </span>and before <span 
class="cmtt-10">metric</span><span 
class="cmtt-10">_corrector</span>. The routine names
<span 
class="cmtt-10">metric</span><span 
class="cmtt-10">_predictor </span>and <span 
class="cmtt-10">metric</span><span 
class="cmtt-10">_corrector</span>, may either be real routine names from the same or a different
thorn, or they may be <span 
class="cmtt-10">aliased </span>routine names (see the next example).
<!--l. 561--><p class="noindent" >Before entry to <span 
class="cmtt-10">hydro</span><span 
class="cmtt-10">_predictor</span>, storage will be allocated for one timelevel for the group of grid variables
<span 
class="cmtt-10">hydro</span><span 
class="cmtt-10">_variables </span>on exit from the routine this storage will be deallocated and the contents of the variables will
be lost.
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-13">
if(CCTK_Equals(evolve_hydro,"yes"))
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;&#x00A0;SCHEDULE&#x00A0;hydro_predictor&#x00A0;AT&#x00A0;evol&#x00A0;AFTER&#x00A0;metric_predictor&#x00A0;BEFORE&#x00A0;metric_corrector
&#x00A0;<br />&#x00A0;&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;LANG:&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;FORTRAN
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;STORAGE:&#x00A0;&#x00A0;hydro_variables[1]
&#x00A0;<br />&#x00A0;&#x00A0;}&#x00A0;"Do&#x00A0;a&#x00A0;predictor&#x00A0;step&#x00A0;on&#x00A0;the&#x00A0;hydro&#x00A0;variables"
&#x00A0;<br />}
</div>
<!--l. 574--><p class="nopar" >
<!--l. 576--><p class="noindent" >If the parameter <span 
class="cmtt-10">evolve</span><span 
class="cmtt-10">_hydro </span>is set negatively, the <span 
class="cmtt-10">hydro</span><span 
class="cmtt-10">_predictor </span>routine will not be called by the
scheduler. Note that if the <span 
class="cmtt-10">evolve</span><span 
class="cmtt-10">_hydro </span>parameter is <span 
class="cmtt-10">STEERABLE</span>, it can be dynamically scheduled and
de-scheduled during a run if a steering interface is available.
<!--l. 583--><p class="noindent" ><span 
class="cmbx-10">Example II:</span>
<!--l. 585--><p class="noindent" >The thorns <span 
class="cmtt-10">WaveToy77 </span>and <span 
class="cmtt-10">WaveToyC</span>, each provide a routine to evolve the 3D wave equation:
<span 
class="cmtt-10">WaveToyF77</span><span 
class="cmtt-10">_Evolution </span>and <span 
class="cmtt-10">WaveToyC</span><span 
class="cmtt-10">_Evolution</span>. The routine names have to be different, so that both thorns
can be compiled at the same time, their functionality is identical though. Either one of them can then be
activated at run time in the parameter file via <span 
class="cmtt-10">ActiveThorns</span>.
<!--l. 592--><p class="noindent" >Since each evolution routine provides the same functionality, it makes sense to schedule them under the common
alias <span 
class="cmtt-10">WaveToy</span><span 
class="cmtt-10">_Evolution </span>to allow relative scheduling (<span 
class="cmtt-10">BEFORE/AFTER</span>) independent of the actual routine name
(which may change depending on the activation in the parameter file).
<!--l. 598--><p class="noindent" >In both cases, the group of variables <span 
class="cmtt-10">scalarfield </span>are synchronised across processes when the routine is
exited.
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-14">
schedule&#x00A0;WaveToyF77_Evolution&#x00A0;AS&#x00A0;WaveToy_Evolution&#x00A0;AT&#x00A0;evol
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;&#x00A0;LANG:&#x00A0;Fortran
&#x00A0;<br />&#x00A0;&#x00A0;STORAGE:&#x00A0;scalartmps
&#x00A0;<br />&#x00A0;&#x00A0;SYNC:&#x00A0;scalarfield
&#x00A0;<br />}&#x00A0;"Evolution&#x00A0;of&#x00A0;3D&#x00A0;wave&#x00A0;equation"
&#x00A0;<br />
&#x00A0;<br />schedule&#x00A0;WaveToyC_Evolution&#x00A0;AS&#x00A0;WaveToy_Evolution&#x00A0;AT&#x00A0;evol
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;&#x00A0;LANG:&#x00A0;C
&#x00A0;<br />&#x00A0;&#x00A0;STORAGE:&#x00A0;scalartmps
&#x00A0;<br />&#x00A0;&#x00A0;SYNC:&#x00A0;scalarfield
&#x00A0;<br />}&#x00A0;"Evolution&#x00A0;of&#x00A0;3D&#x00A0;wave&#x00A0;equation"
</div>
<!--l. 614--><p class="nopar" > The thorn <span 
class="cmtt-10">IDScalarWave </span>schedules the routine <span 
class="cmtt-10">WaveBinary </span>after the alias <span 
class="cmtt-10">WaveToy</span><span 
class="cmtt-10">_Evolution</span>. It is scheduled
independently of the C or Fortran routine name.
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-15">
schedule&#x00A0;WaveBinary&#x00A0;AT&#x00A0;evol&#x00A0;AFTER&#x00A0;WaveToy_Evolution
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;&#x00A0;STORAGE:&#x00A0;wavetoy::scalarevolve
&#x00A0;<br />&#x00A0;&#x00A0;LANG:&#x00A0;&#x00A0;&#x00A0;&#x00A0;Fortran
&#x00A0;<br />}&#x00A0;"Provide&#x00A0;binary&#x00A0;source&#x00A0;during&#x00A0;evolution"
</div>
<!--l. 624--><p class="nopar" >
<!--l. 626--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-56000C1.2.3"></a><span 
class="cmbx-10">Storage Outside of Schedule Blocks</span></span>
The keyword <span 
class="cmtt-10">STORAGE </span>can also be used outside of the schedule blocks to indicate that storage for these groups
should be switched on at the start of the run. Note that the storage is only allocated in this way at the start; a
thorn could explicitly switch the storage off (although this is not recommended practise). As for the <span 
class="cmtt-10">STORAGE</span>
statement in schedule blocks, each group must also specify how many timelevels to activate storage
for.
<!--l. 638--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-57000C1.2.3"></a>The <span 
class="cmtt-10">configuration.ccl</span></h5>
<!--l. 641--><p class="noindent" >[<span 
class="cmbx-10">NOTE: </span>the <span 
class="cmtt-10">configuration.ccl </span>is a new feature, and not all the features described in this section have been
fully implemented yet. PROVIDES, REQUIRES and SCRIPT should work, but OPTIONAL is still being
developed.]
<!--l. 646--><p class="noindent" >The <span 
class="cmtt-10">configuration.ccl </span>file is optional. It can be used for two purposes: to detect certain features of the
host system, such as the presence or absence of libraries, variable types, etc, or the location of
libraries; or to provide access to certain functions too complex or otherwise not suitable for function
aliasing.
<!--l. 652--><p class="noindent" >The basic concept here is that a thorn can either provide or use a <span 
class="cmbx-10">capability</span>. A thorn providing a capability
can specify a script which is run by the CST to detect features and write any configuration files; the script may
output lines to its standard output to inform the CST of features to: add to the header files included by thorns
using this capability; add to the make files used to build thorns using this capability; or add to the main Cactus
link line. The script may also indicate that this capability is not present by returning a non-zero exit code&#8212;e.g.
if the thorn is providing access to an external library, it should return an error if the library is not installed on
the system.
<!--l. 664--><p class="noindent" >A thorn may either require a capability to be present, in which case it is an error if there is no thorn
providing that capability in the configuration&#8217;s <span 
class="cmtt-10">ThornList</span>, or it may optionally use a capability,
in which case a macro is defined in the thorn&#8217;s header file if a thorn providing the capability is
present.
                                                                                       
                                                                                       
<!--l. 670--><p class="noindent" >A configuration.ccl file has the form:
<div class="alltt">
<!--l. 672--><p class="noindent" ><div class="obeylines-v">
<span 
class="cmtt-10">PROVIDES</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">My_Capability</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmsy-10">{</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;SCRIPT</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">My_ConfigScript</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;LANG</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">My_Language</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmsy-10">}</span>
<br />
<br /><span 
class="cmtt-10">REQUIRES</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">Another_Capability</span><span 
class="cmtt-10">&#x003E;</span>
<br />
<br /><span 
class="cmtt-10">OPTIONAL</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">Yet_Another_Capability</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmsy-10">{</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;DEFINE</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">macro</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmsy-10">}</span>
<br />
</div>
</div>
<!--l. 688--><p class="noindent" >which states that this thorn provides the capability <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">My_Capability</span></span></span>, and a script <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">MyConfigScript</span></span></span> should be run
to detect features of this capability; the script is in language <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">My_Language</span></span></span>&#8212;the CST will use the appropriate
environment or interpreter to invoke the script.
<!--l. 694--><p class="noindent" >The example requires a thorn providing <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">Another_Capability</span></span></span> to be in the <span 
class="cmtt-10">ThornList</span>, and, if a thorn providing
<span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">Yet_Another_Capability</span></span></span> is in the <span 
class="cmtt-10">ThornList</span>, the preprocessor macro <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">macro</span></span></span> will be defined, and set to
1.
<!--l. 699--><p class="noindent" >As an example, a thorn A may be able to use PVM for parallelism if it is present, but can still work in the
absence of it. There could be a thorn providing PVM, and thorn A would then have
<div class="alltt">
<!--l. 703--><p class="noindent" ><div class="obeylines-v">
<span 
class="cmtt-10">OPTIONAL</span><span 
class="cmtt-10">&#x00A0;PVM</span>
<br /><span 
class="cmsy-10">{</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;DEFINE</span><span 
class="cmtt-10">&#x00A0;HAVE_PVM</span>
<br /><span 
class="cmsy-10">}</span>
<br />
</div>
</div>
<!--l. 711--><p class="noindent" >The code in thorn A could then have
<div class="alltt">
                                                                                       
                                                                                       
<!--l. 713--><p class="noindent" ><div class="obeylines-v">
<br /><span 
class="cmtt-10">#ifdef</span><span 
class="cmtt-10">&#x00A0;HAVE_PVM</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;do</span><span 
class="cmtt-10">&#x00A0;something</span>
<br /><span 
class="cmtt-10">#else</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;do</span><span 
class="cmtt-10">&#x00A0;something</span><span 
class="cmtt-10">&#x00A0;else</span>
<br /><span 
class="cmtt-10">#endif</span>
<br />
</div>
</div>
<!--l. 723--><p class="noindent" >to pick the appropriate mode.
<!--l. 725--><p class="noindent" >The syntax of the output of the configure script is described in Appendix <a 
href="UsersGuidech12.html#x17-200000D2.5.1">D2.5.1<!--tex4ht:ref: sec:Appendix.configuration.ccl.configscript --></a>.
<!--l. 732--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.2.4   </span> <a 
 id="x13-58000C1.2.4"></a>Naming Conventions for Source Files</h4>
<!--l. 735--><p class="noindent" >The make system uses file extensions to designate coding language, as well as other properties of the code in the
file.
<!--l. 738--><p class="noindent" >The following extensions are understood:
<div class="center" 
>
<!--l. 740--><p class="noindent" >
<div class="tabular"> <table id="TBL-2" class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1"></colgroup><colgroup id="TBL-2-2g"><col 
id="TBL-2-2"></colgroup><colgroup id="TBL-2-3g"><col 
id="TBL-2-3"></colgroup><colgroup id="TBL-2-4g"><col 
id="TBL-2-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-1-1"  
class="td11">Extension</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-2"  
class="td11"> Language </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-3"  
class="td11">Format</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-4"  
class="td11">Preprocess</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-2-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">.F</span></span>       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-2"  
class="td11">Fortran 90</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-3"  
class="td11"> fixed  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-4"  
class="td11">   yes     </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-3-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">.f</span></span>       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-2"  
class="td11">Fortran 90</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-3"  
class="td11"> fixed  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-4"  
class="td11">   no     </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-4-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">.F90</span></span> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-2"  
class="td11">Fortran 90</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-3"  
class="td11"> free </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-4"  
class="td11"> yes</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-5-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">.f90</span></span>     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-2"  
class="td11">Fortran 90</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-3"  
class="td11">  free  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-4"  
class="td11">   no     </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-6-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-6-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">.F77</span></span> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-6-2"  
class="td11">Fortran 77</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-6-3"  
class="td11"> fixed </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-6-4"  
class="td11"> yes</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-7-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-7-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">.f77</span></span>     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-7-2"  
class="td11">Fortran 77</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-7-3"  
class="td11"> fixed  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-7-4"  
class="td11">   no     </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-8-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-8-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">.c</span></span>       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-8-2"  
class="td11">    C      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-8-3"  
class="td11">   -    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-8-4"  
class="td11">   yes     </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-9-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-9-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">.cc</span></span> or <span class="obeylines-h"><span 
class="cmtt-10">.C</span></span> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-9-2"  
class="td11">  C++    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-9-3"  
class="td11">   -    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-9-4"  
class="td11">   yes     </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-10-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-10-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">.cu</span></span>      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-10-2"  
class="td11">  CUDA   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-10-3"  
class="td11">   -    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-10-4"  
class="td11">   yes     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-11-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-11-1"  
class="td11">         </td>
</tr></table></div></div>
<!--l. 758--><p class="noindent" >In order to use Cactus <span 
class="cmtt-10">#include </span>directives in a file, it must be preprocessed.
<!--l. 761--><p class="noindent" >A complete description of Fortran fixed and free format can be found in any textbook on Fortran 90. The most
obvious differences are that in fixed format, code must begin after the 5th column and line continuations are
indicated by a character in column 5, while in free format, lines can begin anywhere, and line continuations are
indicated by an ampersand at the end of the line to be continued. Also note that statement labels are handled
                                                                                       
                                                                                       
very differently.
<!--l. 769--><p class="noindent" >The following restrictions apply to file names:
     <ul class="itemize1">
     <li class="itemize">For portability across all operating systems, the base names for any particular extension should
     not depend on the operating system being case sensitive (e.g.&#x00A0;having <span 
class="cmtt-10">MyFile.c </span>and <span 
class="cmtt-10">MYFILE.f77 </span>is
     allright, but <span 
class="cmtt-10">MyFile.c </span>and <span 
class="cmtt-10">MYFILE.c </span>could cause problems).
     </li>
     <li class="itemize">Currently, all source files within a thorn must have distinct names, regardless of whether they are
     placed in different subdirectories. We hope to relax this in future. Different thorns may have files
     with the same names, however.</li></ul>
<!--l. 784--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.2.5   </span> <a 
 id="x13-59000C1.2.5"></a>Adding Source Files</h4>
<!--l. 786--><p class="noindent" >By default, the CCTK looks in the <span 
class="cmtt-10">src </span>directory of the thorn for source files.
<!--l. 789--><p class="noindent" >There are two ways in which to specify the sources. The easiest is to use the <span 
class="cmtt-10">make.code.defn </span>based method in
which the CCTK does all the work, but you may instead put a <span 
class="cmtt-10">Makefile </span>in the <span 
class="cmtt-10">src </span>directory and do everything
yourself.
<!--l. 794--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-60000C1.2.5"></a><span 
class="cmtt-10">make.code.defn </span>based thorn building</h5>
<!--l. 797--><p class="noindent" >This is the standard way to compile your thorn&#8217;s source files. The Cactus make system looks for a file called
<span 
class="cmtt-10">make.code.defn </span>in that directory (if there is no file called <span 
class="cmtt-10">Makefile </span>in the <span 
class="cmtt-10">src </span>directory). At its simplest, this
file contains two lines
     <ul class="itemize1">
     <li class="itemize"><span 
class="cmtt-10">SRCS = &#x003C;</span><span 
class="cmsltt-10">list of all source files in this directory</span><span 
class="cmtt-10">&#x003E;</span>
     </li>
     <li class="itemize"><span 
class="cmtt-10">SUBDIRS = &#x003C;</span><span 
class="cmsltt-10">list of all subdirectories, including subdirectories of</span>
     <span 
class="cmsltt-10">subdirectories</span><span 
class="cmtt-10">&#x003E;</span>
     </li></ul>
<!--l. 809--><p class="noindent" >Each subdirectory listed should then have a <span 
class="cmtt-10">make.code.defn </span>file containing just a <span 
class="cmtt-10">SRCS =  </span>line, a <span 
class="cmtt-10">SUBDIRS =</span>
line will be ignored.
<!--l. 813--><p class="noindent" >In addition, each directory can have a <span 
class="cmtt-10">make.code.deps </span>file, which, for files in that directory, can contain
                                                                                       
                                                                                       
additional make rules and dependencies for files in that directory. See the GNU Make documentation for
complete details of the syntax.
<!--l. 818--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-61000C1.2.5"></a><span 
class="cmtt-10">Makefile </span>based thorn building</h5>
<!--l. 820--><p class="noindent" >This method gives you the ultimate responsibility. The only requirement is that a library called <span 
class="cmtt-10">$NAME </span>be created
by the <span 
class="cmtt-10">Makefile</span>.
<!--l. 824--><p class="noindent" >The makefile is passed the following variables
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">$(CCTK</span><span 
class="cmtt-10">_HOME)</span>      </dt><dd 
class="list">
                  <!--l. 827--><p class="noindent" >the main Cactus directory
                  </dd><dt class="list">
<span 
class="cmtt-10">$(TOP)</span>            </dt><dd 
class="list">
                  <!--l. 829--><p class="noindent" >the configuration directory
                  </dd><dt class="list">
<span 
class="cmtt-10">$(SRCDIR)</span>         </dt><dd 
class="list">
                  <!--l. 831--><p class="noindent" >the directory in which the source files can be found
                  </dd><dt class="list">
<span 
class="cmtt-10">$(CONFIG)</span>         </dt><dd 
class="list">
                  <!--l. 833--><p class="noindent" >the directory containing the configuration files
                  </dd><dt class="list">
<span 
class="cmtt-10">$(THORN)</span>          </dt><dd 
class="list">
                  <!--l. 835--><p class="noindent" >the thorn name
                  </dd><dt class="list">
<span 
class="cmtt-10">$(SCRATCH</span><span 
class="cmtt-10">_BUILD)</span>  </dt><dd 
class="list">
                  <!--l. 837--><p class="noindent" >the scratch directory where Fortran 90 module files should end up if they need to
                  be seen by other thorns.
                  </dd><dt class="list">
<span 
class="cmtt-10">$(NAME)</span>           </dt><dd 
class="list">
                  <!--l. 840--><p class="noindent" >the name of the library to be built
                  </dd></dl>
<!--l. 844--><p class="noindent" >and has a working directory of <span 
class="cmtt-10">&#x003C;</span><span 
class="cmsltt-10">config</span><span 
class="cmtt-10">&#x003E;/build/&#x003C;</span><span 
class="cmsltt-10">thorn</span><span 
class="cmsltt-10">_name</span><span 
class="cmtt-10">&#x003E; </span>.
                                                                                       
                                                                                       
<!--l. 847--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-62000C1.2.5"></a>Other makefile variables</h5>
     <ul class="itemize1">
     <li class="itemize"><span 
class="cmtt-10">CPP</span>: The C preprocessor which is used to preprocess C and C++ source code, and to determine
     the C and C++ make dependencies
     </li>
     <li class="itemize"><span 
class="cmtt-10">FPP</span>: The C preprocessor which is used to preprocess Fortran source code
     </li>
     <li class="itemize"><span 
class="cmtt-10">CPPFLAGS</span>: Flags which are passed to <span 
class="cmtt-10">CPP</span>, to <span 
class="cmtt-10">CC</span>, and to <span 
class="cmtt-10">CXX</span>
     </li>
     <li class="itemize"><span 
class="cmtt-10">FPPFLAGS</span>: Flags which are passed to <span 
class="cmtt-10">FPP</span>
     </li>
     <li class="itemize"><span 
class="cmtt-10">CC</span>: The C compiler
     </li>
     <li class="itemize"><span 
class="cmtt-10">CUDA</span>: The CUDA compiler
     </li>
     <li class="itemize"><span 
class="cmtt-10">CXX</span>: The C++ compiler
     </li>
     <li class="itemize"><span 
class="cmtt-10">F77</span>: The Fortran 77 compiler. This is only used if there is no Fortran 90 compiler
     </li>
     <li class="itemize"><span 
class="cmtt-10">F90</span>: The Fortran 90 compiler. If this variable is set, it is also used to compile Fortran 77 files
     </li>
     <li class="itemize"><span 
class="cmtt-10">CFLAGS</span>: Flags which are passed to <span 
class="cmtt-10">CC</span>
     </li>
     <li class="itemize"><span 
class="cmtt-10">CUDAFLAGS</span>: Flags which are passed to <span 
class="cmtt-10">CUDA</span>
     </li>
     <li class="itemize"><span 
class="cmtt-10">CXXFLAGS</span>: Flags which are passed to <span 
class="cmtt-10">CXX</span>
     </li>
     <li class="itemize"><span 
class="cmtt-10">F77FLAGS</span>: Flags which are passed to <span 
class="cmtt-10">F77</span>
     </li>
     <li class="itemize"><span 
class="cmtt-10">F90FLAGS</span>: Flags which are passed to <span 
class="cmtt-10">F90</span>
     </li>
     <li class="itemize"><span 
class="cmtt-10">LD</span>: The binder. This should not be directly <span 
class="cmtt-10">ld</span>, but should be a compiler driver such as C++. Often,
     <span 
class="cmtt-10">LD </span>is the same as <span 
class="cmtt-10">CXX</span>
     </li>
     <li class="itemize"><span 
class="cmtt-10">LDFLAGS</span>: Flags which are passed to <span 
class="cmtt-10">LD</span></li></ul>
                                                                                       
                                                                                       
<!--l. 879--><p class="noindent" >
<h3 class="sectionHead"><span class="titlemark">C1.3   </span> <a 
 id="x13-63000C1.3"></a>Cactus Variables</h3>
<!--l. 882--><p class="noindent" >A <span 
class="cmti-10">grid variable </span>is a Cactus program variable passed among thorns, (or routines belonging to the same
thorn interface), by way of calls to the flesh. They are the only variables known to Cactus. Such
variables represent values of functions on the computational grid, and are, therefore, often called <span 
class="cmti-10">grid</span>
<span 
class="cmti-10">functions</span>.
<!--l. 889--><p class="noindent" >In the Cactus context, grid variables are often referred to simply as <span 
class="cmti-10">variables</span>.
<!--l. 892--><p class="noindent" >Cactus variables are used instead of local variables for a number of reasons:
     <ul class="itemize1">
     <li class="itemize">Cactus variables can be made visible to other thorns, allowing thorns to communicate and share
     data.
     </li>
     <li class="itemize">Cactus  variables  can  be  distributed  and  communicated  among  processors,  allowing  parallel
     computation.
     </li>
     <li class="itemize">A database of Cactus variables, and their attributes, is held by the flesh, and this information is
     used by thorns, for example, for obtaining a list of variables for checkpointing.
     </li>
     <li class="itemize">Many Cactus APIs and tools can only be used with Cactus variables.
     </li>
     <li class="itemize">Cactus provides features for error checking based on Cactus variables and their attributes.</li></ul>
<!--l. 906--><p class="noindent" >Cactus variables are collected into <span 
class="cmti-10">groups</span>. All variables in a group are of the same data type, and have the same
attributes. Most Cactus operations act on a group as a whole. A group must be declared in its thorn&#8217;s
<span 
class="cmtt-10">interface.ccl </span>file.
<!--l. 911--><p class="noindent" >The specification for a group declaration (fully described in Appendix&#x00A0;<a 
href="UsersGuidech12.html#x17-186000D2.2">D2.2<!--tex4ht:ref: sec:Appendix.interface --></a>) is,
<div class="alltt">
<!--l. 914--><p class="noindent" ><div class="obeylines-v">
<span 
class="cmtt-10">&#x003C;</span><span 
class="cmsltt-10">data_type</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">group_name</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;[TYPE=&#x003C;</span><span 
class="cmsltt-10">group_type</span><span 
class="cmtt-10">&#x003E;]</span><span 
class="cmtt-10">&#x00A0;[DIM=&#x003C;</span><span 
class="cmsltt-10">dim</span><span 
class="cmtt-10">&#x003E;]</span><span 
class="cmtt-10">&#x00A0;[TIMELEVELS=&#x003C;</span><span 
class="cmsltt-10">num</span><span 
class="cmtt-10">&#x003E;]</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;[SIZE=&#x003C;</span><span 
class="cmsltt-10">size</span><span 
class="cmsltt-10">&#x00A0;in</span><span 
class="cmsltt-10">&#x00A0;each</span><span 
class="cmsltt-10">&#x00A0;direction</span><span 
class="cmtt-10">&#x003E;]</span><span 
class="cmtt-10">&#x00A0;[DISTRIB=&#x003C;</span><span 
class="cmsltt-10">distribution_type</span><span 
class="cmtt-10">&#x003E;]</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;[GHOSTSIZE=&#x003C;</span><span 
class="cmsltt-10">ghostsize</span><span 
class="cmtt-10">&#x003E;]</span><span 
class="cmtt-10">&#x00A0;[STAGGER=&#x003C;</span><span 
class="cmsltt-10">stagger-specification</span><span 
class="cmtt-10">&#x003E;]</span>
<br /><span 
class="cmtt-10">[</span><span 
class="cmsy-10">{</span>
<br /><span 
class="cmtt-10">&#x00A0;[</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">variable_name</span><span 
class="cmtt-10">&#x003E;[,]&#x003C;</span><span 
class="cmsltt-10">variable_name</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">variable_name</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;]</span>
<br /><span 
class="cmsy-10">}</span><span 
class="cmtt-10">&#x00A0;["&#x003C;</span><span 
class="cmsltt-10">group_description</span><span 
class="cmtt-10">&#x003E;"]</span><span 
class="cmtt-10">&#x00A0;]</span>
</div>
</div>
                                                                                       
                                                                                       
<!--l. 924--><p class="noindent" >Currently, the names of groups and variables must be distinct.
<!--l. 928--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.3.1   </span> <a 
 id="x13-64000C1.3.1"></a>Data Type</h4>
<!--l. 930--><p class="noindent" >Cactus supports integer, real, complex and character variable types, in various different sizes. (Sizes in the
following refer to the number of bytes occupied by the a variable of the type).
<!--l. 934--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmss-10">INTEGER</span>          </dt><dd 
class="list">
                  <!--l. 935--><p class="noindent" ><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT1</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT2</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT4</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT8</span>. (<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT </span>defaults to
                  being <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT4</span>).
                  </dd><dt class="list">
<span 
class="cmss-10">REAL</span>             </dt><dd 
class="list">
                  <!--l. 938--><p class="noindent" ><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL4</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL8</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL16</span>. (<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL </span>defaults to being
                  <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL8</span>).
                  </dd><dt class="list">
<span 
class="cmss-10">COMPLEX</span>         </dt><dd 
class="list">
                  <!--l. 940--><p class="noindent" ><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX</span>,       <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX8</span>,       <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX16</span>,       <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX32</span>.
                  (<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX </span>defaults to being <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX16</span>).
                  </dd><dt class="list">
<span 
class="cmss-10">BYTE</span>             </dt><dd 
class="list">
                  <!--l. 943--><p class="noindent" >This is a 1 byte data type.</dd></dl>
<!--l. 947--><p class="noindent" >Normally a thorn should use the default types&#8212;<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX</span>&#8212;rather than explicitly
setting the size, as this gives maximum portability. Also, the defaults can be changed at configuration time (see
Section <a 
href="UsersGuidech6.html#x9-20000B2.1.1">B2.1.1<!--tex4ht:ref: subsec:Compilation-Available_Options --></a>), and this allows people to compile the code with different precisions to test for roundoff effects,
or to run more quickly with a lower accuracy.
<!--l. 955--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.3.2   </span> <a 
 id="x13-65000C1.3.2"></a>Group Types</h4>
<!--l. 958--><p class="noindent" >Groups can be either <span 
class="cmti-10">scalars</span>, <span 
class="cmti-10">grid functions </span>(GFs), or <span 
class="cmti-10">grid arrays</span>. Different attributes are relevant for the
different group types.
<!--l. 963--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">SCALAR</span>            </dt><dd 
class="list">
                                                                                       
                                                                                       
                  <!--l. 964--><p class="noindent" >This is just a single number, e.g.&#x00A0;the total energy of some field. These variables
                  aren&#8217;t  communicated  between  processors&#8212;what  would  be  the  result  of  such
                  communication?
                  </dd><dt class="list">
<span 
class="cmtt-10">GF</span>                </dt><dd 
class="list">
                  <!--l. 968--><p class="noindent" >This is the most common group type. A GF is an array with a specific size, set at
                  run time in the parameter file, which is distributed across processors. All GFs have
                  the same size, and the same number of ghostzones. Groups of GFs can also specify
                  a dimension, number of timelevels, and stagger type.
                  </dd><dt class="list">
<span 
class="cmtt-10">ARRAY</span>             </dt><dd 
class="list">
                  <!--l. 974--><p class="noindent" >This is a more general form of the GF. Each group of arrays can have a distinct
                  size and number of ghostzones, in addition to dimension, number of timelevels and
                  stagger type. The drawback of using an array over a GF is that a lot of data about
                  the array can only be determined by function calls, rather than the quicker methods
                  available for GFs.</dd></dl>
<!--l. 985--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.3.3   </span> <a 
 id="x13-66000C1.3.3"></a>Timelevels</h4>
<!--l. 987--><p class="noindent" >These are best introduced by an example using finite differencing. Consider the 1-D wave equation
<table 
class="equation"><tr><td><a 
 id="x13-66001r1"></a>
<center class="math-display" >
<img 
src="UsersGuide1x.png" alt="&#x2202;2&#x03D5;   &#x2202;2&#x03D5;
&#x2202;t2 = &#x2202;x2-
" class="math-display" ></center></td><td class="equation-label">(C1.1)</td></tr></table>
<!--l. 991--><p class="nopar" >
To solve this by partial differences, one discretises the derivatives to get an equation relating the solution at
different times. There are many ways to do this, one of which produces the following difference
equation
<table 
class="equation"><tr><td><a 
 id="x13-66002r2"></a>
                                                                                       
                                                                                       
<center class="math-display" >
<img 
src="UsersGuide2x.png" alt="                                    2
&#x03D5;(t+ &#x0394;t,x)- 2&#x03D5;(t,x)+ &#x03D5;(t- &#x0394;t,x) = &#x0394;t-{&#x03D5;(t,x + &#x0394;x )- 2&#x03D5;(t,x)+ &#x03D5;(t,x- &#x0394;x )}
                                 &#x0394;x2
" class="math-display" ></center></td><td class="equation-label">(C1.2)</td></tr></table>
<!--l. 998--><p class="nopar" >
which relates the three timelevels <span 
class="cmmi-10">t </span>+ &#x0394;<span 
class="cmmi-10">t</span>, <span 
class="cmmi-10">t</span>, and <span 
class="cmmi-10">t </span><span 
class="cmsy-10">- </span>&#x0394;<span 
class="cmmi-10">t</span>.
<!--l. 1001--><p class="noindent" >Obviously, the code could just use three variables, one for each timelevel. This turns out, however, to be
inefficient, because as soon as the time is incremented to <span 
class="cmmi-10">t </span>+ &#x0394;<span 
class="cmmi-10">t</span>, it would be necessary to copy data from the <span 
class="cmmi-10">t</span>
variable to the <span 
class="cmmi-10">t </span><span 
class="cmsy-10">- </span>&#x0394;<span 
class="cmmi-10">t </span>variable and from the <span 
class="cmmi-10">t </span>+ &#x0394;<span 
class="cmmi-10">t </span>variable to the <span 
class="cmmi-10">t </span>variable.
<!--l. 1007--><p class="noindent" >To remove this extraneous copy, Cactus allows you to specify the number of timelevels used by your
numerical scheme. It then generates variables with the base name (e.g.&#x00A0;<span 
class="cmtt-10">phi</span>) suffixed by a qualifier
for which timelevel is being referred to&#8212;no suffix for the next timelevel, and <span 
class="cmtt-10">_p </span>for each previous
timelevel.
<!--l. 1013--><p class="noindent" >The timelevels are rotated (by the driver thorn) at the start of each evolution step, that is:
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-16">
initial
&#x00A0;<br />poststep
&#x00A0;<br />analysis
&#x00A0;<br />
&#x00A0;<br />loop:
&#x00A0;<br />&#x00A0;&#x00A0;rotate&#x00A0;timelevels
&#x00A0;<br />&#x00A0;&#x00A0;t&#x00A0;=&#x00A0;t&#x00A0;+&#x00A0;dt
&#x00A0;<br />&#x00A0;&#x00A0;it&#x00A0;=&#x00A0;it&#x00A0;+&#x00A0;1
&#x00A0;<br />&#x00A0;&#x00A0;prestep
&#x00A0;<br />&#x00A0;&#x00A0;evolve
&#x00A0;<br />&#x00A0;&#x00A0;poststep
&#x00A0;<br />&#x00A0;&#x00A0;analysis
</div>
<!--l. 1028--><p class="nopar" >
<!--l. 1030--><p class="noindent" >Timelevel rotation means that, for example, <span 
class="cmtt-10">phi</span><span 
class="cmtt-10">_p </span>now holds the values of the former <span 
class="cmtt-10">phi</span>, and <span 
class="cmtt-10">phi</span><span 
class="cmtt-10">_p</span><span 
class="cmtt-10">_p </span>the
values of the former <span 
class="cmtt-10">phi</span><span 
class="cmtt-10">_p</span>, etc. Note that after rotation, <span 
class="cmtt-10">phi </span>is undefined, and its values should not be used
until they have been updated.
<!--l. 1036--><p class="noindent" >All timelevels, except the current level, should be considered <span 
class="cmti-10">read-only </span>during evolution, that is, their values
should not be changed by thorns. The exception to this rule is for function initialisation, when the values at the
previous timelevels do need to be explicitly filled out.
<!--l. 1042--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.3.4   </span> <a 
 id="x13-67000C1.3.4"></a>Size and Distrib</h4>
<!--l. 1044--><p class="noindent" >A Cactus grid function or array has a size set at runtime by parameters. This size can either be the global size of
the array across all processors (<span 
class="cmtt-10">DISTRIB=DEFAULT</span>), or, if <span 
class="cmtt-10">DISTRIB=CONSTANT</span>, the specified size on <span 
class="cmti-10">each</span>
processor. If the size is split across processors, the driver thorn is responsible for assigning the size on each
processor.
<!--l. 1054--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.3.5   </span> <a 
 id="x13-68000C1.3.5"></a>Ghost Zones</h4>
<!--l. 1057--><p class="noindent" >Cactus is based upon a <span 
class="cmti-10">distributed computing </span>paradigm. That is, the problem domain is split into blocks, each of
which is assigned to a processor. For hyperbolic and parabolic problems the blocks only need to communicate at
the edges.
<!--l. 1062--><p class="noindent" >To illustrate this, take the example of the wave equation again. Equation <a 
href="#x13-66002r2">C1.2<!--tex4ht:ref: equation:difference --></a> describes a possible
time-evolution scheme. On examination, you can see that to generate the data at the point (<span 
class="cmmi-10">t </span>+ &#x0394;<span 
class="cmmi-10">t</span>, <span 
class="cmmi-10">x</span>) we need
                                                                                       
                                                                                       
data from the four points (<span 
class="cmmi-10">t</span>, <span 
class="cmmi-10">x</span>), (<span 
class="cmmi-10">t </span><span 
class="cmsy-10">- </span>&#x0394;<span 
class="cmmi-10">t</span>, <span 
class="cmmi-10">x</span>), (<span 
class="cmmi-10">t</span>, <span 
class="cmmi-10">x </span>+ &#x0394;<span 
class="cmmi-10">x</span>), and (<span 
class="cmmi-10">t</span>, <span 
class="cmmi-10">x </span><span 
class="cmsy-10">- </span>&#x0394;<span 
class="cmmi-10">x</span>) only. Ignoring the points at <span 
class="cmmi-10">x</span>, which
are obviously always available on a given processor, you can see that the algorithm requires a point on either side
of the point <span 
class="cmmi-10">x</span>, i.e.&#x00A0;this algorithm has <span 
class="cmti-10">stencil size </span>1. Similarly algorithms requiring two points on either side have
stencil size 2, etc.
<!--l. 1073--><p class="noindent" >Now, if you evolve the above scheme, it becomes apparent that at each iteration the number of grid points you
can evolve decreases by one at each edge (see Figure <a 
href="#x13-680011">C1.1<!--tex4ht:ref: fig:noghost --></a>).
<!--l. 1077--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                       
                                                                                       
<a 
 id="x13-680011"></a>
                                                                                       
                                                                                       
<div class="center" 
>
<!--l. 1078--><p class="noindent" >
<!--l. 1079--><p class="noindent" ><img 
src="UsersGuide3x.png" alt="PIC" class="graphics" width="686.56499pt" height="204.765pt" ><!--tex4ht:graphics  
name="UsersGuide3x.png" src="1dnoghost.ps"  
--></div>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;C1.1: </span><span  
class="content">Distributed wave equation with no ghostzones</span></div><!--tex4ht:label?: x13-680011 -->
                                                                                       
                                                                                       
<!--l. 1083--><p class="noindent" ></div><hr class="endfigure">
<!--l. 1085--><p class="noindent" >At the outer boundary of the physical domain, the data for the boundary point can be generated by the
boundary conditions, however, at internal boundaries, the data has to be copied from the adjacent processor. It
would be inefficient to copy each point individually, so instead, a number of <span 
class="cmti-10">ghostzones </span>are created at the
internal boundaries. A ghostzone consists of a copy of the whole plane (in 3D, line in 2D, point in 1D) of the
data from the adjacent processor. That is, the array on each processor is augmented with copies of points from
the adjacent processors, thus allowing the algorithm to proceed <span 
class="cmti-10">on the points owned by this processor </span>without
having to worry about copying data. Once the data has been evolved one step, the data in the ghostzones can
be exchanged (or <span 
class="cmti-10">synchronised</span>) between processors in one fell swoop before the next evolution
step. (See Figure <a 
href="#x13-680022">C1.2<!--tex4ht:ref: fig:withghost --></a>.) Note that you should have at least as many ghostzones as your stencil size
requires.
<!--l. 1101--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                       
                                                                                       
<a 
 id="x13-680022"></a>
                                                                                       
                                                                                       
<div class="center" 
>
<!--l. 1102--><p class="noindent" >
<!--l. 1103--><p class="noindent" ><img 
src="UsersGuide4x.png" alt="PIC" class="graphics" width="731.73375pt" height="222.8325pt" ><!--tex4ht:graphics  
name="UsersGuide4x.png" src="withghost.ps"  
--></div>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;C1.2: </span><span  
class="content">Distributed wave equation with ghostzones</span></div><!--tex4ht:label?: x13-680022 -->
                                                                                       
                                                                                       
<!--l. 1107--><p class="noindent" ></div><hr class="endfigure">
<h4 class="subsectionHead"><span class="titlemark">C1.3.6   </span> <a 
 id="x13-69000C1.3.6"></a>Staggering</h4>
<!--l. 1114--><p class="noindent" >The staggering of a grid function or array describes the <span 
class="cmti-10">physical </span>placement of that grid function relative to the
supporting grid structure. For example, a grid function does not have to be placed at the intersection of the
&#8220;grid lines&#8221;. It can be moved by half a grid spacing in any or all dimensions. In the latter case, it will be placed
in the center of a cell.
<!--l. 1122--><p class="noindent" >The staggering of a grid function is a pure <span 
class="cmti-10">physical </span>property: the values will be calculated at a different position
in physical space. Still the indexing (or bookkeeping) is kept the same for all types of staggerings: the indexing of
the default unstaggered grids is used.
<!--l. 1130--><p class="noindent" ><span 
class="cmbx-10">Specifying the staggertype</span>
<!--l. 1132--><p class="noindent" >The type of staggering applied to a grid function can be specified in the <span 
class="cmtt-10">interface.ccl </span>file by the attribute
<span 
class="cmtt-10">stagger </span>(see Appendix <a 
href="UsersGuidech12.html#x17-186000D2.2">D2.2<!--tex4ht:ref: sec:Appendix.interface --></a>). Cactus supports three kinds of staggering per dimension. The physical location of
a grid function is shifted relative to the default position by adding the following values to the stagger
attribute:
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">M</span>                 </dt><dd 
class="list">
                  <!--l. 1139--><p class="noindent" >no staggering, default. Refers to the &#8220;minus&#8221; face relative to the default gridpoint.
                  </dd><dt class="list">
<span 
class="cmtt-10">C</span>                 </dt><dd 
class="list">
                  <!--l. 1141--><p class="noindent" >centre staggering. The physical location is offset by half of the grid spacing in the
                  positive direction (or to the right).
                  </dd><dt class="list">
<span 
class="cmtt-10">P</span>                 </dt><dd 
class="list">
                  <!--l. 1143--><p class="noindent" >full staggered. <span 
class="cmtt-10">P </span>refers to plus. The physical location is offset by a full grid spacing
                  in the positive direction (or the right).</dd></dl>
<!--l. 1146--><p class="noindent" >For multi-dimensional grid functions you concatenate the code characters in <span 
class="cmmi-10">xyz </span>order. In Figure <a 
href="#x13-690013">C1.3<!--tex4ht:ref: fig:stagger1 --></a>, we show
four different staggerings of a two dimensional grid function. The solid black grid circles show the default
location of the grid function at the intersections of the grid lines. In (A) we show an additional
grid function of type <span 
class="cmtt-10">stagger=MC</span>: no staggering in <span 
class="cmmi-10">x </span>direction, center staggered in <span 
class="cmmi-10">y </span>direction. In
(B) we have <span 
class="cmtt-10">stagger=CM</span>, and staggering each direction (<span 
class="cmtt-10">stagger=CC</span>) is shown in (C). The full
staggering in (D) (<span 
class="cmtt-10">stagger=PP</span>) obeys the same rules, but is rather unusual; it is included here for
completeness.
<!--l. 1157--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                       
                                                                                       
<a 
 id="x13-690013"></a>
                                                                                       
                                                                                       
<div class="center" 
>
<!--l. 1159--><p class="noindent" >
<!--l. 1160--><p class="noindent" ><img 
src="UsersGuide5x.png" alt="PIC" class="graphics" width="831.105pt" height="714.67pt" ><!--tex4ht:graphics  
name="UsersGuide5x.png" src="staggering1.ps"  
--></div>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;C1.3: </span><span  
class="content"><span 
class="cmbx-9">Staggered gridpoints in 2D </span><span 
class="cmr-9">for several staggerings. (a) : </span><span 
class="cmtt-9">MC</span><span 
class="cmr-9">, (b): </span><span 
class="cmtt-9">CM</span><span 
class="cmr-9">, (c): </span><span 
class="cmtt-9">CC</span><span 
class="cmr-9">, (d): </span><span 
class="cmtt-9">PP</span><span 
class="cmr-9">. Note</span>
<span 
class="cmr-9">that the staggering of grid functions does not change its index. The staggered gridpoints and the corresponding</span>
<span 
class="cmr-9">unstaggered points (arrows) are accessed by the same indices.</span></span></div><!--tex4ht:label?: x13-690013 -->
                                                                                       
                                                                                       
<!--l. 1168--><p class="noindent" ></div><hr class="endfigure">
<h4 class="subsectionHead"><span class="titlemark">C1.3.7   </span> <a 
 id="x13-70000C1.3.7"></a>Information about Grid Variables</h4>
<!--l. 1172--><p class="noindent" >The flesh holds a database with information related to grid variables, and provides a set of querying
APIs.
<!--l. 1175--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-71000C1.3.7"></a>Group Information</h5>
<!--l. 1177--><p class="noindent" >Fundamental information about grid functions (e.g.&#x00A0;local grid size and location, number of ghostzones) is passed
through the argument list of scheduled routines (see Section&#x00A0;<a 
href="#x13-103000C1.6.2">C1.6.2<!--tex4ht:ref: sec:cactus_variables_c --></a>). To obtain similar information from
non-scheduled routines, or for general grid variables, a set of functions are provided, the last two letters of which
specify whether the information is requested using a group name (<span 
class="cmtt-10">GN</span>) or index (<span 
class="cmtt-10">GI</span>), or a variable name (<span 
class="cmtt-10">VN</span>) or
index (<span 
class="cmtt-10">VI</span>).
<!--l. 1185--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Grouplsh[GN|GI|VN|VI]</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 1187--><p class="noindent" >An array of integers with the local grid size on this processor.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Groupgsh[GN|GI|VN|VI]</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 1190--><p class="noindent" >An array of integers with the global grid size.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Groupbbox[GN|GI|VN|VI]</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 1193--><p class="noindent" >An array of integers which indicate whether the boundaries are internal boundaries
                  (e.g.&#x00A0;between processors), or physical boundaries. A value of <span 
class="cmtt-10">1 </span>indicates a physical
                  (outer) boundary at the edge of the computational grid, and <span 
class="cmtt-10">0 </span>indicates an internal
                  boundary.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Groupnghostzones[GN|GI|VN|VI]</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 1200--><p class="noindent" >An array of integers with the number of ghostzones used in each direction.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Grouplbnd[GN|GI|VN|VI]</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 1203--><p class="noindent" >An array of integers containing the lowest index (in each direction) of the local grid,
                  as seen on the global grid. Note that these indices start from zero, so you need to
                  add one when using them in Fortran thorns.
                                                                                       
                                                                                       
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Groupubnd[GN|GI|VN|VI]</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 1209--><p class="noindent" >An array of integers containing the largest index (in each direction) of the local
                  grid, as seen on the global grid. Note that these indices start from zero, so you need
                  to add one when using them in Fortran thorns.
                  </dd></dl>
<!--l. 1220--><p class="noindent" >
<h3 class="sectionHead"><span class="titlemark">C1.4   </span> <a 
 id="x13-72000C1.4"></a>Cactus Parameters</h3>
<!--l. 1223--><p class="noindent" >Parameters are the means by which the user specifies the runtime behaviour of the code. Each parameter has a
data type and a name, as well as a range of allowed values and a default value. These are declared in the thorn&#8217;s
<span 
class="cmtt-10">param.ccl </span>file.
<!--l. 1228--><p class="noindent" >The thorn determines which parameters can be used in other thorns by specifying a <span 
class="cmti-10">scope </span>for the thorn, as
explained in Section <a 
href="#x13-79000C1.4.2">C1.4.2<!--tex4ht:ref: sec:Cactus_parameters.scope --></a>.
<!--l. 1232--><p class="noindent" >The user may specify initial values for parameters in the parameter file (see Section&#x00A0;<a 
href="UsersGuidech7.html#x10-37000B3.2">B3.2<!--tex4ht:ref: sec:Parameter_File --></a>); the flesh validates
these values against the parameters&#8217; allowed ranges. Otherwise, the initial value of the parameter is taken to be
its default. Once validated, parameter values are fixed, and cannot be changed, unless the parameter
is specified to be <span 
class="cmti-10">steerable </span>(see <a 
href="#x13-80000C1.4.3">C1.4.3<!--tex4ht:ref: sec:Cactus_parameters.steerable --></a>). For a detailed discussion of the <span 
class="cmtt-10">param.ccl </span>syntax, see
Appendix&#x00A0;<a 
href="UsersGuidech12.html#x17-191000D2.3">D2.3<!--tex4ht:ref: sec:Appendix.param --></a>.
<!--l. 1242--><p class="noindent" >The full specification for a parameter declaration is <div class="alltt">
<!--l. 1243--><p class="noindent" ><div class="obeylines-v">
<span 
class="cmtt-10">[EXTENDS|USES]</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">parameter_type</span><span 
class="cmtt-10">&#x003E;[[&#x003C;</span><span 
class="cmsltt-10">size</span><span 
class="cmtt-10">&#x003E;]]</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">parameter</span><span 
class="cmsltt-10">&#x00A0;name</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;"&#x003C;</span><span 
class="cmsltt-10">parameter</span><span 
class="cmsltt-10">&#x00A0;description</span><span 
class="cmtt-10">&#x003E;"</span>
<br /><span 
class="cmsy-10">{</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">PARAMETER_RANGES</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmsy-10">}</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">default</span><span 
class="cmsltt-10">&#x00A0;value</span><span 
class="cmtt-10">&#x003E;</span>
</div>
</div>
<!--l. 1250--><p class="noindent" >You can obtain lists of the parameters associated with each thorn using the Cactus command line options <span 
class="cmtt-10">-o </span>and
<span 
class="cmtt-10">-O </span>(Section&#x00A0;<a 
href="UsersGuidech7.html#x10-36000B3.1">B3.1<!--tex4ht:ref: sec:command_line_options --></a>).
<!--l. 1257--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.4.1   </span> <a 
 id="x13-73000C1.4.1"></a>Types and Ranges</h4>
<!--l. 1260--><p class="noindent" >Parameters can be of these types:
                                                                                       
                                                                                       
<!--l. 1262--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmss-10">Int</span>                </dt><dd 
class="list">
                  <!--l. 1263--><p class="noindent" >Can take any integral value
                  </dd><dt class="list">
<span 
class="cmss-10">Real</span>               </dt><dd 
class="list">
                  <!--l. 1264--><p class="noindent" >Can take any floating point value
                  </dd><dt class="list">
<span 
class="cmss-10">Keyword</span>           </dt><dd 
class="list">
                  <!--l. 1265--><p class="noindent" >Can have a value consisting of one of a choice of strings
                  </dd><dt class="list">
<span 
class="cmss-10">Boolean</span>            </dt><dd 
class="list">
                  <!--l. 1266--><p class="noindent" >Can be true or false (<span class="obeylines-h"><span 
class="cmtt-10">1</span></span>, <span class="obeylines-h"><span 
class="cmtt-10">t</span></span>, <span class="obeylines-h"><span 
class="cmtt-10">true</span></span>, or <span class="obeylines-h"><span 
class="cmtt-10">0</span></span>, <span class="obeylines-h"><span 
class="cmtt-10">f</span></span>, <span class="obeylines-h"><span 
class="cmtt-10">false</span></span>)
                  </dd><dt class="list">
<span 
class="cmss-10">String</span>             </dt><dd 
class="list">
                  <!--l. 1268--><p class="noindent" >Can have any string value</dd></dl>
<!--l. 1271--><p class="noindent" >Each parameter can be validated against a set of allowed <span 
class="cmti-10">ranges</span>, each of which has a description associated with
it. The nature of the range is determined by the type of parameter, as follows:
<!--l. 1276--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-74000C1.4.1"></a>Int</h5>
<!--l. 1278--><p class="noindent" >The range specification is of the form
<div class="alltt">
<!--l. 1280--><p class="noindent" ><div class="obeylines-v">
<span 
class="cmsltt-10">lower</span><span 
class="cmtt-10">:</span><span 
class="cmsltt-10">upper</span><span 
class="cmtt-10">:</span><span 
class="cmsltt-10">stride</span>
</div>
</div>
<!--l. 1284--><p class="noindent" >where <span 
class="cmsltt-10">lower </span>and <span 
class="cmsltt-10">upper </span>specify the lower and upper allowed range, and <span 
class="cmsltt-10">stride </span>allows numbers to be be missed
out, e.g.&#x00A0;
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-17">
1:21:2
</div>
<!--l. 1288--><p class="nopar" > means the value must be an odd number between one and twenty-one (inclusive).
<!--l. 1292--><p class="noindent" >A missing end of range (or a &#8216;<span 
class="cmtt-10">*</span>&#8217;) indicates negative or positive infinity, and the default stride is
one.
<!--l. 1295--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-75000C1.4.1"></a>Real</h5>
<!--l. 1297--><p class="noindent" >The range specification is of the form <div class="alltt">
<!--l. 1298--><p class="noindent" ><div class="obeylines-v">
<span 
class="cmsltt-10">lower</span><span 
class="cmtt-10">:</span><span 
class="cmsltt-10">upper</span>
</div>
</div> where <span 
class="cmsltt-10">lower </span>and <span 
class="cmsltt-10">upper </span>specify the lower and upper allowed range. A missing end of range (or a &#8216;<span 
class="cmtt-10">*</span>&#8217;) implies
negative or positive infinity. The above is inclusive of the endpoints. A &#8216;<span 
class="cmtt-10">(</span>&#8217; (or &#8216;<span 
class="cmtt-10">)</span>&#8217;) before (or after) the lower (or
upper) range specifies an open endpoint.
<!--l. 1307--><p class="noindent" >The numbers written in a <span 
class="cmtt-10">param.ccl </span>file are interpreted as C code. To express a number in &#8216;scientific notation&#8217;,
use, e.g.&#x00A0;&#8216;<span 
class="cmtt-10">1e-10</span>&#8217;, which is a double precision constant in C. (If the floating precision of the variable to
which it is assigned is not double, then C will typecast appropriately. If you <span 
class="cmti-10">really </span>want to specify
a single precision floating constant, or a long double constant, append the number with <span class="obeylines-h"><span 
class="cmtt-10">f</span></span> or <span class="obeylines-h"><span 
class="cmtt-10">l</span></span>
respectively.)
<!--l. 1315--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-76000C1.4.1"></a>Keyword</h5>
<!--l. 1317--><p class="noindent" >The range specification consists of a string, which will be matched in a case insensitive manner.
<!--l. 1320--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-77000C1.4.1"></a>Boolean</h5>
                                                                                       
                                                                                       
<!--l. 1322--><p class="noindent" >There is no range specification for this type of parameter.
<!--l. 1324--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-78000C1.4.1"></a>String</h5>
<!--l. 1326--><p class="noindent" >The range is a POSIX regular expression. On some machines you may be able to use extended regular
expressions, but this is not guaranteed to be portable.
<!--l. 1332--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.4.2   </span> <a 
 id="x13-79000C1.4.2"></a>Scope</h4>
<!--l. 1335--><p class="noindent" >Parameters can be <span 
class="cmtt-10">GLOBAL</span>, <span 
class="cmtt-10">RESTRICTED</span>, or <span 
class="cmtt-10">PRIVATE</span>. Global parameters are visible to all thorns. Restricted
parameters are visible to any thorn which chooses to <span 
class="cmtt-10">USE </span>or <span 
class="cmtt-10">EXTEND </span>it. A private parameter is only visible to the
thorn which declares it. The default scope is <span 
class="cmtt-10">PRIVATE</span>.
<!--l. 1341--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.4.3   </span> <a 
 id="x13-80000C1.4.3"></a>Steerable</h4>
<!--l. 1343--><p class="noindent" >A parameter can be changed dynamically if it is specified to be <span 
class="cmti-10">steerable </span>(see Section&#x00A0;<a 
href="UsersGuidech12.html#x17-193000D2.3.2">D2.3.2<!--tex4ht:ref: subsec:Appendix.param.specification_items --></a>). It can then be
changed by a call to the flesh function <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ParameterSet </span>(see the Reference Guide for a description of this
function).
<!--l. 1353--><p class="noindent" >
<h3 class="sectionHead"><span class="titlemark">C1.5   </span> <a 
 id="x13-81000C1.5"></a>Scheduling</h3>
<!--l. 1356--><p class="noindent" >Cactus contains a rule-based scheduling system, which determines which routines, from which thorns are run in
which order. The scheduler determines if the specifications are inconsistent, but does allow the user to schedule a
routine with respect to another routine which may not exist. For a detailed discussion of the <span class="obeylines-h"><span 
class="cmtt-10">schedule.ccl</span></span>
syntax see Appendix&#x00A0;<a 
href="UsersGuidech12.html#x17-194000D2.4">D2.4<!--tex4ht:ref: sec:Appendix.schedule --></a>.
<!--l. 1364--><p class="noindent" >A usual simple specification for a schedule declaration is <div class="alltt">
<!--l. 1365--><p class="noindent" ><div class="obeylines-v">           <span 
class="cmtt-10">schedule</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">function</span><span 
class="cmsltt-10">&#x00A0;name</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;AT</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">schedule</span><span 
class="cmsltt-10">&#x00A0;bin</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmsy-10">{</span>
                                                                                       
                                                                                       
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;LANG:</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">language</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;[STORAGE:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">group</span><span 
class="cmtt-10">&#x003E;[[</span><span 
class="cmsltt-10">timelevels</span><span 
class="cmtt-10">]],&#x003C;</span><span 
class="cmsltt-10">group</span><span 
class="cmtt-10">&#x003E;[[</span><span 
class="cmsltt-10">timelevels</span><span 
class="cmtt-10">]]...]</span>
<br /><span 
class="cmsy-10">}</span><span 
class="cmtt-10">&#x00A0;"</span><span 
class="cmsltt-10">Description</span><span 
class="cmsltt-10">&#x00A0;of</span><span 
class="cmsltt-10">&#x00A0;function</span><span 
class="cmtt-10">"</span>
</div>
</div>
<!--l. 1372--><p class="noindent" >The full specification for a schedule declaration is <div class="alltt">
<!--l. 1373--><p class="noindent" ><div class="obeylines-v">
<span 
class="cmtt-10">schedule</span><span 
class="cmtt-10">&#x00A0;[GROUP]</span><span 
class="cmtt-10">&#x00A0;&#x003C;function|</span><span 
class="cmsltt-10">schedule</span><span 
class="cmsltt-10">&#x00A0;group</span><span 
class="cmsltt-10">&#x00A0;name</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;AT|IN</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">schedule</span><span 
class="cmsltt-10">&#x00A0;bin</span><span 
class="cmtt-10">|</span><span 
class="cmsltt-10">group</span><span 
class="cmsltt-10">&#x00A0;name</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;[AS</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">alias</span><span 
class="cmtt-10">&#x003E;]</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;[WHILE</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">variable</span><span 
class="cmtt-10">&#x003E;]</span><span 
class="cmtt-10">&#x00A0;[IF</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">variable</span><span 
class="cmtt-10">&#x003E;]</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;[BEFORE|AFTER</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">item</span><span 
class="cmtt-10">&#x003E;|(&#x003C;</span><span 
class="cmsltt-10">item</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">item</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;...)]</span>
<br /><span 
class="cmsy-10">{</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;LANG:</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">language</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;[STORAGE:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">group</span><span 
class="cmtt-10">&#x003E;[[</span><span 
class="cmsltt-10">timelevels</span><span 
class="cmtt-10">]],&#x003C;</span><span 
class="cmsltt-10">group</span><span 
class="cmtt-10">&#x003E;[[</span><span 
class="cmsltt-10">timelevels</span><span 
class="cmtt-10">]]...]</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;[TRIGGER:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">group</span><span 
class="cmtt-10">&#x003E;,&#x003C;</span><span 
class="cmsltt-10">group</span><span 
class="cmtt-10">&#x003E;...]</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;[SYNC:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">group</span><span 
class="cmtt-10">&#x003E;,&#x003C;</span><span 
class="cmsltt-10">group</span><span 
class="cmtt-10">&#x003E;...]</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;[OPTIONS:</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">option</span><span 
class="cmtt-10">&#x003E;,&#x003C;</span><span 
class="cmsltt-10">option</span><span 
class="cmtt-10">&#x003E;...]</span>
<br /><span 
class="cmsy-10">}</span><span 
class="cmtt-10">&#x00A0;"</span><span 
class="cmsltt-10">Description</span><span 
class="cmsltt-10">&#x00A0;of</span><span 
class="cmsltt-10">&#x00A0;function</span><span 
class="cmsltt-10">&#x00A0;or</span><span 
class="cmsltt-10">&#x00A0;schedule</span><span 
class="cmsltt-10">&#x00A0;group</span><span 
class="cmtt-10">"</span>
</div>
</div>
<!--l. 1386--><p class="noindent" >This full schedule specification consists of a mandatory part, a set of options, and the main body limited by
braces, referred to as the <span 
class="cmtt-10">schedule block</span>.
<!--l. 1390--><p class="noindent" >Each schedule item is scheduled either <span 
class="cmtt-10">AT </span>a particular <span 
class="cmsltt-10">scheduling bin</span>, or <span 
class="cmtt-10">IN </span>a schedule <span 
class="cmsltt-10">group</span>.
<!--l. 1395--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.5.1   </span> <a 
 id="x13-82000C1.5.1"></a>Schedule Bins</h4>
<!--l. 1398--><p class="noindent" >These are the main times at which scheduled functions are run, from fixed points in the flesh and driver
thorn (schedule bins can easily be traversed from any thorn, although this is not usual). When a
schedule bin is <span 
class="cmti-10">traversed</span>, all the functions scheduled in that particular are called, in the manner
described in Section <a 
href="#x13-86000C1.5.5">C1.5.5<!--tex4ht:ref: scheduling:calling_scheduled_functions --></a> and respecting the requested ordering of functions(Section&#x00A0;<a 
href="#x13-84000C1.5.3">C1.5.3<!--tex4ht:ref: scheduling:schedule_options --></a>). In the
absence of any ordering, functions in a particular schedule bin will be called in an undetermined
order.
<!--l. 1407--><p class="noindent" >The schedule bins are described in Section <a 
href="#x13-55000C1.2.3">C1.2.3<!--tex4ht:ref: subsec:schedule_ccl --></a>. Note that the preceding <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ </span>is optional for the use of the
bin names in the <span 
class="cmtt-10">schedule.ccl </span>file.
<!--l. 1413--><p class="noindent" >
                                                                                       
                                                                                       
<h4 class="subsectionHead"><span class="titlemark">C1.5.2   </span> <a 
 id="x13-83000C1.5.2"></a>Groups</h4>
<!--l. 1416--><p class="noindent" >If the optional <span 
class="cmtt-10">GROUP </span>specifier is used, the item is a schedule group rather than a normal function. Schedule
groups are effectively new, user-defined, schedule bins. Functions or groups may be scheduled <span 
class="cmtt-10">IN</span>
these, in the same way as they are scheduled <span 
class="cmtt-10">AT </span>the main schedule bins. (That is, groups may be
nested.)
<!--l. 1424--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.5.3   </span> <a 
 id="x13-84000C1.5.3"></a>Schedule Options</h4>
<!--l. 1426--><p class="noindent" >The options define various characteristics of the schedule item.
<!--l. 1428--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">AS</span>                </dt><dd 
class="list">
                  <!--l. 1429--><p class="noindent" >This assigns a new name to a function for scheduling purposes. This is used, for
                  instance, to allow a thorn to schedule something before or after a routine from
                  another implementation; two thorns providing this implementation can schedule a
                  routine <span 
class="cmtt-10">AS </span>the same thing, thus allowing other thorns to operate independently of
                  which one is active.
                  </dd><dt class="list">
<span 
class="cmtt-10">WHILE</span>             </dt><dd 
class="list">
                  <!--l. 1436--><p class="noindent" >This specifies a <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT </span>grid scalar which is used to control the execution of this
                  item. As long as the grid scalar has a nonzero value, the schedule item will be
                  executed repeatedly. This allows dynamic behaviour with scheduling.
                  </dd><dt class="list">
<span 
class="cmtt-10">IF</span>                </dt><dd 
class="list">
                  <!--l. 1442--><p class="noindent" >This specifies a <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT </span>grid scalar which is used to control the execution of this
                  item. If the grid scalar has a nonzero value, the schedule item will be executed,
                  otherwise the item will be ignored. This allows dynamic behaviour with scheduling.
                  <!--l. 1448--><p class="noindent" >If both an <span 
class="cmtt-10">IF </span>and a <span 
class="cmtt-10">WHILE </span>clause are present, then the schedule is executed according to
                  the following pseudocode:
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-18">
                  IF&#x00A0;condition
                  &#x00A0;<br />&#x00A0;&#x00A0;WHILE&#x00A0;condition
                  &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;SCHEDULE&#x00A0;item
                  &#x00A0;<br />&#x00A0;&#x00A0;END&#x00A0;WHILE
                  &#x00A0;<br />END&#x00A0;IF
</div>
                  <!--l. 1456--><p class="nopar" >
                  </dd><dt class="list">
<span 
class="cmtt-10">BEFORE </span><span 
class="cmss-10">or </span><span 
class="cmtt-10">AFTER</span>    </dt><dd 
class="list">
                  <!--l. 1458--><p class="noindent" >These specify either
                      <ul class="itemize1">
                      <li class="itemize">a function or group before or after which this item will be scheduled, or
                      </li>
                      <li class="itemize">a list of functions and/or groups; this item will be scheduled (once) before any
                      of them or after all of them respectively.</li></ul>
                  <!--l. 1466--><p class="noindent" >Note that a single schedule item may have multiple <span 
class="cmtt-10">BEFORE </span>and/or <span 
class="cmtt-10">AFTER </span>options; the
                  scheduler will honor all of these (or abort with a fatal error). For example,
                  <div class="alltt">
                  <!--l. 1469--><p class="noindent" ><div class="obeylines-v">
                  <span 
class="cmtt-10">schedule</span><span 
class="cmtt-10">&#x00A0;FOO</span><span 
class="cmtt-10">&#x00A0;BEFORE</span><span 
class="cmtt-10">&#x00A0;A</span><span 
class="cmtt-10">&#x00A0;BEFORE</span><span 
class="cmtt-10">&#x00A0;B</span><span 
class="cmtt-10">&#x00A0;BEFORE</span><span 
class="cmtt-10">&#x00A0;C</span><span 
class="cmtt-10">&#x00A0;...</span>
</div>
                  </div> schedules <span 
class="cmtt-10">FOO </span>before any of <span 
class="cmtt-10">A</span>, <span 
class="cmtt-10">B</span>, or <span 
class="cmtt-10">C</span>. This can also be written <div class="alltt">
                  <!--l. 1474--><p class="noindent" ><div class="obeylines-v">
                  <span 
class="cmtt-10">schedule</span><span 
class="cmtt-10">&#x00A0;FOO</span><span 
class="cmtt-10">&#x00A0;BEFORE</span><span 
class="cmtt-10">&#x00A0;(A</span><span 
class="cmtt-10">&#x00A0;B</span><span 
class="cmtt-10">&#x00A0;C)</span><span 
class="cmtt-10">&#x00A0;...</span>
</div>
                  </div>
                  <!--l. 1478--><p class="noindent" >Note that the set of all <span 
class="cmtt-10">BEFORE</span>/<span 
class="cmtt-10">AFTER </span>options in all active schedule blocks of all active
                  thorns, <span 
class="cmti-10">must </span>specify a (directed) graph with no cycles; if there are any cycles, then the
                  scheduler will abort with a fatal error.</dd></dl>
<!--l. 1486--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.5.4   </span> <a 
 id="x13-85000C1.5.4"></a>The Schedule Block</h4>
<!--l. 1489--><p class="noindent" >The schedule block specifies further details of the scheduled function or group.
<!--l. 1492--><p class="noindent" >
                                                                                       
                                                                                       
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">LANG</span>              </dt><dd 
class="list">
                  <!--l. 1493--><p class="noindent" >This specifies the language of the routine. Currently this is either C or Fortran.
                  C++ routines should be defined as <span 
class="cmtt-10">extern "C" </span>and registered as <span 
class="cmtt-10">LANG: C</span>.
                  </dd><dt class="list">
<span 
class="cmtt-10">STORAGE</span>           </dt><dd 
class="list">
                  <!--l. 1497--><p class="noindent" >The <span 
class="cmtt-10">STORAGE </span>keyword specifies groups for which memory should be allocated for the
                  duration of the routine or schedule group. The storage status reverts to its previous
                  status after completion of the routine or schedule group. Each group must specify
                  how many timelevels to activate storage for, from 1 up to the maximum number
                  for the group as specified in the defining <span 
class="cmtt-10">interface.ccl </span>file. If the maximum is 1
                  (the default) this number may be omitted. Alternatively <span 
class="cmsltt-10">timelevels </span>can be the
                  name of a parameter accessible to the thorn. The parameter name is the same
                  as used in C routines of the thorn, fully qualified parameter names of the form
                  <span 
class="cmsltt-10">thorn</span><span 
class="cmtt-10">::</span><span 
class="cmsltt-10">parameter </span>are not allowed.
                  </dd><dt class="list">
<span 
class="cmtt-10">TRIGGER</span>           </dt><dd 
class="list">
                  <!--l. 1508--><p class="noindent" >This is only used for items scheduled at timebin <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ANALYSIS</span>. The item will only
                  be executed if output is due for at least one variable in one of the listed groups.
                  (The item will also be called if there is no group listed.)
                  </dd><dt class="list">
<span 
class="cmtt-10">SYNC</span>              </dt><dd 
class="list">
                  <!--l. 1513--><p class="noindent" >On exit from this item, the ghost zones of the listed groups will be exchanged.
                  </dd><dt class="list">
<span 
class="cmtt-10">OPTIONS</span>           </dt><dd 
class="list">
                  <!--l. 1516--><p class="noindent" >This  is  for  miscellaneous  options.  The  list  of  accepted  options  is  given  in
                  Appendix&#x00A0;<a 
href="UsersGuidech12.html#x17-197000D2.4.2">D2.4.2<!--tex4ht:ref: app:allopts --></a>.</dd></dl>
<!--l. 1523--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.5.5   </span> <a 
 id="x13-86000C1.5.5"></a>How Cactus Calls Scheduled Functions</h4>
<!--l. 1526--><p class="noindent" >For each scheduled function called, the flesh performs a variety of jobs at entry and exit.
<!--l. 1529--><p class="noindent" >On entry to a scheduled routine, if the routine is being called at the <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ANALYSIS </span>timebin first, a check is
made to see if the routine should actually be called on this timestep. For this, all grid variables in the
trigger groups for the routine are checked with all registered output methods to determine if it is
time to output any triggers. The routine will only be called if at least one is due to be output.
Note that once a grid variable has been analyzed, it gets marked as such, and will not be analyzed
again during this iteration. (Note that a routine without any trigger groups will also be called.)
Thus, if more than one analysis routine should be triggered on the same trigger variable(s), they
must be scheduled in a single group. Routines from all timebins, other than <span 
class="cmtt-10">ANALYSIS</span>, are always
called.
<!--l. 1542--><p class="noindent" >Next, storage is assigned for any required variables, remembering the original state of storage.
                                                                                       
                                                                                       
<!--l. 1545--><p class="noindent" >The routine is then called, and on exit, any required grid variables are first synchronised. Following
synchronization, any required output methods are called for the triggers. Finally, the storage of grid variables is
returned to the original state.
<!--l. 1553--><p class="noindent" >
<h3 class="sectionHead"><span class="titlemark">C1.6   </span> <a 
 id="x13-87000C1.6"></a>Writing a Thorn</h3>
<!--l. 1557--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.6.1   </span> <a 
 id="x13-88000C1.6.1"></a>Thorn Programming Languages</h4>
<!--l. 1559--><p class="noindent" >When you start writing a new thorn, the first decision to make is which programming language to use. The
source code in Cactus thorns can be written in any mixture of Fortran 77, Fortran 90, C or C++. The following
points should be considered when choosing a language to work in
     <ul class="itemize1">
     <li class="itemize">All functions designed for application thorn writers are available in all languages, however, some
     interfaces for infrastructure thorn writing are only available from C or C++.
     </li>
     <li class="itemize">Stick to C rather than C++, unless you really need features from C++, this will help you with
     portability.
     </li></ul>
<!--l. 1580--><p class="noindent" >Whatever language you choose, if you want your thorn to be portable, and compile and run on multiple
platforms, stick to the standards and don&#8217;t use machine dependent extensions.
<!--l. 1586--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.6.2   </span> <a 
 id="x13-89000C1.6.2"></a>What the Flesh Provides</h4>
<!--l. 1588--><p class="noindent" >The flesh provides for thorns:
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">Variables</span>         </dt><dd 
class="list">
                  <!--l. 1590--><p class="noindent" >
                  </dd><dt class="list">
<span 
class="cmtt-10">Parameters</span>        </dt><dd 
class="list">
                  <!--l. 1591--><p class="noindent" >
                                                                                       
                                                                                       
                  </dd><dt class="list">
<span 
class="cmtt-10">Cactus Functions</span>  </dt><dd 
class="list">
                  <!--l. 1592--><p class="noindent" >
                      <ul class="itemize1">
                      <li class="itemize"> Driver (parallelisation) utilities
                      </li>
                      <li class="itemize"> I/O utilities
                      </li>
                      <li class="itemize"> Coordinates utilities
                      </li>
                      <li class="itemize"> Reduction utilities
                      </li>
                      <li class="itemize"> Interpolation utilities
                      </li>
                      <li class="itemize"> Information utilities</li></ul>
                  </dd></dl>
<!--l. 1605--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-90000C1.6.2"></a>Fortran Routines</h5>
<!--l. 1607--><p class="noindent" >Any source file using Cactus infrastructure should include the header file <span 
class="cmtt-10">cctk.h </span>using the line
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-19">
#include&#x00A0;"cctk.h"
</div>
<!--l. 1611--><p class="nopar" > (Fortran programmers should not be put off by this being a C style header file&#8212;most Cactus files are run
through a C preprocessor before compilation.)
<!--l. 1616--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-91000C1.6.2"></a><span 
class="cmbx-10">Variables</span></span>
Any routine using Cactus argument lists (for example, all routines called from the scheduler at
time bins between <span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STARTUP</span></span> and <span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_SHUTDOWN</span></span>) should include at the top of the file the
header
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-20">
#include&#x00A0;"cctk_Arguments.h"
</div>
<!--l. 1623--><p class="nopar" >
<!--l. 1625--><p class="noindent" >A Cactus macro <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ARGUMENTS </span>is defined for each thorn to contain:
     <ul class="itemize1">
     <li class="itemize">General information about the grid hierarchy, for example, the number of grid points used. See
     Section <a 
href="#x13-103000C1.6.2">C1.6.2<!--tex4ht:ref: sec:cactus_variables_c --></a> for a complete list.
     </li>
     <li class="itemize">All the grid variables defined in the thorn&#8217;s <span 
class="cmtt-10">interface.ccl</span>
     </li>
     <li class="itemize">All the grid variables required from other thorns as requested by the <span 
class="cmtt-10">inherits </span>and <span 
class="cmtt-10">friend </span>lines in
     the <span 
class="cmtt-10">interface.ccl</span></li></ul>
<!--l. 1635--><p class="noindent" >These variables must be declared at the start of the routine using the macro <span 
class="cmtt-10">DECLARE</span><span 
class="cmtt-10">_CCTK</span><span 
class="cmtt-10">_ARGUMENTS</span>.
<!--l. 1638--><p class="noindent" >To pass the arguments to another routine in the same thorn use the macro <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_PASS</span><span 
class="cmtt-10">_FTOF </span>in the calling
routine, and again the macro <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ARGUMENTS </span>in the receiving routine.
<!--l. 1642--><p class="noindent" >Note that you cannot use Cactus argument lists in routines scheduled at the <span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STARTUP</span></span> and <span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_SHUTDOWN</span></span>
time bins, because at this time no grid hierarchy exists.
<!--l. 1647--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-92000C1.6.2"></a><span 
class="cmbx-10">Parameters</span></span>
All parameters defined in a thorn&#8217;s <span 
class="cmtt-10">param.ccl </span>and all <span 
class="cmtt-10">global </span>parameters, appear as local variables of the
corresponding <span 
class="cmtt-10">CCTK </span>data type in Fortran source code, i.e. Booleans and Integers appear as <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT </span>types (with
nonzero/zero values for boolean <span class="obeylines-h"><span 
class="cmtt-10">yes/no</span></span>), Reals as <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL</span>, and Keywords and String parameters as
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STRING </span>(see also note below). These variables are <span 
class="cmti-10">read only</span>, and <span 
class="cmti-10">changes should not be made to them</span>. The
effect of changing a parameter is undefined (at best).
<!--l. 1658--><p class="noindent" >Any routine using Cactus parameters should include at the top of the file the header
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-21">
#include&#x00A0;"cctk_Parameters.h"
</div>
<!--l. 1662--><p class="nopar" >
<!--l. 1664--><p class="noindent" >The parameters should be declared at the start of the routine using them with the macro
<span 
class="cmtt-10">DECLARE</span><span 
class="cmtt-10">_CCTK</span><span 
class="cmtt-10">_PARAMETERS</span>.
<!--l. 1667--><p class="noindent" >In Fortran, special care should be taken with string valued parameters. These parameters are passed as C
pointers, and can not be treated as normal Fortran strings. To compare a string valued parameter and Fortran
string, use the macro <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_EQUALS() </span>or the function <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Equals() </span>(see the reference manual for a description
of the <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ </span>functions). To print the value of a string valued parameter to screen, use the subroutine
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_PrintString()</span>. A further function <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_FortranString </span>provides a mechanism for converting a string
parameter to a Fortran string. For example, if <span 
class="cmtt-10">operator </span>is a Cactus string parameter holding the name of a
reduction operator whose handle you need to find, you cannot pass it directly into the subroutine
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_LocalArrayReductionHandle</span>, which is expecting a Fortran string. Instead, the following is
needed:
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-22">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;character*200&#x00A0;fortran_operator
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;CCTK_INT&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;fortran_operator_len
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;integer&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;handle
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;call&#x00A0;CCTK_FortranString(fortran_operator_len,operator,fortran_operator)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;call&#x00A0;CCTK_LocalArrayReductionHandle(handle,fortran_operator(1:fortran_operator_len))
</div>
<!--l. 1687--><p class="nopar" >
<!--l. 1691--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-93000C1.6.2"></a><span 
class="cmbx-10">Fortran Example</span></span>
The Fortran routine, <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">MyFRoutine</span></span></span>, is scheduled in the <span 
class="cmtt-10">schedule.ccl </span>file, doesn&#8217;t use Cactus parameters, and
calls another routine, in the same thorn, <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">MyNewRoutine</span></span></span>, which does use parameters. This routine needs
to be passed an integer flag as well as the standard Cactus variables. The source file should look
like
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-23">
#include&#x00A0;"cctk.h"
&#x00A0;<br />#include&#x00A0;"cctk_Arguments.h"
&#x00A0;<br />#include&#x00A0;"cctk_Parameters.h"
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;subroutine&#x00A0;MyFRoutine(CCTK_ARGUMENTS)
&#x00A0;<br />
&#x00A0;<br />c&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;I&#8217;m&#x00A0;very&#x00A0;cautious,&#x00A0;so&#x00A0;I&#x00A0;want&#x00A0;to&#x00A0;declare&#x00A0;all&#x00A0;variables
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;implicit&#x00A0;none
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;DECLARE_CCTK_ARGUMENTS
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;integer&#x00A0;flag
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;flag&#x00A0;=&#x00A0;1
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;call&#x00A0;MyNewRoutine(CCTK_PASS_FTOF,flag)
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;return
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;end
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;subroutine&#x00A0;MyNewRoutine(CCTK_ARGUMENTS,flag)
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;implicit&#x00A0;none
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;DECLARE_CCTK_ARGUMENTS
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;DECLARE_CCTK_PARAMETERS
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;integer&#x00A0;flag
&#x00A0;<br />
&#x00A0;<br />c&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;Main&#x00A0;code&#x00A0;goes&#x00A0;here
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;return
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;end
&#x00A0;<br />
</div>
<!--l. 1732--><p class="nopar" >
<!--l. 1734--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-94000C1.6.2"></a><span 
class="cmbx-10">Cactus Fortran Functions</span></span>
Cactus Fortran functions, for example, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_MyProc </span>and <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Equals</span>, can all be declared by adding the
statement
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-24">
#include&#x00A0;"cctk_Functions.h"
</div>
<!--l. 1741--><p class="nopar" > near the top of the file, and adding the declaration
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-25">
DECLARE_CCTK_FUNCTIONS
</div>
<!--l. 1747--><p class="nopar" > to a module or a subroutine after the <span 
class="cmtt-10">implicit none </span>statement, but before any executable code.
<!--l. 1752--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-95000C1.6.2"></a><span 
class="cmbx-10">Fortran Modules</span></span>
Fortran modules should be placed into source files that have the same name as the module, followed by the
corresponding file name suffix. A module <span 
class="cmtt-10">metric </span>should thus be placed, e.g.&#x00A0;into a file <span 
class="cmtt-10">metric.F90</span>. This
convention allows the Cactus build system to automatically deduce the compile time dependencies.
<!--l. 1760--><p class="noindent" >If you do not follow this convention, then you have to include the modules into the thorn&#8217;s <span 
class="cmtt-10">make.code.deps </span>file
(Section <a 
href="#x13-60000C1.2.5">C1.2.5<!--tex4ht:ref: sec:mabathbu --></a>) to ensure they are compiled before the routines which use them. This is especially important for
parallel building. For example, if a routine in <span 
class="cmtt-10">MyRoutine.F90 </span>uses a module in <span 
class="cmtt-10">MyModule.F90</span>, then add the
line:
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-26">
MyRoutine.F90.o:&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;MyModule.F90.o
</div>
<!--l. 1769--><p class="nopar" >
<!--l. 1771--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-96000C1.6.2"></a><span 
class="cmbx-10">The </span><span 
class="cmtt-10">MOD </span><span 
class="cmbx-10">function</span></span>
The intrinsic function <span 
class="cmtt-10">MOD </span>in Fortran takes two integer arguments, which should both be of the same type. This
means that it may be necessary to cast the arguments to, e.g. <span 
class="cmtt-10">INT </span>for some architectures. This can occur in
particular when a <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT </span>parameter and the Cactus variable <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_iteration </span>(which is declared to be
<span 
class="cmtt-10">INTEGER</span>) are used, in which case the correct code is
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-27">
MOD(cctk_iteration,INT(MyParameter))
</div>
<!--l. 1782--><p class="nopar" >
<!--l. 1785--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-97000C1.6.2"></a>C Routines</h5>
<!--l. 1787--><p class="noindent" >Any source file using Cactus infrastructure should include the header file <span 
class="cmtt-10">cctk.h </span>using the line
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-28">
#include&#x00A0;"cctk.h"
</div>
<!--l. 1791--><p class="nopar" >
<!--l. 1793--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-98000C1.6.2"></a><span 
class="cmbx-10">Variables</span></span>
Any routine using Cactus argument lists (for example, all routines called from the scheduler at
time bins between <span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STARTUP</span></span> and <span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_SHUTDOWN</span></span>), should include at the top of the file the
header
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-29">
#include&#x00A0;"cctk_Arguments.h"
</div>
<!--l. 1800--><p class="nopar" >
<!--l. 1802--><p class="noindent" >A Cactus macro <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ARGUMENTS </span>is defined for each thorn to contain
     <ul class="itemize1">
     <li class="itemize">General  information  about  the  grid  hierarchy,  for  example,  the  number  of  grid  points  on  the
     processor. See Section <a 
href="#x13-103000C1.6.2">C1.6.2<!--tex4ht:ref: sec:cactus_variables_c --></a> for a complete list.
     </li>
     <li class="itemize">All the grid variables defined in the thorn&#8217;s <span 
class="cmtt-10">interface.ccl</span>
     </li>
     <li class="itemize">All the grid variables required from other thorns as requested by the <span 
class="cmtt-10">inherits </span>and <span 
class="cmtt-10">friend </span>lines in
     the <span 
class="cmtt-10">interface.ccl</span></li></ul>
<!--l. 1812--><p class="noindent" >These variables must be declared at the start of the routine using the macro <span 
class="cmtt-10">DECLARE</span><span 
class="cmtt-10">_CCTK</span><span 
class="cmtt-10">_ARGUMENTS</span>. This
macro should always be the first line of the routine.
<!--l. 1816--><p class="noindent" >To pass the arguments to another routine in the same thorn, use the macro <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_PASS</span><span 
class="cmtt-10">_CTOC </span>in the calling
routine, and again the macro <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ARGUMENTS </span>in the receiving routine.
<!--l. 1820--><p class="noindent" >Note that you cannot use Cactus argument lists in routines scheduled at the <span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STARTUP</span></span> and <span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_SHUTDOWN</span></span>
time bins, because at this time no grid hierarchy exists.
<!--l. 1825--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-99000C1.6.2"></a><span 
class="cmbx-10">Parameters</span></span>
All parameters defined in a thorn&#8217;s <span 
class="cmtt-10">param.ccl </span>and all <span 
class="cmtt-10">global </span>parameters, appear as local variables of the
corresponding <span 
class="cmtt-10">CCTK </span>data type in C source code, i.e. Integers and Booleans appear as <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT </span>types (with
nonzero/zero values for boolean <span class="obeylines-h"><span 
class="cmtt-10">yes/no</span></span>), Reals as <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL</span>, and Keywords and String parameters as
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STRING</span>. These variables are <span 
class="cmti-10">read only</span>, and <span 
class="cmti-10">changes should not be made to them</span>. The effect of changing a
parameter is undefined (at best).
<!--l. 1835--><p class="noindent" >Any routine using Cactus parameters should include at the top of the file the header
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-30">
#include&#x00A0;"cctk_Parameters.h"
</div>
<!--l. 1839--><p class="nopar" >
<!--l. 1841--><p class="noindent" >The parameters should be declared as the last statement in the declaration part of the routine using them with
the macro <span 
class="cmtt-10">DECLARE</span><span 
class="cmtt-10">_CCTK</span><span 
class="cmtt-10">_PARAMETERS</span>.
<!--l. 1844--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-100000C1.6.2"></a><span 
class="cmbx-10">Example</span></span>
The C routine <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">MyCRoutine</span></span></span> is scheduled in the <span 
class="cmtt-10">schedule.ccl </span>file, and uses Cactus parameters. The source file
should look like
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-31">
#include&#x00A0;"cctk.h"
&#x00A0;<br />#include&#x00A0;"cctk_Arguments.h"
&#x00A0;<br />#include&#x00A0;"cctk_Parameters.h"
&#x00A0;<br />
&#x00A0;<br />void&#x00A0;MyCRoutine(CCTK_ARGUMENTS)
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;&#x00A0;DECLARE_CCTK_ARGUMENTS
&#x00A0;<br />&#x00A0;&#x00A0;DECLARE_CCTK_PARAMETERS
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;/*&#x00A0;Here&#x00A0;goes&#x00A0;your&#x00A0;code&#x00A0;*/
&#x00A0;<br />}
</div>
<!--l. 1860--><p class="nopar" >
<!--l. 1862--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-101000C1.6.2"></a><span 
class="cmbx-10">Complex variables</span></span>
Cactus supports complex grid variables, and since there is no complex data type in C, Cactus provides a number
of functions for manipulating complex numbers to mirror the functionality available in Fortran. These functions
are <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Cmplx</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CmplxReal</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CmplxImag</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CmplxConjg</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CmplxAdd</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CmplxSub</span>,
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CmplxMul</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CmplxDiv</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CmplxExp</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CmplSin</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CmplxAbs</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CmplxLog</span>, and
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CmplSqrt</span>. See the Reference Manual for more details.
<!--l. 1875--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-102000C1.6.2"></a><span 
class="cmbx-10">Specifically for C Programmers</span></span>
Grid functions are held in memory as 1-dimensional C arrays. These are laid out in memory as in Fortran. This
means that the first index should be incremented through most rapidly. This is illustrated in the example
below.
<!--l. 1882--><p class="noindent" >Cactus provides macros to find the 1-dimensional index which is needed from the multidimensional indices which
are usually used. There is a macro for each dimension of grid function. Below is an artificial example to
demonstrate this using the 3D macro <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_GFINDEX3D</span>:
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-32">
for&#x00A0;(k=0;&#x00A0;k&#x003C;cctk_lsh[2];&#x00A0;k++)
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;&#x00A0;for&#x00A0;(j=0;&#x00A0;j&#x003C;cctk_lsh[1];&#x00A0;j++)
&#x00A0;<br />&#x00A0;&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;for&#x00A0;(i=0;&#x00A0;i&#x003C;cctk_lsh[0];&#x00A0;i++)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;const&#x00A0;ind3d&#x00A0;=&#x00A0;CCTK_GFINDEX3D(cctkGH,i,j,k);
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;rho[ind3d]&#x00A0;=&#x00A0;exp(-pow(r[ind3d],2));
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;}
&#x00A0;<br />&#x00A0;&#x00A0;}
&#x00A0;<br />}
</div>
<!--l. 1899--><p class="nopar" > Here, <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">CCTK_GFINDEX3D(cctkGH,i,j,k)</span></span></span> expands to
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-33">
((i)&#x00A0;+&#x00A0;cctkGH-&#x003E;cctk_lsh[0]*((j)+cctkGH-&#x003E;cctk_lsh[1]*(k)))
</div>
<!--l. 1904--><p class="nopar" > Note: In Fortran, grid functions are accessed as Fortran arrays, i.e.&#x00A0;simply as <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">rho(i,j,k)</span></span></span>.
<!--l. 1909--><p class="noindent" >To access vector grid functions (vector grid functions are a &#8220;vector&#8221; of grid functions; see section <a 
href="UsersGuidech12.html#x17-190000D2.2.4">D2.2.4<!--tex4ht:ref: subsec:Appendix.interface-variables --></a>), one
also needs to specify the vector index. This is best done via the 3D macro <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VECTGFINDEX3D</span>:
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-34">
for&#x00A0;(k=0;&#x00A0;k&#x003C;cctk_lsh[2];&#x00A0;k++)
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;&#x00A0;for&#x00A0;(j=0;&#x00A0;j&#x003C;cctk_lsh[1];&#x00A0;j++)
&#x00A0;<br />&#x00A0;&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;for&#x00A0;(i=0;&#x00A0;i&#x003C;cctk_lsh[0];&#x00A0;i++)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;vector&#x00A0;indices&#x00A0;are&#x00A0;0,&#x00A0;1,&#x00A0;2&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;vel[CCTK_VECTGFINDEX3D(cctkGH,i,j,k,0)]&#x00A0;=&#x00A0;1.0;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;vel[CCTK_VECTGFINDEX3D(cctkGH,i,j,k,1)]&#x00A0;=&#x00A0;0.0;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;vel[CCTK_VECTGFINDEX3D(cctkGH,i,j,k,2)]&#x00A0;=&#x00A0;0.0;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;}
&#x00A0;<br />&#x00A0;&#x00A0;}
&#x00A0;<br />}
</div>
<!--l. 1928--><p class="nopar" >
<!--l. 1930--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-103000C1.6.2"></a>Cactus Variables</h5>
<!--l. 1933--><p class="noindent" >The Cactus variables which are passed through the macro <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ARGUMENTS </span>are
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">cctkGH</span>            </dt><dd 
class="list">
                  <!--l. 1936--><p class="noindent" >A C pointer identifying the grid hierarchy.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_dim</span>          </dt><dd 
class="list">
                  <!--l. 1937--><p class="noindent" >An integer with the number of dimensions used for this grid hierarchy.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_lsh</span>          </dt><dd 
class="list">
                  <!--l. 1939--><p class="noindent" >An array of <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_dim </span>integers with the local grid size on this processor. This is the
                  allocated size of the array.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_gsh</span>          </dt><dd 
class="list">
                  <!--l. 1942--><p class="noindent" >An array of <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_dim </span>integers with the <span 
class="cmti-10">global </span>grid size.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_iteration</span>    </dt><dd 
class="list">
                  <!--l. 1944--><p class="noindent" >The current iteration number.
                                                                                       
                                                                                       
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_delta</span><span 
class="cmtt-10">_time</span>   </dt><dd 
class="list">
                  <!--l. 1945--><p class="noindent" >A <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL </span>with the timestep.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_time</span>         </dt><dd 
class="list">
                  <!--l. 1946--><p class="noindent" >A <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL </span>with the current time.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_delta</span><span 
class="cmtt-10">_space</span>  </dt><dd 
class="list">
                  <!--l. 1947--><p class="noindent" >An array of <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_dim CCTK</span><span 
class="cmtt-10">_REAL</span>s with the grid spacing in each direction.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_nghostzones</span>  </dt><dd 
class="list">
                  <!--l. 1949--><p class="noindent" >An array of <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_dim </span>integers with the number of ghostzones used in each direction.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_origin</span><span 
class="cmtt-10">_space</span> </dt><dd 
class="list">
                  <!--l. 1953--><p class="noindent" >An array of <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_dim CCTK</span><span 
class="cmtt-10">_REAL</span>s with the spatial coordinates of the global origin
                  of the grid.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_lssh</span>         </dt><dd 
class="list">
                  <!--l. 1956--><p class="noindent" >This is an internal array used to hold array extents for staggering. One should
                  use the macro CCTK_LSSH(,) to access its elements. This variable is also used
                  to determine the extent of the array over which to loop. Usually it is identical to
                  <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_lsh</span>, but if array padding is used (not yet implemented), all loops should use
                  CCTK_LSSH(,) to determine the loop indices over which to loop.
                  </dd></dl>
<!--l. 1966--><p class="noindent" >The following variables describe the location of the local grid (e.g.&#x00A0;the grid treated on a given processor) within
the global grid.
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_lbnd</span>         </dt><dd 
class="list">
                  <!--l. 1970--><p class="noindent" >An array of <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_dim </span>integers containing the lowest index (in each direction) of
                  the local grid, as seen on the global grid. Note that these indices start from zero,
                  so you need to add one when using them in Fortran thorns.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_ubnd</span>         </dt><dd 
class="list">
                  <!--l. 1976--><p class="noindent" >An array of <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_dim </span>integers containing the largest index (in each direction) of
                  the local grid, as seen on the global grid. Note that these indices start from zero,
                  so you need to add one when using them in Fortran thorns.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_bbox</span>         </dt><dd 
class="list">
                  <!--l. 1982--><p class="noindent" >An        array        of        2<span 
class="cmsy-10">*</span><span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_dim     </span>integers        (in        the        order
                  [dim<sub><span 
class="cmr-7">0</span></sub><sup>min</sup><span 
class="cmmi-10">,</span>dim<sub><span 
class="cmr-7">0</span></sub><sup>max</sup><span 
class="cmmi-10">,</span>dim<sub><span 
class="cmr-7">1</span></sub><sup>min</sup><span 
class="cmmi-10">,</span>dim<sub><span 
class="cmr-7">1</span></sub><sup>max</sup><span 
class="cmmi-10">,</span><span 
class="cmmi-10">&#x2026;</span>]), which indicate whether the boundaries
                  are internal boundaries (e.g.&#x00A0;between processors), or physical boundaries. A value
                  of 1 indicates a physical (outer) boundary at the edge of the computational grid,
                  and 0 indicates an internal boundary.</dd></dl>
                                                                                       
                                                                                       
<!--l. 1993--><p class="noindent" >The following variable is needed for grid refinement methods
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_levfac</span>       </dt><dd 
class="list">
                  <!--l. 1995--><p class="noindent" >An array of  <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_dim </span>integer factors by which the local grid is refined in the
                  corresponding direction with respect to the base grid.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_levoff</span>       </dt><dd 
class="list">
                  <!--l. 1998--><p class="noindent" >and <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_levoffdenom </span>Two arrays of <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_dim </span>integers describing the distance
                  by which the local grid is offset with respect to the base grid, measured in local
                  grid spacings. The distance in direction <span 
class="cmtt-10">dir </span>is given by <span 
class="cmtt-10">1.0 * cctk</span><span 
class="cmtt-10">_levoff[dir]</span>
                  <span 
class="cmtt-10">/ cctk</span><span 
class="cmtt-10">_levoffdenom[dir]</span>.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_timefac</span>      </dt><dd 
class="list">
                  <!--l. 2004--><p class="noindent" >The integer factor by which the time step size is reduced with respect to the base
                  grid.</dd></dl>
<!--l. 2009--><p class="noindent" >The following variables are used for identifying convergence levels.
<!--l. 2011--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_convlevel</span>    </dt><dd 
class="list">
                  <!--l. 2012--><p class="noindent" >The convergence level of this grid hierarchy. The base level is 0, and every level
                  above that is coarsened by a factor of <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_convfac</span>.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_convfac</span>      </dt><dd 
class="list">
                  <!--l. 2015--><p class="noindent" >The factor between convergence levels. The relation between the resolutions of
                  different convergence levels is &#x0394;<span 
class="cmmi-10">x</span><sub><span 
class="cmmi-7">L</span></sub> = &#x0394;<span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">0</span></sub> <span 
class="cmsy-10">&#x22C5; </span><span 
class="cmmi-10">F</span><sup><span 
class="cmmi-7">L</span></sup>, where <span 
class="cmmi-10">L </span>is the convergence level
                  and <span 
class="cmmi-10">F </span>is the convergence factor. The convergence factor defaults to 2.</dd></dl>
<!--l. 2022--><p class="noindent" >The variables <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_delta</span><span 
class="cmtt-10">_space</span>, <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_delta</span><span 
class="cmtt-10">_time</span>, and <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_origin</span><span 
class="cmtt-10">_space </span>denote the grid spacings, time
step size, and spatial origin on the <span 
class="cmti-10">base </span>grid. If you are using a grid refinement method, you need to
calculate these quantities on the grid you are on. There are Cactus macros provided for this, with the
syntax <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_DELTA</span><span 
class="cmtt-10">_SPACE(dir)</span>, <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ORIGIN</span><span 
class="cmtt-10">_SPACE(dir)</span>, and <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_DELTA</span><span 
class="cmtt-10">_TIME </span>for both C and
Fortran. It is recommended that these macros are always used to provide the grid spacings, time step
sizes, and spatial origins in your thorns. In doing so, you incorporate the effects of <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_levfac</span>,
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_levoff</span>, <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_levoffdenom</span>, and <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_timefac</span>, so that you do not explicitly have to take them into
account.
<!--l. 2035--><p class="noindent" >Putting the above information together, Figure&#x00A0;<a 
href="#x13-1030014">C1.4<!--tex4ht:ref: fig-global-xyz-coords --></a> shows two different ways to compute the global Cactus <span 
class="cmmi-10">xyz</span>
coordinates of the current grid point. Because the &#8220;alternate calculation&#8221; (the one using <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">Grid::x</span></span></span>, <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">Grid::y</span></span></span>, and
<span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">Grid::z</span></span></span>) gives the true global <span 
class="cmmi-10">xyz </span>coordinates even in a multipatch/multiblock context, this is generally the
preferred form for general use.
<!--l. 2042--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                       
                                                                                       
<a 
 id="x13-1030014"></a>
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-35">
#include&#x00A0;&#x003C;stddef.h&#x003E;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;defines&#x00A0;size_t&#x00A0;*/
&#x00A0;<br />#include&#x00A0;"cctk.h"
&#x00A0;<br />
&#x00A0;<br />void&#x00A0;MyThorn_MyFunction(CCTK_ARGUMENTS)
&#x00A0;<br />{
&#x00A0;<br />int&#x00A0;i,j,k;
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;for&#x00A0;(k&#x00A0;=&#x00A0;0&#x00A0;;&#x00A0;k&#x00A0;&#x003C;&#x00A0;cctk_lsh[2]&#x00A0;;&#x00A0;++k)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;for&#x00A0;(j&#x00A0;=&#x00A0;0&#x00A0;;&#x00A0;j&#x00A0;&#x003C;&#x00A0;cctk_lsh[1]&#x00A0;;&#x00A0;++j)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;for&#x00A0;(i&#x00A0;=&#x00A0;0&#x00A0;;&#x00A0;i&#x00A0;&#x003C;&#x00A0;cctk_lsh[0]&#x00A0;;&#x00A0;++i)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;size_t&#x00A0;posn&#x00A0;=&#x00A0;CCTK_GFINDEX3D(cctkGH,&#x00A0;i,j,k);
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;calculate&#x00A0;the&#x00A0;global&#x00A0;xyz&#x00A0;coordinates&#x00A0;of&#x00A0;the&#x00A0;(i,j,k)&#x00A0;grid&#x00A0;point&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;(in&#x00A0;a&#x00A0;multipatch/multiblock&#x00A0;context,&#x00A0;this&#x00A0;gives&#x00A0;the&#x00A0;per-patch&#x00A0;coordinates)&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;CCTK_REAL&#x00A0;xcoord&#x00A0;=&#x00A0;CCTK_ORIGIN_SPACE(0)&#x00A0;+&#x00A0;(cctk_lbnd[0]&#x00A0;+&#x00A0;i)*CCTK_DELTA_SPACE(0);
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;CCTK_REAL&#x00A0;ycoord&#x00A0;=&#x00A0;CCTK_ORIGIN_SPACE(1)&#x00A0;+&#x00A0;(cctk_lbnd[1]&#x00A0;+&#x00A0;j)*CCTK_DELTA_SPACE(1);
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;CCTK_REAL&#x00A0;zcoord&#x00A0;=&#x00A0;CCTK_ORIGIN_SPACE(2)&#x00A0;+&#x00A0;(cctk_lbnd[2]&#x00A0;+&#x00A0;k)*CCTK_DELTA_SPACE(2);
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;an&#x00A0;alternate&#x00A0;calculation,&#x00A0;which&#x00A0;requires&#x00A0;that&#x00A0;this&#x00A0;thorn&#x00A0;inherit&#x00A0;from&#x00A0;&#x00A0;Grid&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;(in&#x00A0;a&#x00A0;multipatch/multiblock&#x00A0;context,&#x00A0;this&#x00A0;gives&#x00A0;the&#x00A0;true&#x00A0;global&#x00A0;xyz&#x00A0;coordinates)&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;CCTK_REAL&#x00A0;xxcoord&#x00A0;=&#x00A0;/*&#x00A0;Grid::&#x00A0;*/&#x00A0;x[posn];
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;CCTK_REAL&#x00A0;yycoord&#x00A0;=&#x00A0;/*&#x00A0;Grid::&#x00A0;*/&#x00A0;y[posn];
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;CCTK_REAL&#x00A0;zzcoord&#x00A0;=&#x00A0;/*&#x00A0;Grid::&#x00A0;*/&#x00A0;z[posn];
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;}
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;}
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;}
&#x00A0;<br />}
</div>
<!--l. 2074--><p class="nopar" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;C1.4: </span><span  
class="content">This figure shows two different ways to compute the global Cactus <span 
class="cmmi-10">xyz </span>coordinates of
the current grid point. Because the &#8220;alternate calculation&#8221; (the one one using <span 
class="cmtt-10">Grid::x</span>, <span 
class="cmtt-10">Grid::y</span>, and
<span 
class="cmtt-10">Grid::z</span>) gives the true global <span 
class="cmmi-10">xyz </span>coordinates even in a multipatch/multiblock context, this is generally
the preferred form for general use. </span></div><!--tex4ht:label?: x13-1030014 -->
                                                                                       
                                                                                       
<!--l. 2084--><p class="noindent" ></div><hr class="endfigure">
<h5 class="subsubsectionHead"><a 
 id="x13-104000C1.6.2"></a>Cactus Data Types</h5>
<!--l. 2088--><p class="noindent" >To provide portability across platforms, the Cactus grid variables and parameters are defined and declared using
Cactus data types. The most important of these data types are described below, for a full description see
Section&#x00A0;<a 
href="#x13-148000C1.9.8">C1.9.8<!--tex4ht:ref: sec:datyansi --></a>. These data types should be used to declare local variables where needed, and to declare Cactus
grid variables or parameters that need declarations.
<!--l. 2096--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT</span>          </dt><dd 
class="list">
                  <!--l. 2098--><p class="noindent" >default size 4 bytes
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL</span>         </dt><dd 
class="list">
                  <!--l. 2099--><p class="noindent" >default size 8 bytes
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX</span>      </dt><dd 
class="list">
                  <!--l. 2100--><p class="noindent" >consists of two <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL </span>elements
                  </dd></dl>
<!--l. 2104--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-105000C1.6.2"></a><span 
class="cmbx-10">Example</span></span>
In the following example, <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">MyScalar</span></span></span> is a grid scalar which is declared in the <span 
class="cmtt-10">interface.ccl </span>as
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL</span>.
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-36">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;subroutine&#x00A0;InitialData(CCTK_ARGUMENTS)
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;DECLARE_CCTK_ARGUMENTS
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;CCTK_REAL&#x00A0;local_var
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;local_var&#x00A0;=&#x00A0;1.0/3.0
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;MyScalar&#x00A0;=&#x00A0;local_var
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;return
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;end
</div>
<!--l. 2121--><p class="nopar" > Declaring <span 
class="cmtt-10">local</span><span 
class="cmtt-10">_var </span>to have a non-Cactus data type, e.g.&#x00A0;<span 
class="cmtt-10">REAL*4</span>, or using one of the other Cactus real data
types described in Section&#x00A0;<a 
href="#x13-148000C1.9.8">C1.9.8<!--tex4ht:ref: sec:datyansi --></a>, could give problems for different architectures or configurations.
<!--l. 2128--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-106000C1.6.2"></a>Staggering</h5>
<!--l. 2131--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-107000C1.6.2"></a><span 
class="cmbx-10">Indexing, ghostzones, etc.</span></span>
Note that staggering does not make any changes to the indexing of a grid function: the black solid circles in
diagram <a 
href="#x13-1080015">C1.5<!--tex4ht:ref: fig:stagger2 --></a> and their associated staggered grid functions (connected by arrows) have the same
index!
<!--l. 2136--><p class="noindent" >Since the grid function does not &#8220;know&#8221; anything about the physical location (it&#8217;s only addressed by indices),
why add staggering if the indexing is the same?
<!--l. 2140--><p class="noindent" >Indeed, you could roll your own, but there compelling reasons: Readability and the fact that you are able to
query the staggertype of a grid function. More important: In the way the grid is laid out, there is one grid point
<span 
class="cmti-10">less </span>for <span 
class="cmtt-10">M </span>and <span 
class="cmtt-10">P </span>staggered grid functions. This is illustrated in Figure <a 
href="#x13-1080015">C1.5<!--tex4ht:ref: fig:stagger2 --></a>, which shows 15 gridpoints
distributed across 3 processors. The solid black circles show the default location of the grid functions, the grey
circles depict the ghostzones. Note that the number of center staggered gridpoints (fat crosses) corresponds to
the number of default gridpoints on all processors but the last one. (The same is true for full staggered
gridpoints).
<!--l. 2151--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-108000C1.6.2"></a><span 
class="cmbx-10">Staggertypes</span></span>
The string specifying the staggering is encoded in a number called the <span 
class="cmti-10">staggerindex</span>. With the 3 supported
                                                                                       
                                                                                       
staggerings, the string is converted into a base 3 number. Several routines exist to extract the staggering in a
specific direction, called <span 
class="cmti-10">directional staggerindex</span>. For example, <span 
class="cmtt-10">stagger = MCM</span>: <span 
class="cmti-10">staggerindex </span>= 3, in the
<span 
class="cmmi-10">x</span>-direction: <span 
class="cmti-10">directional staggerindex </span>= <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STAGGER</span><span 
class="cmtt-10">_M </span>(value 0), in the <span 
class="cmmi-10">y</span>-direction: <span 
class="cmti-10">directional staggerindex </span>=
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STAGGER</span><span 
class="cmtt-10">_C </span>(value 1).
<!--l. 2161--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STAGGER</span><span 
class="cmtt-10">_M</span>    </dt><dd 
class="list">
                  <!--l. 2162--><p class="noindent" >value used for M-type staggering
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STAGGER</span><span 
class="cmtt-10">_C</span>    </dt><dd 
class="list">
                  <!--l. 2163--><p class="noindent" >value used for C-type staggering
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STAGGER</span><span 
class="cmtt-10">_P</span>    </dt><dd 
class="list">
                  <!--l. 2164--><p class="noindent" >value used for P-type staggering
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_NO</span><span 
class="cmtt-10">_STAGGER</span>   </dt><dd 
class="list">
                  <!--l. 2165--><p class="noindent" >value to indicate no staggering
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STAGGER</span>      </dt><dd 
class="list">
                  <!--l. 2166--><p class="noindent" >value to indicate staggering
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_NSTAGGER</span>     </dt><dd 
class="list">
                  <!--l. 2167--><p class="noindent" >number of coded staggerings (3)</dd></dl>
<!--l. 2172--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                       
                                                                                       
<a 
 id="x13-1080015"></a>
                                                                                       
                                                                                       
<div class="center" 
>
<!--l. 2174--><p class="noindent" >
<!--l. 2175--><p class="noindent" ><img 
src="UsersGuide6x.png" alt="PIC" class="graphics" width="687.56874pt" height="503.8825pt" ><!--tex4ht:graphics  
name="UsersGuide6x.png" src="staggering2.ps"  
--></div>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;C1.5: </span><span  
class="content"><span 
class="cmbx-9">Unstaggered and center-staggered gridpoints </span><span 
class="cmr-9">with ghostzone size of one (above) and two</span>
<span 
class="cmr-9">(below). The points are distributed across three processors. Note that the number of center staggered gridpoints</span>
<span 
class="cmr-9">(fat crosses) is one less on the outermost grid. How to treat this case in an easy way is explained in the text. </span></span></div><!--tex4ht:label?: x13-1080015 -->
                                                                                       
                                                                                       
<!--l. 2183--><p class="noindent" ></div><hr class="endfigure">
<!--l. 2185--><p class="noindent" >When a thorn programmer uses staggered gridpoints, he has to be aware of this gridpoint anomaly. This can be
done most easily by using the <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_LSSH(&#x003C;</span><span 
class="cmsltt-10">dir</span><span 
class="cmsltt-10">_staggertype</span><span 
class="cmtt-10">&#x003E;,&#x003C;</span><span 
class="cmsltt-10">direction</span><span 
class="cmtt-10">&#x003E;) </span>macro. For a given staggertype
and direction, this 2D array returns the local number of gridpoints, including ghostzones and the necessary
change for the staggering on the outermost processor.
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_LSSH(&#x003C;</span><span 
class="cmsltt-10">dir</span><span 
class="cmsltt-10">_staggertype</span><span 
class="cmtt-10">&#x003E;,&#x003C;</span><span 
class="cmsltt-10">direction</span><span 
class="cmtt-10">&#x003E;)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2193--><p class="noindent" >for a given staggertype and a direction, this macro returns the number of processor
                  local gridpoints, including ghostzones.
                      <ul class="itemize1">
                      <li class="itemize">For Fortran users, the macro has to be in capital letters
                      </li>
                      <li class="itemize">This  macro  is  C/Fortran  indexing  aware:  can  specify  the  dimension  in  C
                      ranging from 0<span 
class="cmmi-10">&#x2026;</span> and in Fortran ranging from 1<span 
class="cmmi-10">&#x2026;</span>.</li></ul>
                  </dd></dl>
<!--l. 2206--><p class="noindent" >Several functions exist to derive the staggertype for a given group and for a certain direction.
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">int CCTK</span><span 
class="cmtt-10">_GroupStaggerIndexGI(int </span><span 
class="cmsltt-10">group</span><span 
class="cmsltt-10">_index</span><span 
class="cmtt-10">)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2209--><p class="noindent" >
                  </dd><dt class="list">
<span 
class="cmtt-10">call CCTK</span><span 
class="cmtt-10">_GroupStaggerIndexGI(int </span><span 
class="cmsltt-10">staggerindex</span><span 
class="cmtt-10">, int </span><span 
class="cmsltt-10">group</span><span 
class="cmsltt-10">_index</span><span 
class="cmtt-10">)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2212--><p class="noindent" >returns the <span 
class="cmsltt-10">staggerindex </span>for a given group index.</dd></dl>
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">int CCTK</span><span 
class="cmtt-10">_GroupStaggerIndexGN(char *</span><span 
class="cmsltt-10">group</span><span 
class="cmsltt-10">_name</span><span 
class="cmtt-10">)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2217--><p class="noindent" >
                  </dd><dt class="list">
<span 
class="cmtt-10">call CCTK</span><span 
class="cmtt-10">_GroupStaggerIndexGN(int </span><span 
class="cmsltt-10">staggerindex</span><span 
class="cmtt-10">, char *</span><span 
class="cmsltt-10">group</span><span 
class="cmsltt-10">_name</span><span 
class="cmtt-10">)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2219--><p class="noindent" >returns the <span 
class="cmsltt-10">staggerindex </span>for a given group name.
                  </dd></dl>
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">int CCTK</span><span 
class="cmtt-10">_StaggerIndex(char *</span><span 
class="cmsltt-10">stagger</span><span 
class="cmsltt-10">_string</span><span 
class="cmtt-10">)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2244--><p class="noindent" >
                                                                                       
                                                                                       
                  </dd><dt class="list">
<span 
class="cmtt-10">call CCTK</span><span 
class="cmtt-10">_StaggerIndex(int </span><span 
class="cmsltt-10">staggerindex</span><span 
class="cmtt-10">, char *</span><span 
class="cmsltt-10">stagger</span><span 
class="cmsltt-10">_string</span><span 
class="cmtt-10">)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2246--><p class="noindent" >return the <span 
class="cmsltt-10">staggerindex </span>for a given stagger string.</dd></dl>
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">int CCTK</span><span 
class="cmtt-10">_DirStaggerIndex(int </span><span 
class="cmsltt-10">direction</span><span 
class="cmtt-10">, char *</span><span 
class="cmsltt-10">stagger</span><span 
class="cmsltt-10">_string</span><span 
class="cmtt-10">)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2251--><p class="noindent" >
                  </dd><dt class="list">
<span 
class="cmtt-10">call CCTK</span><span 
class="cmtt-10">_DirStaggerIndex(int </span><span 
class="cmsltt-10">dir</span><span 
class="cmsltt-10">_staggerindex</span><span 
class="cmtt-10">, int </span><span 
class="cmsltt-10">direction</span><span 
class="cmtt-10">, char *</span><span 
class="cmsltt-10">stagger</span><span 
class="cmsltt-10">_string</span><span 
class="cmtt-10">)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2254--><p class="noindent" >returns the <span 
class="cmsltt-10">directional staggerindex </span>for a given direction and stagger string.</dd></dl>
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">int CCTK</span><span 
class="cmtt-10">_DirStaggerIndexI(int </span><span 
class="cmsltt-10">direction</span><span 
class="cmtt-10">, char *</span><span 
class="cmsltt-10">stagger</span><span 
class="cmsltt-10">_type</span><span 
class="cmtt-10">)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2261--><p class="noindent" >
                  </dd><dt class="list">
<span 
class="cmtt-10">call CCTK</span><span 
class="cmtt-10">_DirStaggerIndexI(int </span><span 
class="cmsltt-10">dir</span><span 
class="cmsltt-10">_direction</span><span 
class="cmtt-10">, char *</span><span 
class="cmsltt-10">stagger</span><span 
class="cmsltt-10">_type</span><span 
class="cmtt-10">)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2264--><p class="noindent" >returns the <span 
class="cmsltt-10">directional staggerindex </span>for a given direction and staggerindex.
                  </dd></dl>
<h4 class="subsectionHead"><span class="titlemark">C1.6.3   </span> <a 
 id="x13-109000C1.6.3"></a>Parallelisation</h4>
<!--l. 2275--><p class="noindent" >The flesh itself does not actually set up grid variables. This is done by a <span 
class="cmti-10">driver </span>thorn. To allow the distribution
of a grid over a number of processors, the driver thorn must also provide the grid decomposition, and
routines to enable parallelisation. The method used to provide this parallelisation (e.g.&#x00A0;MPI, PVM)
is not usually important for the thorn writer, since the driver thorn provides routines which are
called by standard interfaces from the flesh. Here, we describe briefly the most important of these
routines for the application thorn writer. A more detailed description of these interfaces with their
arguments, is given in the Reference Manual. A complete description of the routines that a driver
thorn must provide, will be provided in the Infrastructure Thorn Writers Guide (Part <a 
href="UsersGuidech10.html#x14-155000C2">C2<!--tex4ht:ref: chap:infrastructure --></a>). The
standard driver thorn is currently <span 
class="cmtt-10">PUGH </span>in the <span 
class="cmtt-10">CactusPUGH </span>package, which is a parallel unigrid
driver.
<!--l. 2291--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_nProcs</span>       </dt><dd 
class="list">
                  <!--l. 2292--><p class="noindent" >Returns the number of processors being used
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_MyProc</span>       </dt><dd 
class="list">
                  <!--l. 2293--><p class="noindent" >Returns the processor number (this starts at processor number zero)
                                                                                       
                                                                                       
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_SyncGroup, CCTK</span><span 
class="cmtt-10">_SyncGroupsI</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2295--><p class="noindent" >Synchronises either a single group or a set of groups of grid arrays by exchanging the
                  values held in each processor ghostzones, with the physical values of their neighbours
                  (see the Reference Manual)
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Barrier</span>      </dt><dd 
class="list">
                  <!--l. 2299--><p class="noindent" >Waits for all processors to reach this point before proceeding</dd></dl>
<!--l. 2306--><p class="noindent" >
<h3 class="sectionHead"><span class="titlemark">C1.7   </span> <a 
 id="x13-110000C1.7"></a>Cactus Application Interfaces</h3>
<!--l. 2310--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.7.1   </span> <a 
 id="x13-111000C1.7.1"></a>Coordinates</h4>
<!--l. 2313--><p class="noindent" >The flesh provides utility routines for registering and querying coordinate information. The flesh does not
provide any coordinates itself, these must be supplied by a thorn. Thorns are not required to register coordinates
to the flesh, but registering coordinates provides a means for infrastructure thorns to make use of coordinate
information.
<!--l. 2320--><p class="noindent" >Coordinates are grouped into <span 
class="cmti-10">coordinate systems</span>, which have a specified dimension. Any number of coordinate
systems can be registered with the flesh, and a coordinate system must be registered before any coordinates
can be registered, since they must be associated with their corresponding system. Coordinates
can be registered, with any chosen name, with an existing coordinate system, along with their
direction or index in the coordinate system. Optionally, the coordinate can also be associated with a
given grid variable. A separate call can register the global range for a coordinate on a given grid
hierarchy.
<!--l. 2331--><p class="noindent" >Following conventions for coordinate system and coordinate names, provides a means for other thorns to use the
physical properties of coordinate systems, without being tied to a particular thorn.
<!--l. 2335--><p class="noindent" >A registered coordinate system can be referred to by either its name or an associated integer known as a
<span 
class="cmti-10">handle</span>. Passing a handle instead of the name string may be necessary for calling C routines from
Fortran.
<!--l. 2340--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-112000C1.7.1"></a>Registering Coordinates and Coordinate Properties</h5>
<!--l. 2345--><p class="noindent" ><span 
class="cmbx-10">The APIs described in this section are deprecated, and will probably be phased out fairly soon.</span>
                                                                                       
                                                                                       
<span 
class="cmbx-10">New code should use the APIs provided by the </span><span 
class="cmtt-10">CoordBase </span><span 
class="cmbx-10">thorn instead (this lives in the</span>
<span 
class="cmtt-10">CactusBase </span><span 
class="cmbx-10">arrangement).</span>
<!--l. 2347--><p class="noindent" >Coordinate systems and their properties can be registered at any time with the flesh. The registration utilities
for thorns providing coordinates are:
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CoordRegisterSystem</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2351--><p class="noindent" >
                  <!--l. 2353--><p class="noindent" >Assigns a coordinate system with a chosen name and dimension. For example, a
                  3-dimensional Cartesian coordinate system could be registered with the name <span 
class="cmtt-10">cart3d </span>using
                  the call from C
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-37">
                  int&#x00A0;ierr;
                  &#x00A0;<br />int&#x00A0;dim=3;
                  &#x00A0;<br />ierr&#x00A0;=&#x00A0;CCTK_CoordRegisterSystem(dim,"cart3d");
</div>
                  <!--l. 2361--><p class="nopar" >
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CoordRegisterData</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2363--><p class="noindent" >
                  <!--l. 2365--><p class="noindent" >Defines a coordinate in a given coordinate system, with a given direction and name, and
                  optionally associates it to a grid variable. The directions of the coordinates range
                  from 1 to the dimension of the coordinate system. For example, to register
                  the grid variable <span 
class="cmtt-10">grid::y3d </span>to have the coordinate name <span 
class="cmtt-10">y </span>in the <span 
class="cmtt-10">cart3d</span>
                  system
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-38">
                  int&#x00A0;ierr;
                  &#x00A0;<br />int&#x00A0;dir=2;
                  &#x00A0;<br />ierr&#x00A0;=&#x00A0;CCTK_CoordRegisterData(dir,"grid::y3d","y","cart3d");
</div>
                  <!--l. 2375--><p class="nopar" >
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CoordRegisterRange</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2377--><p class="noindent" >
                  <!--l. 2379--><p class="noindent" >Assigns the global computational maximum and minimum for a coordinate on a grid
                  hierarchy, that is in a <span 
class="cmtt-10">cctkGH</span>. At this time the maximum and minimum values have to be
                  of type <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL</span>. For example, if the <span 
class="cmtt-10">y </span>coordinate for the <span 
class="cmtt-10">cart3d </span>system ranges between
                  zero and one
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-39">
                  CCTK_REAL&#x00A0;lower=0;
                  &#x00A0;<br />CCTK_REAL&#x00A0;upper=1;
                  &#x00A0;<br />int&#x00A0;ierr;
                  &#x00A0;<br />ierr&#x00A0;=&#x00A0;CCTK_CoordRegisterRange(cctkGH,&#x00A0;lower,&#x00A0;upper,&#x00A0;-1,&#x00A0;"y",&#x00A0;"cart3d");
</div>
                  <!--l. 2390--><p class="nopar" > Note that the API allows either the coordinate name or the direction to be used, so that
                  the following is also valid
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-40">
                  CCTK_REAL&#x00A0;lower=0;
                  &#x00A0;<br />CCTK_REAL&#x00A0;upper=1;
                  &#x00A0;<br />int&#x00A0;ierr;
                  &#x00A0;<br />ierr&#x00A0;=&#x00A0;CCTK_CoordRegisterRange(cctkGH,&#x00A0;lower,&#x00A0;upper,&#x00A0;2,&#x00A0;NULL,&#x00A0;"cart3d");
</div>
                  <!--l. 2400--><p class="nopar" >
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CoordRegisterPhysIndex</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2402--><p class="noindent" >
                  <!--l. 2404--><p class="noindent" >Implementing such things as symmetry properties for a grid leads to the need to know the
                  details of the <span 
class="cmti-10">physical </span>section of a grid. Such information is typically needed
                  by I/O thorns. The following call illustrates how to register the indices 3
                  and 25 as supplying the physical range of the <span 
class="cmtt-10">y </span>coordinate in the <span 
class="cmtt-10">cart3d</span>
                  system
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-41">
                  int&#x00A0;loweri=3;
                  &#x00A0;<br />int&#x00A0;upperi=25;
                  &#x00A0;<br />int&#x00A0;ierr;
                  &#x00A0;<br />ierr&#x00A0;=&#x00A0;CCTK_CoordRegisterPhysIndex(cctkGH,&#x00A0;loweri,&#x00A0;upperi,&#x00A0;-1,&#x00A0;"y",&#x00A0;"cart3d");
</div>
                  <!--l. 2416--><p class="nopar" >
                  </dd></dl>
<!--l. 2422--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-113000C1.7.1"></a>Using Coordinates</h5>
<!--l. 2427--><p class="noindent" ><span 
class="cmbx-10">The APIs described in this section are deprecated, and will probably be phased out fairly soon.</span>
<span 
class="cmbx-10">New code should use the APIs provided by the </span><span 
class="cmtt-10">CoordBase </span><span 
class="cmbx-10">thorn instead (this lives in the</span>
<span 
class="cmtt-10">CactusBase </span><span 
class="cmbx-10">arrangement).</span>
<!--l. 2429--><p class="noindent" >The utilities for thorns using coordinates are:
<!--l. 2431--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_NumCoordSystems</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2433--><p class="noindent" >
                  <!--l. 2435--><p class="noindent" >Returns the number of coordinate systems registered with the flesh. For example,
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-42">
                  int&#x00A0;num;
                  &#x00A0;<br />num&#x00A0;=&#x00A0;CCTK_NumCoordSystems();
</div>
                  <!--l. 2440--><p class="nopar" >
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CoordSystemName</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2442--><p class="noindent" >
                  <!--l. 2444--><p class="noindent" >Provides the name of a registered coordinate system, given the integer handle
                  (or index) for the system in the flesh&#8217;s coordinate data base. Note that the
                  handle ranges between zero and the number of coordinate systems minus one:
                  0 <span 
class="cmsy-10">&#x2264;</span> handle <span 
class="cmsy-10">&#x2264;</span> <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_NumCoordSystems()</span><span 
class="cmsy-10">- </span>1. It is important to remember that the handle
                  given to a coordinate system depends on the order in which systems are registered, and can
                  be different from one simulation to the next.
                  <!--l. 2451--><p class="noindent" >For example, to print the names of all registered coordinate systems:
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-43">
                  for&#x00A0;(i=0;&#x00A0;i&#x003C;CCTK_NumCoordSystems();&#x00A0;i++)
                  &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;printf("%s&#x00A0;",CCTK_CoordSystemNName(i));
</div>
                  <!--l. 2456--><p class="nopar" >
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CoordSystemDim</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2458--><p class="noindent" >
                  <!--l. 2460--><p class="noindent" >Provides the dimension of a coordinate system. For example, if the <span 
class="cmtt-10">cart3d </span>system was
                  registered as having 3 dimensions, the variable <span 
class="cmtt-10">dim </span>below will now be set to
                  3,
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-44">
                  int&#x00A0;dim;
                  &#x00A0;<br />dim&#x00A0;=&#x00A0;CCTK_CoordSystemDim("cart3d");
</div>
                  <!--l. 2467--><p class="nopar" >
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CoordSystemHandle</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2469--><p class="noindent" >
                  <!--l. 2471--><p class="noindent" >Provides the integer handle for a given coordinate system name. The handle describes
                  the index for the coordinate system in the flesh coordinate database, and its
                  value will range between zero and the number of registered systems minus
                  one. For example, the handle for the <span 
class="cmtt-10">cart3d </span>coordinate system can be found
                  using
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-45">
                  int&#x00A0;handle;
                  &#x00A0;<br />handle&#x00A0;=&#x00A0;CCTK_CoordSystemHandle("cart3d");
</div>
                  <!--l. 2479--><p class="nopar" >
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CoordSystemName</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2481--><p class="noindent" >
                  <!--l. 2483--><p class="noindent" >The inverse to the previous function call. This provides the name for a given coordinate
                  system handle. For example, to find the first coordinate system in the flesh
                  database
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-46">
                  int&#x00A0;handle&#x00A0;=&#x00A0;0;
                  &#x00A0;<br />const&#x00A0;char&#x00A0;*name&#x00A0;=&#x00A0;CCTK_CoordSystemName(handle);
</div>
                  <!--l. 2489--><p class="nopar" >
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CoordIndex</span>   </dt><dd 
class="list">
                  <!--l. 2491--><p class="noindent" >
                  <!--l. 2493--><p class="noindent" >Provides the grid variable index for a given coordinate. Note that it is not necessary for a
                  registered coordinate to have an associated grid variable, and if no such grid variable is
                  found, a negative integer will be returned. For example, to find the grid variable index
                  associated with the <span 
class="cmtt-10">y </span>coordinate of the <span 
class="cmtt-10">cart3d </span>system, either of the two following calls
                  could be made
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-47">
                  int&#x00A0;index;
                  &#x00A0;<br />index&#x00A0;=&#x00A0;CCTK_CoordIndex(2,NULL,"cart3d");
</div>
                  <!--l. 2503--><p class="nopar" >
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-48">
                  int&#x00A0;index;
                  &#x00A0;<br />index&#x00A0;=&#x00A0;CCTK_CoordIndex(-1,"y","cart3d");
</div>
                  <!--l. 2508--><p class="nopar" >
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CoordDir</span>     </dt><dd 
class="list">
                  <!--l. 2511--><p class="noindent" >
                  <!--l. 2513--><p class="noindent" >Provides the direction for a given coordinate. Directions are integers ranging from one to
                  the number of dimensions for the coordinate system. For example, to return the direction
                  of the <span 
class="cmtt-10">y </span>coordinate in the <span 
class="cmtt-10">cart3d </span>system
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-49">
                  int&#x00A0;dir;
                  &#x00A0;<br />dir&#x00A0;=&#x00A0;CCTK_CoordDir("y","cart3d");
</div>
                  <!--l. 2521--><p class="nopar" >
                  <!--l. 2523--><p class="noindent" >The return of a negative integer indicates that the coordinate direction could not be
                  found.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CoordRange</span>   </dt><dd 
class="list">
                  <!--l. 2526--><p class="noindent" >
                  <!--l. 2528--><p class="noindent" >Provides the global range (that is, the minimum and maximum values across the complete
                  grid) of a coordinate on a given grid hierarchy. The minimum and maximum values must
                  be of type <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL</span>. The coordinate can be specified either by name or by its direction.
                  Note that this call takes the <span 
class="cmti-10">addresses </span>of the minimum and maximum values. For example,
                  the range of the <span 
class="cmtt-10">y </span>coordinate of the <span 
class="cmtt-10">cart3d </span>coordinate system can be found
                  using
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-50">
                  CCTK_REAL&#x00A0;lower,&#x00A0;upper;
                  &#x00A0;<br />int&#x00A0;ierr;
                  &#x00A0;<br />ierr&#x00A0;=&#x00A0;CCTK_CoordRange(cctkGH,&#x00A0;&amp;lower,&#x00A0;&amp;upper,&#x00A0;-1,&#x00A0;"y",&#x00A0;"cart3d");
</div>
                  <!--l. 2539--><p class="nopar" > or alternatively, using the direction
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-51">
                  CCTK_REAL&#x00A0;lower,&#x00A0;upper;
                  &#x00A0;<br />int&#x00A0;ierr;
                  &#x00A0;<br />ierr&#x00A0;=&#x00A0;CCTK_CoordRange(cctkGH,&#x00A0;&amp;lower,&#x00A0;&amp;upper,&#x00A0;2,&#x00A0;NULL,&#x00A0;"cart3d");
</div>
                  <!--l. 2546--><p class="nopar" >
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CoordLocalRange</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2549--><p class="noindent" >
                  <!--l. 2551--><p class="noindent" >Provides the local range of a coordinate on a processor for a given grid hierarchy.
                  WARNING: This utility only works for regular cartesian grids. For example, the local
                  processor range of the <span 
class="cmtt-10">y </span>coordinate of the <span 
class="cmtt-10">cart3d </span>coordinate system can be found
                  using
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-52">
                  CCTK_REAL&#x00A0;lower,&#x00A0;upper;
                  &#x00A0;<br />int&#x00A0;ierr;
                  &#x00A0;<br />ierr&#x00A0;=&#x00A0;CCTK_CoordLocalRange(cctkGH,&#x00A0;&amp;lower,&#x00A0;&amp;upper,&#x00A0;-1,&#x00A0;"y",&#x00A0;"cart3d");
</div>
                  <!--l. 2560--><p class="nopar" > or alternatively, using the direction
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-53">
                  CCTK_REAL&#x00A0;lower,&#x00A0;upper;
                  &#x00A0;<br />int&#x00A0;ierr;
                  &#x00A0;<br />ierr&#x00A0;=&#x00A0;CCTK_CoordLocalRange(cctkGH,&#x00A0;&amp;lower,&#x00A0;&amp;upper,&#x00A0;2,&#x00A0;NULL,&#x00A0;"cart3d");
</div>
                  <!--l. 2567--><p class="nopar" >
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CoordRangePhysIndex</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2569--><p class="noindent" >
                  <!--l. 2571--><p class="noindent" >For a given coordinate, provides the indices describing the <span 
class="cmti-10">physical </span>range of the coordinate.
                  A negative return value signifies that no such range was registered for the
                  coordinate.
                  <!--l. 2575--><p class="noindent" >This index range provides a mechanism for describing grid points which should not be
                  considered part of the simulation results (for example, grid points used for different
                  boundary conditions). The physical range of the <span 
class="cmtt-10">y </span>coordinate of the <span 
class="cmtt-10">cart3d </span>system can be
                  found using
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-54">
                  int&#x00A0;ilower,&#x00A0;iupper;
                  &#x00A0;<br />int&#x00A0;ierr;
                  &#x00A0;<br />ierr&#x00A0;=&#x00A0;CCTK_CoordRangePhysIndex(cctkGH,&amp;ilower,&amp;iupper,&#x00A0;-1,&#x00A0;"y",&#x00A0;"cart3d");
</div>
                  <!--l. 2584--><p class="nopar" > or using the coordinate direction
                                                                                       
                                                                                       
                  <div class="verbatim" id="verbatim-55">
                  int&#x00A0;ilower,&#x00A0;iupper;
                  &#x00A0;<br />int&#x00A0;ierr;
                  &#x00A0;<br />ierr&#x00A0;=&#x00A0;CCTK_CoordRangePhysIndex(cctkGH,&amp;ilower,&amp;iupper,&#x00A0;2,&#x00A0;NULL,&#x00A0;"cart3d");
</div>
                  <!--l. 2590--><p class="nopar" >
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_CoordSystemImplementation</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2592--><p class="noindent" >
                  <!--l. 2594--><p class="noindent" >This call returns the name of the implementation which registered a coordinate system.
                  Note that there is no guarantee that a thorn, which registered a coordinate system, is the
                  same thorn which registers each of the coordinates in the system, although this should
                  usually be the case.
                  </dd></dl>
<!--l. 2603--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.7.2   </span> <a 
 id="x13-114000C1.7.2"></a>I/O</h4>
<!--l. 2606--><p class="noindent" >To allow flexible I/O, the flesh itself does not provide any output routines, however it provides a mechanism for
thorns to register different routines as I/O methods (see Chapter <a 
href="UsersGuidech10.html#x14-173000C2.7">C2.7<!--tex4ht:ref: chap:io_methods --></a>). Application thorns can interact with the
different I/O methods through the following function calls:
     <dl class="description"><dt class="description">
 </dt><dd 
class="description"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_OutputGH (const cGH *</span><span 
class="cmsltt-10">GH</span><span 
class="cmtt-10">)</span>
     <!--l. 2616--><p class="noindent" >This call loops over all registered I/O methods, calling the routine that each method has registered
     for <span class="obeylines-h"><span 
class="cmtt-10">OutputGH</span></span>. The expected behaviour of any <span class="obeylines-h"><span 
class="cmtt-10">OutputGH</span></span> routine is to loop over all GH variables,
     outputting them if the I/O method contains appropriate routines (that is, not all methods will
     supply  routines  to  output  all  different  types  of  variables),  and  if  the  method  decides  it  is  an
     appropriate time to output.
     </dd><dt class="description">
 </dt><dd 
class="description"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_OutputVar (const cGH *</span><span 
class="cmsltt-10">GH</span><span 
class="cmtt-10">, const char *</span><span 
class="cmsltt-10">varname</span><span 
class="cmtt-10">)</span>
     <!--l. 2626--><p class="noindent" >Outputs a variable <span 
class="cmsltt-10">varname </span>looping over all registered I/O methods. <span 
class="cmsltt-10">varname </span>may have an optional
     I/O option string appended. The output should take place if at all possible. If output goes into a
     file and the appropriate file exists, the data is appended, otherwise a new file is created.
     </dd><dt class="description">
 </dt><dd 
class="description"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_OutputVarAs (const cGH *</span><span 
class="cmsltt-10">GH</span><span 
class="cmtt-10">, const char *</span><span 
class="cmsltt-10">varname</span><span 
class="cmtt-10">, const char *</span><span 
class="cmsltt-10">alias</span><span 
class="cmtt-10">)</span>
     <!--l. 2634--><p class="noindent" >Outputs a variable <span 
class="cmsltt-10">varname </span>looping over all registered I/O methods. <span 
class="cmsltt-10">varname </span>may have an optional
     I/O option string appended. The output should take place if at all possible. If output goes into a
     file and the appropriate file exists, the data is appended, otherwise a new file is created. Uses <span 
class="cmsltt-10">alias</span>
     as the name of the variable for the purpose of constructing a filename.
                                                                                       
                                                                                       
     </dd><dt class="description">
 </dt><dd 
class="description"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_OutputVarByMethod (const cGH *</span><span 
class="cmsltt-10">GH</span><span 
class="cmtt-10">, const char *</span><span 
class="cmsltt-10">varname</span><span 
class="cmtt-10">, const char *</span><span 
class="cmsltt-10">methodname</span><span 
class="cmtt-10">)</span>
     <!--l. 2643--><p class="noindent" >Outputs a variable <span 
class="cmsltt-10">varname </span>using the I/O method <span 
class="cmsltt-10">methodname </span>if it is registered. <span 
class="cmsltt-10">varname </span>may
     have an optional I/O option string appended. The output should take place if at all possible. If
     output goes into a file and the appropriate file exists, the data is appended, otherwise a new file is
     created.
     </dd><dt class="description">
 </dt><dd 
class="description"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_OutputVarAsByMethod (const cGH *</span><span 
class="cmsltt-10">GH</span><span 
class="cmtt-10">, const char *</span><span 
class="cmsltt-10">varname</span><span 
class="cmtt-10">, const char *</span><span 
class="cmsltt-10">methodname</span><span 
class="cmtt-10">,</span><br 
class="newline" /><span 
class="cmtt-10">const char *</span><span 
class="cmsltt-10">alias</span><span 
class="cmtt-10">)</span>
     <!--l. 2654--><p class="noindent" >Outputs a variable <span 
class="cmsltt-10">varname </span>using the I/O method <span 
class="cmsltt-10">methodname </span>if it is registered. <span 
class="cmsltt-10">varname </span>may
     have an optional I/O option string appended. The output should take place if at all possible. If
     output goes into a file and the appropriate file exists, the data is appended, otherwise a new file is
     created. Uses <span 
class="cmsltt-10">alias </span>as the name of the variable for the purpose of constructing a filename.
     </dd></dl>
<!--l. 2665--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.7.3   </span> <a 
 id="x13-115000C1.7.3"></a>Interpolation Operators</h4>
<!--l. 2668--><p class="noindent" >The flesh does not provide interpolation routines by itself. Instead, it offers a general function API to thorns, for
the registration and invocation of interpolation operators.
<!--l. 2672--><p class="noindent" >There are two different flesh APIs for interpolation, depending on whether the data arrays are Cactus grid arrays
or processor-local, programming language built-in arrays, and on what assumptions are made about the topology
and spacing of the grid (these descriptions are for 3D, but the generalisations to other numbers of dimensions
should be obvious):
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_InterpGridArrays()</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2679--><p class="noindent" >Interpolates Cactus grid arrays, with the topology of the grid implicitly specified
                  by a Cactus coordinate system.
                  <!--l. 2683--><p class="noindent" >This API doesn&#8217;t provide an interpolation functionality itself, it only takes care
                  of the interprocessor communication necessary when interpolating distributed grid
                  arrays, and invokes the <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_InterpLocalUniform() </span>API on the each processor&#8217;s
                  local patch of the data.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_InterpLocalUniform()</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2688--><p class="noindent" >Interpolates processor-local arrays with <span 
class="cmti-10">uniformly </span>spaced data points, i.e. where the
                  coordinates&#x00A0;<span 
class="cmmi-10">xyz </span>are related to the integer array subscripts&#x00A0;<span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">ijk</span></span></span> by <span 
class="cmti-10">linear</span>
                  functions
                  <div class="flushleft" 
>
<!--l. 2693--><p class="noindent" >
 <span 
class="cmmi-10">x </span>= <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">origin</span></span></span><sub><span 
class="cmmi-7">x</span></sub> + <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">delta</span></span></span><sub><span 
class="cmmi-7">x</span></sub><span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">i</span></span></span><br />
                                                                                       
                                                                                       
<span 
class="cmmi-10">y </span>= <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">origin</span></span></span><sub><span 
class="cmmi-7">y</span></sub> + <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">delta</span></span></span><sub><span 
class="cmmi-7">y</span></sub><span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">j</span></span></span><br />
<span 
class="cmmi-10">z </span>= <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">origin</span></span></span><sub><span 
class="cmmi-7">z</span></sub> + <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">delta</span></span></span><sub><span 
class="cmmi-7">z</span></sub><span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">k</span></span></span></div>
                  <!--l. 2698--><p class="noindent" >where the caller specifies the <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">origin</span></span></span> and <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">delta</span></span></span> values.</dd></dl>
<!--l. 2728--><p class="noindent" >The flesh provides an API to register local interpolation operators:
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_InterpRegisterOpLocalUniform()</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2730--><p class="noindent" >Register a <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">CCTK_InterpLocalUniform()</span></span></span> interpolation operator</dd></dl>
<!--l. 2738--><p class="noindent" >This is described in detail in the Reference Manual.
<!--l. 2740--><p class="noindent" >Each local interpolation operator is registered under a character string name; at registration, the name is
mapped to a unique integer handle, which may be used to refer to the operator. <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">CCTK_InterpHandle()</span></span></span> is used
to get the handle corresponding to a given character string name.
<!--l. 2759--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.7.4   </span> <a 
 id="x13-116000C1.7.4"></a>Reduction Operators</h4>
<!--l. 2762--><p class="noindent" >A reduction operation can be defined as an operation on variables distributed across multiple processor
resulting in a single number. Typical reduction operations are: sum, minimum/maximum value, and
boolean operations. A typical application is, for example, finding the maximum reduction from
processor local error estimates, therefore, making the previous processor local error known to all
processors.
<!--l. 2769--><p class="noindent" >The exchange of information across processors needs the functionality of a communication layer, e.g.
<span 
class="cmtt-10">CactusPUGH/PUGH</span>. For this reason, the reduction operation itself is not part of the flesh, instead, Cactus
(again) provides a registration mechanism for thorns to register routines they provide as reduction
operators. The different operators are identified by their name and/or a unique number, called a
<span 
class="cmti-10">handle</span>.
<!--l. 2777--><p class="noindent" >The registration mechanism gives the advantage of a common interface while hiding the individual
communication calls in the layer.
<!--l. 2781--><p class="noindent" >In Cactus, reduction operators can be applied to grid functions, arrays and scalars, as well as to local arrays.
Note that different implementations of reduction operators may be limited in the objects they can be applied to.
There is a fundamental difference between the reduction operation on grid functions and quantities as
arrays.
<!--l. 2788--><p class="noindent" >Currently the flesh supports the new and old reduction specification. The old APIs will be deprecated in the
next beta cycle in favour of the new specification.
<!--l. 2792--><p class="noindent" ><span 
class="cmbx-10">New Reduction Specification API documentation</span>
<!--l. 2794--><p class="noindent" >In the new reduction specification, there are two different flesh APIs for reduction, depending on whether the
data arrays are Cactus grid arrays or processor-local, programming language built-in arrays, and on what
                                                                                       
                                                                                       
assumptions are made about the topology and spacing of the grid (these descriptions are for 3D, but the
generalisations to other numbers of dimensions should be obvious):
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ReduceGridArrays()</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2801--><p class="noindent" >Reduces Cactus grid arrays, with the topology of the grid implicitly specified by a
                  Cactus coordinate system.
                  <!--l. 2805--><p class="noindent" >This API doesn&#8217;t provide a reduction functionality itself, it only takes care of the
                  interprocessor communication necessary when reducing distributed grid arrays, and
                  invokes the <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ReduceLocalArrays() </span>API on the each processor&#8217;s local patch
                  of the data.
                  </dd><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ReduceLocalArrays()</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2810--><p class="noindent" >Reduces processor-local arrays with various options including <span 
class="cmti-10">offsets</span>, <span 
class="cmti-10">strides </span>and
                  <span 
class="cmti-10">masks</span>.</dd></dl>
<!--l. 2815--><p class="noindent" >The flesh provides an API to register local reduction operators:
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_RegisterLocalArrayReductionOperator()</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2817--><p class="noindent" >Register a <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">CCTK_ReduceLocalArrays()</span></span></span> interpolation operator</dd></dl>
<!--l. 2820--><p class="noindent" >This is described in detail in the Reference Manual.
<!--l. 2822--><p class="noindent" >Each local reduction operator is registered under a character string name; at registration, the name is mapped to
a unique integer handle, which may be used to refer to the operator. <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">CCTK_LocalArrayReductionHandle()</span></span></span> is
used to get the handle corresponding to a given character string name.
<!--l. 2828--><p class="noindent" ><span 
class="cmbx-10">Old Reduction Specification API Documentation</span>
<!--l. 2831--><p class="noindent" ><span 
class="cmbx-10">Obtaining the reduction handle</span>
<!--l. 2833--><p class="noindent" >Before calling the routine which performs the reduction operation, the handle, which identifies the operation,
must be derived from its registered name.
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-56">
&#x00A0;<br />int&#x00A0;CCTK_ReductionHandle(const&#x00A0;char&#x00A0;*reduction_name);
&#x00A0;<br />
&#x00A0;<br />integer&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;reduction_handle
&#x00A0;<br />character*(*)&#x00A0;reduction_name
&#x00A0;<br />call&#x00A0;CCTK_ReductionHandle(reduction_handle,&#x00A0;reduction_name)
&#x00A0;<br />
&#x00A0;<br />
&#x00A0;<br />int&#x00A0;CCTK_ReductionArrayHandle(const&#x00A0;char&#x00A0;*reduction_name);
&#x00A0;<br />
&#x00A0;<br />integer&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;reduction_handle
&#x00A0;<br />character*(*)&#x00A0;reduction_name
&#x00A0;<br />call&#x00A0;CCTK_ReductionArrayHandle(reduction_handle,&#x00A0;reduction_name)
&#x00A0;<br />
</div>
<!--l. 2852--><p class="nopar" >
<!--l. 2857--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">reduction</span><span 
class="cmtt-10">_handle</span>  </dt><dd 
class="list">
                  <!--l. 2858--><p class="noindent" >in Fortran, the name of the variable will contain the handle value after the call. In
                  C, this value is the function value.
                  </dd><dt class="list">
<span 
class="cmtt-10">reduction</span><span 
class="cmtt-10">_name</span>    </dt><dd 
class="list">
                  <!--l. 2862--><p class="noindent" >is the name under which the operator has been registered by the providing thorn.
                  The only thorn in the standard Computational Toolkit release, which provides
                  reduction operators, is <span 
class="cmtt-10">CactusPUGH/PUGHReduce</span>.
                  </dd><dt class="list">
<span 
class="cmss-10">error checking</span>       </dt><dd 
class="list">
                  <!--l. 2867--><p class="noindent" >negative handle value indicates failure to identify the correct operator.</dd></dl>
<!--l. 2872--><p class="noindent" >Get a integer handle corresponding to a given reduction operator. The operator is identified by the name it was
registered with. (Note that although it would appear to be far more convenient to pass the name of the
reduction operator directly to the following function call to <span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Reduce</span></span> this causes problems with the
translation of strings from Fortran to C with variable argument lists).
<!--l. 2883--><p class="noindent" ><span 
class="cmbx-10">The general reduction interface. </span>The main interfaces for reduction operations are quite powerful (and hence
rather complicated). To ease the use of these main interfaces, wrappers designed for specific and more restricted
use are described below. If uncertain, you should use these.
<!--l. 2889--><p class="noindent" ><div class="obeylines-v">
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-57">
<!--l. 2934--><p class="noindent" >
<!--l. 2934--><p class="noindent" >int&#x00A0;CCTK_Reduce(&#x00A0;const&#x00A0;cGH&#x00A0;*GH,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;proc,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;operation_handle,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;num_out_vals,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;type_out_vals,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;void&#x00A0;*out_vals,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;num_in_fields,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;...);
<!--l. 2934--><p class="noindent" >
<!--l. 2934--><p class="noindent" >
<!--l. 2934--><p class="noindent" >call&#x00A0;CCTK_Reduce(&#x00A0;int&#x00A0;returnvalue,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cctkGH,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;processor,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;operation_handle,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;num_out_vals,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;type_out_vals,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;out_vals,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;num_in_fields,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;...&#x00A0;)
<!--l. 2934--><p class="noindent" >
<!--l. 2934--><p class="noindent" >int&#x00A0;CCTK_ReduceArray(&#x00A0;&#x00A0;const&#x00A0;cGH&#x00A0;*GH,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;proc,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;operation_handle,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;num_out_vals,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;type_out_vals,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;void&#x00A0;*out_vals,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;num_dims,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;num_in_arrays,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;type_in_arrays,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;...&#x00A0;)
<!--l. 2934--><p class="noindent" >
<!--l. 2934--><p class="noindent" >call&#x00A0;CCTK_ReduceArray(int&#x00A0;returnvalue,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cctkGH,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;processor,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;operation_handle,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;num_out_vals,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;type_out_arrays,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;void&#x00A0;out_vals,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;num_dims,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;num_in_arrays,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;type_in_arrays,
<!--l. 2934--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;...&#x00A0;)
</div>
<!--l. 2934--><p class="nopar" ></div>
<!--l. 2937--><p class="noindent" >
                                                                                       
                                                                                       
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">int returnvalue</span>   </dt><dd 
class="list">
                  <!--l. 2938--><p class="noindent" >the  return  value  of  the  operation.  Negative  value  indicates  failure  to  perform
                  reduction. Zero indicates a successful operation.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctkGH</span>            </dt><dd 
class="list">
                  <!--l. 2942--><p class="noindent" >in Fortran, the pointer to the grid hierarchy structure. Can not be used within
                  Fortran, but can be used from within C. Since this name is fixed, write it out as
                  shown.
                  </dd><dt class="list">
<span 
class="cmtt-10">cGH *GH</span>           </dt><dd 
class="list">
                  <!--l. 2947--><p class="noindent" >in C, it is the pointer to the grid hierarchy.
                  </dd><dt class="list">
<span 
class="cmtt-10">int processor</span>     </dt><dd 
class="list">
                  <!--l. 2949--><p class="noindent" >the processor which collects the information, a negative value (<span 
class="cmsy-10">-</span>1) will distribute
                  the data to all processors.
                  </dd><dt class="list">
<span 
class="cmtt-10">int operation</span><span 
class="cmtt-10">_handle</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2953--><p class="noindent" >the  number  of  the  reduction  operation  handle,  needs  to  be  found  by  calling
                  <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ReductionHandle </span>or <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_ReductionArrayHandle</span>.
                  </dd><dt class="list">
<span 
class="cmtt-10">int num</span><span 
class="cmtt-10">_out</span><span 
class="cmtt-10">_vals</span>  </dt><dd 
class="list">
                  <!--l. 2956--><p class="noindent" >integer defining the number of output values.
                  </dd><dt class="list">
<span 
class="cmtt-10">int type</span><span 
class="cmtt-10">_out</span><span 
class="cmtt-10">_arrays</span><span 
class="cmss-10">, </span><span 
class="cmtt-10">type</span><span 
class="cmtt-10">_in</span><span 
class="cmtt-10">_arrays</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 2957--><p class="noindent" >specifies the type of the gridfunction you are communicating. Use the values as
                  specified in Section <a 
href="#x13-148000C1.9.8">C1.9.8<!--tex4ht:ref: sec:datyansi --></a>. Note: Do not mix data types, e.g. in Fortran, do not
                  declare a variable as <span 
class="cmtt-10">integer </span>and then specify the type <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_INT </span>in the
                  reduction command. These types need not be the same on some architectures and
                  will conflict.
                  </dd><dt class="list">
<span 
class="cmtt-10">out</span><span 
class="cmtt-10">_vals</span>          </dt><dd 
class="list">
                  <!--l. 2964--><p class="noindent" >an array that will contain the output values.
                  </dd><dt class="list">
<span 
class="cmtt-10">int num</span><span 
class="cmtt-10">_in</span><span 
class="cmtt-10">_fields</span> </dt><dd 
class="list">
                  <!--l. 2965--><p class="noindent" >specifies the number of input fields.
                  </dd><dt class="list">
<span 
class="cmtt-10">...</span>               </dt><dd 
class="list">
                  <!--l. 2966--><p class="noindent" >indicates a variable argument list: specify the arrays which will be reduced, the
                  number of specified arrays must be the same as the value of the <span 
class="cmtt-10">num</span><span 
class="cmtt-10">_in</span><span 
class="cmtt-10">_fields</span>
                  variable.
                                                                                       
                                                                                       
                  </dd><dt class="list">
<span 
class="cmbx-10">error checking</span>    </dt><dd 
class="list">
                  <!--l. 2969--><p class="noindent" >a return value, other than zero, indicates failure to perform the operation.</dd></dl>
<!--l. 2976--><p class="noindent" ><span 
class="cmbx-10">Special reduction interfaces. </span>The routines are designed for the purpose of reducing scalars, arrays and grid
functions. They hide many of the options of the generic interface described above.
<!--l. 2980--><p class="noindent" ><span 
class="cmbx-10">Reduction of local scalars across multiple processors. </span>The result of the reduction operation will be on the
specified processor or on all processors.
<!--l. 2983--><p class="noindent" ><div class="obeylines-v">
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-58">
<!--l. 2999--><p class="noindent" >int&#x00A0;CCTK_ReduceLocScalar&#x00A0;(const&#x00A0;cGH&#x00A0;*GH,
<!--l. 2999--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;processor,
<!--l. 2999--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;operation_handle,
<!--l. 2999--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;void&#x00A0;*in_scalar,
<!--l. 2999--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;void&#x00A0;*out_scalar,
<!--l. 2999--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;data_type)
<!--l. 2999--><p class="noindent" >
<!--l. 2999--><p class="noindent" >call&#x00A0;CCTK_ReduceLocScalar(int&#x00A0;returnvalue,
<!--l. 2999--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cctkGH,
<!--l. 2999--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;processor,
<!--l. 2999--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;operation_handle,
<!--l. 2999--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;in_scalar,
<!--l. 2999--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;out_scalar,
<!--l. 2999--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;data_type)
</div>
<!--l. 2999--><p class="nopar" ></div>
<!--l. 3001--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">in</span><span 
class="cmtt-10">_scalar</span>         </dt><dd 
class="list">
                  <!--l. 3002--><p class="noindent" >the processor local variable with local value to be reduced
                  </dd><dt class="list">
<span 
class="cmtt-10">out</span><span 
class="cmtt-10">_scalar</span>        </dt><dd 
class="list">
                  <!--l. 3003--><p class="noindent" >the reduction result: a processor local variable with the global value (same on all
                  processors), if <span 
class="cmtt-10">processor </span>has been set to <span 
class="cmsy-10">-</span>1. Otherwise, <span 
class="cmtt-10">processor </span>will hold the
                  reduction result.
                  </dd><dt class="list">
<span 
class="cmtt-10">data</span><span 
class="cmtt-10">_type</span>         </dt><dd 
class="list">
                  <!--l. 3006--><p class="noindent" >specifies the type of the gridfunction you are communicating. Use the values as
                  specified in Section <a 
href="#x13-148000C1.9.8">C1.9.8<!--tex4ht:ref: sec:datyansi --></a>.</dd></dl>
<!--l. 3014--><p class="noindent" ><span 
class="cmbx-10">Reduction of local 1d arrays to a local arrays. </span>This reduction is carried out element by element. The
arrays need to have the same size on all processors. <span class="obeylines-h">
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-59">
<!--l. 3035--><p class="noindent" >int&#x00A0;CCTK_ReduceLocArrayToArray1D(&#x00A0;const&#x00A0;cGH&#x00A0;*GH,
<!--l. 3035--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;processor,
<!--l. 3035--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;operation_handle,
<!--l. 3035--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;void&#x00A0;*in_array1d,
<!--l. 3035--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;void&#x00A0;*out_array1d,
<!--l. 3035--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;xsize,
<!--l. 3035--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;data_type)
<!--l. 3035--><p class="noindent" >
<!--l. 3035--><p class="noindent" >call&#x00A0;CCTK_ReduceLocArrayToArray1D(int&#x00A0;returnvalue
<!--l. 3035--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cctkGH,
<!--l. 3035--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;processor,
<!--l. 3035--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;operation_handle,
<!--l. 3035--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;in_array1d,
<!--l. 3035--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;out_array1d,
<!--l. 3035--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;xsize,
<!--l. 3035--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;data_type)
</div>
<!--l. 3035--><p class="nopar" ></span>
<!--l. 3038--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">in</span><span 
class="cmtt-10">_array1d</span>        </dt><dd 
class="list">
                  <!--l. 3039--><p class="noindent" >one dimensional local arrays to be reduced across a processors, element by element.
                  </dd><dt class="list">
<span 
class="cmtt-10">out</span><span 
class="cmtt-10">_array1d</span>       </dt><dd 
class="list">
                  <!--l. 3041--><p class="noindent" >array holding the reduction result. out_array1d[1] = Reduction(in_array[1]).
                  </dd><dt class="list">
<span 
class="cmtt-10">xsize</span>             </dt><dd 
class="list">
                  <!--l. 3043--><p class="noindent" >the size of the one dimensional array.</dd></dl>
<!--l. 3048--><p class="noindent" ><span 
class="cmbx-10">Reduction of local 2d arrays to a local 2d array. </span>This reduction is carried out element by element. The
arrays need to have the same size on all processors. <span class="obeylines-h">
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-60">
<!--l. 3073--><p class="noindent" >int&#x00A0;CCTK_ReduceLocArrayToArray2D(&#x00A0;const&#x00A0;cGH&#x00A0;*GH,
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;processor,
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;opertaion_handle,
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;in_array_2d,
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;out_array2d,
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;xsize,
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;ysize,
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;data_type)
<!--l. 3073--><p class="noindent" >
<!--l. 3073--><p class="noindent" >
<!--l. 3073--><p class="noindent" >call&#x00A0;CCTK_ReduceLocArrayToArray2D(&#x00A0;int&#x00A0;returnvalue
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cctkGH,
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;processor,
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;operation_handle,
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;in_array2d,
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;out_array2d,
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;xsize,
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;ysize,
<!--l. 3073--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;data_type)
<!--l. 3073--><p class="noindent" >
</div>
<!--l. 3073--><p class="nopar" ></span>
<!--l. 3076--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">in</span><span 
class="cmtt-10">_array1d</span>        </dt><dd 
class="list">
                  <!--l. 3077--><p class="noindent" >two dimensional local arrays, to be reduced across a processors, element by element.
                  </dd><dt class="list">
<span 
class="cmtt-10">out</span><span 
class="cmtt-10">_array1d</span>       </dt><dd 
class="list">
                  <!--l. 3079--><p class="noindent" >two   dimensional   array   holding   the   reduction   result.   out_array2d[i,j]=
                  Reduction(in_array2d[i,j]).
                  </dd><dt class="list">
<span 
class="cmtt-10">xsize</span>             </dt><dd 
class="list">
                  <!--l. 3081--><p class="noindent" >the size of the one dimensional array in x direction.
                  </dd><dt class="list">
<span 
class="cmtt-10">ysize</span>             </dt><dd 
class="list">
                  <!--l. 3082--><p class="noindent" >the size of the one dimensional array in y direction.</dd></dl>
<!--l. 3087--><p class="noindent" ><span 
class="cmbx-10">Reduction of local 3D arrays to a local 3D array. </span>This reduction is carried out element by element. The
arrays need to have the same size on all processors. <span class="obeylines-h">
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-61">
<!--l. 3112--><p class="noindent" >int&#x00A0;CCTK_ReduceLocArrayToArray3D(const&#x00A0;cGH&#x00A0;*GH,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;processor,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;opertaion_handle,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;in_array_3d,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;out_array3d,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;xsize,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;ysize,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;zsize,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;data_type)
<!--l. 3112--><p class="noindent" >
<!--l. 3112--><p class="noindent" >call&#x00A0;CCTK_ReduceLocArrayToArray3D(int&#x00A0;returnvalue
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cctkGH,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;processor,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;operation_handle,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;in_array3d,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;out_array3d,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;xsize,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;ysize,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;zsize,
<!--l. 3112--><p class="noindent" >&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;data_type)
</div>
<!--l. 3112--><p class="nopar" ></span>
<!--l. 3115--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">in</span><span 
class="cmtt-10">_array3d</span>        </dt><dd 
class="list">
                  <!--l. 3116--><p class="noindent" >two dimensional local arrays, to be reduced across a processors, element by element.
                  </dd><dt class="list">
<span 
class="cmtt-10">out</span><span 
class="cmtt-10">_array3d</span>       </dt><dd 
class="list">
                  <!--l. 3118--><p class="noindent" >two   dimensional   array   holding   the   reduction   result.   out_array3d[i,j,k]=
                  Reduction(in_array3d[i,j,k]).
                  </dd><dt class="list">
<span 
class="cmtt-10">xsize</span>             </dt><dd 
class="list">
                  <!--l. 3120--><p class="noindent" >the size of the one dimensional array in x direction.
                  </dd><dt class="list">
<span 
class="cmtt-10">ysize</span>             </dt><dd 
class="list">
                  <!--l. 3121--><p class="noindent" >the size of the one dimensional array in y direction.
                  </dd><dt class="list">
<span 
class="cmtt-10">ysize</span>             </dt><dd 
class="list">
                  <!--l. 3122--><p class="noindent" >the size of the one dimensional array in z direction.</dd></dl>
                                                                                       
                                                                                       
<!--l. 3127--><p class="noindent" ><span 
class="cmbx-10">Some brief examples:</span>
<!--l. 3129--><p class="noindent" ><span 
class="cmbx-10">Reduction of a local scalars: </span>a local error is reduced across all processors with the maximum operation. The
variable <span 
class="cmtt-10">tmp </span>will hold the maximum of the error and is the same on all processors. This quantity can then be
reassigned to <span 
class="cmtt-10">normerr</span>.
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-62">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;CCTK_REAL&#x00A0;normerr,&#x00A0;tmp
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;integer&#x00A0;&#x00A0;&#x00A0;ierr,&#x00A0;reduction_handle
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;call&#x00A0;CCTK_ReductionArrayHandle(reduction_handle,"maximum")
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;if&#x00A0;(reduction_handle.lt.0)&#x00A0;then
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;call&#x00A0;CCTK_WARN(CCTK_WARN_ALERT,&#x00A0;"Cannot&#x00A0;get&#x00A0;reduction&#x00A0;handle&#x00A0;for&#x00A0;maximum&#x00A0;operation.")
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;endif
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;call&#x00A0;CCTK_ReduceLocScalar(ierr,&#x00A0;cctkGH,&#x00A0;-1,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;.&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;reduction_handle,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;.&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;normerr,&#x00A0;tmp,&#x00A0;CCTK_VARIABLE_REAL)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;if&#x00A0;(ierr.ne.0)&#x00A0;then
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;call&#x00A0;CCTK_WARN(CCTK_WARN_ALERT,&#x00A0;"Reduction&#x00A0;of&#x00A0;norm&#x00A0;failed!");
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;endif
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;normerr&#x00A0;=&#x00A0;tmp
</div>
<!--l. 3150--><p class="nopar" >
<!--l. 3153--><p class="noindent" ><span 
class="cmbx-10">Reduction of a local 2D array: </span>a two dimensional array (2 <span 
class="cmsy-10">&#x00D7; </span>3) is reduced, reduction results (array of same
size: <span 
class="cmtt-10">bla</span><span 
class="cmtt-10">_tmp</span>) are seen on all processors (<span 
class="cmsy-10">-</span>1 entry as the third argument); also demonstrates some simple error
checking with the <span 
class="cmtt-10">CCTKi</span><span 
class="cmtt-10">_EXPECTOK </span>macro.
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-63">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;CCTK_REAL&#x00A0;bla(2,3),bla_tmp(2,3);
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;integer&#x00A0;&#x00A0;&#x00A0;ierr,&#x00A0;sum_handle
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;call&#x00A0;CCTK_ReductionArrayHandle(sum_handle,"sum")
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;bla&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;=&#x00A0;&#x00A0;1.0d0
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;write&#x00A0;(*,*)&#x00A0;"BLA&#x00A0;",bla
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;call&#x00A0;CCTK_ReduceLocArrayToArray2D(ierr,&#x00A0;cctkGH,&#x00A0;-1,&#x00A0;sum_handle,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;.&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;bla,&#x00A0;bla_tmp,&#x00A0;2,&#x00A0;3,&#x00A0;CCTK_VARIABLE_REAL)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;call&#x00A0;CCTKi_EXPECTOK(ierr,&#x00A0;0,&#x00A0;1,&#x00A0;"2D&#x00A0;Reduction&#x00A0;failed")
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;bla&#x00A0;=&#x00A0;bla_tmp
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;write&#x00A0;(*,*)&#x00A0;"BLA&#x00A0;",bla
</div>
<!--l. 3171--><p class="nopar" >
<!--l. 3173--><p class="noindent" >Note that the memory for the returned values must be allocated before the reduction call is made.
<!--l. 3180--><p class="noindent" >
<h3 class="sectionHead"><span class="titlemark">C1.8   </span> <a 
 id="x13-117000C1.8"></a>Completing a Thorn</h3>
<!--l. 3184--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.8.1   </span> <a 
 id="x13-118000C1.8.1"></a>Commenting Source Code</h4>
<!--l. 3186--><p class="noindent" >Note that since most source files (see Section&#x00A0;<a 
href="#x13-58000C1.2.4">C1.2.4<!--tex4ht:ref: nacofosofi --></a> for exceptions) pass through a C preprocessor, C style
comments can be used in Fortran code. Note that C++ comments (those ones starting with &#8220;<span 
class="cmtt-10">//</span>&#8221;), should only
be used in C++ source code.
<!--l. 3192--><p class="noindent" >The flesh and the Cactus thorns use the <span 
class="cmtt-10">grdoc </span>Code Documenting System<br 
class="newline" />(<a 
href="http://jean-luc.aei.mpg.de/Codes/grdoc/" class="url" ><span 
class="cmtt-10">http://jean-luc.aei.mpg.de/Codes/grdoc/</span></a>) to document source code.
<!--l. 3198--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.8.2   </span> <a 
 id="x13-119000C1.8.2"></a>Providing Runtime Information</h4>
<!--l. 3201--><p class="noindent" >To write from thorns to standard output (i.e. the screen) at runtime, use the macro <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INFO </span>or the function
                                                                                       
                                                                                       
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VInfo()</span>.
<!--l. 3204--><p class="noindent" >For example, from the Fortran thorn <span 
class="cmtt-10">MyThorn</span>,
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-64">
&#x00A0;&#x00A0;call&#x00A0;CCTK_INFO("Starting&#x00A0;Tricky&#x00A0;Calculation")
</div>
<!--l. 3207--><p class="nopar" > will write the line:
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-65">
&#x00A0;&#x00A0;INFO&#x00A0;(MyThorn):&#x00A0;Starting&#x00A0;Tricky&#x00A0;Calculation
</div>
<!--l. 3212--><p class="nopar" >
<!--l. 3214--><p class="noindent" >For a multiprocessor run, only runtime information from processor zero will be printed to screen by default. The
standard output of other processors will usually be discarded unless the &#8220;<span 
class="cmtt-10">-r</span>&#8221; command line option is used
(Section&#x00A0;<a 
href="UsersGuidech7.html#x10-36000B3.1">B3.1<!--tex4ht:ref: sec:command_line_options --></a>).
<!--l. 3219--><p class="noindent" >Note that the routine <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VInfo() </span>can only be called from C, because Fortran doesn&#8217;t know about variable
argument lists. So, including variables in the info message using <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INFO </span>is currently more tricky, since you
need to build the string to be output.
<!--l. 3224--><p class="noindent" >For example, in C you would just write
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-66">
&#x00A0;&#x00A0;int&#x00A0;myint;
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;CCTK_VInfo(CCTK_THORNSTRING,&#x00A0;"The&#x00A0;integer&#x00A0;is&#x00A0;%d",&#x00A0;myint);
</div>
<!--l. 3229--><p class="nopar" >
<!--l. 3231--><p class="noindent" >But in Fortran you have to do the following
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-67">
&#x00A0;&#x00A0;integer&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;myint
&#x00A0;<br />&#x00A0;&#x00A0;character*200&#x00A0;message
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;write&#x00A0;(message,&#x00A0;&#8217;("The&#x00A0;integer&#x00A0;is&#x00A0;",i4)&#8217;)&#x00A0;myint
&#x00A0;<br />&#x00A0;&#x00A0;call&#x00A0;CCTK_INFO&#x00A0;(message)
</div>
<!--l. 3238--><p class="nopar" >
<!--l. 3240--><p class="noindent" >In Fortran 90, you can also do
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-68">
&#x00A0;&#x00A0;integer&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;myint
&#x00A0;<br />&#x00A0;&#x00A0;character(200)&#x00A0;message
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;write&#x00A0;(message,&#x00A0;&#8217;("The&#x00A0;integer&#x00A0;is&#x00A0;",i4)&#8217;)&#x00A0;myint
&#x00A0;<br />&#x00A0;&#x00A0;call&#x00A0;CCTK_INFO&#x00A0;(message)
</div>
<!--l. 3247--><p class="nopar" >
<!--l. 3249--><p class="noindent" >Note that
     <ul class="itemize1">
     <li class="itemize"> <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INFO </span>is just a macro which expands to a call to the internal function <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Info() </span>and
     automatically includes the thorn name in function call.
     </li>
     <li class="itemize"> <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INFO </span>should be used rather than print statements, since it will give consistent behaviour on
     multiprocessors, and also provides a mechanism for switching the output to screen on and off, even
     on a thorn-by-thorn basis. (Although this is not yet implemented).</li></ul>
<!--l. 3264--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.8.3   </span> <a 
 id="x13-120000C1.8.3"></a>Error Handling, Warnings and Code Termination</h4>
<!--l. 3267--><p class="noindent" >The Cactus function <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VWarn()</span>, and its accompanying <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_WARN </span>macro, should be used to issue warning
messages during code execution.
<!--l. 3271--><p class="noindent" >Along with the warning message, an integer is given to indicate the severity of the warning.
Only warnings with severity levels less than, or equal to, the global Cactus warning level
threshold<span class="footnote-mark"><a 
href="#fn2x9" id="fn2x9-bk"><sup class="textsuperscript">2</sup></a></span><a 
 id="x13-120001f2"></a>
will be printed. A level&#x00A0;0 warning indicates the highest severity (and is guaranteed to abort the Cactus run),
while larger numbers indicate less severe warnings. The global Cactus warning level threshold defaults to&#x00A0;1, i.e.
level&#x00A0;1 warnings are printed, but level&#x00A0;2 and higher are not printed.
<!--l. 3287--><p class="noindent" >The severity level may actually be any integer, and a lot of existing code uses bare &#8220;magic number&#8221;
integers for warning levels, but to help standardize warning levels across thorns, new code should
probably use one of the following macros, defined in <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">"cctk_WarnLevel.h"</span></span></span> (which is <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">#include</span></span></span>d by
<span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">"cctk.h"</span></span></span>):
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-69">
#define&#x00A0;CCTK_WARN_ABORT&#x00A0;&#x00A0;&#x00A0;&#x00A0;0&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;abort&#x00A0;the&#x00A0;Cactus&#x00A0;run&#x00A0;*/
&#x00A0;<br />#define&#x00A0;CCTK_WARN_ALERT&#x00A0;&#x00A0;&#x00A0;&#x00A0;1&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;the&#x00A0;results&#x00A0;of&#x00A0;this&#x00A0;run&#x00A0;will&#x00A0;probably&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;be&#x00A0;wrong,&#x00A0;but&#x00A0;this&#x00A0;isn&#8217;t&#x00A0;quite&#x00A0;certain,&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;so&#x00A0;we&#8217;re&#x00A0;not&#x00A0;going&#x00A0;to&#x00A0;abort&#x00A0;the&#x00A0;run&#x00A0;*/
&#x00A0;<br />#define&#x00A0;CCTK_WARN_COMPLAIN&#x00A0;2&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;the&#x00A0;user&#x00A0;should&#x00A0;know&#x00A0;about&#x00A0;this,&#x00A0;but&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;the&#x00A0;results&#x00A0;of&#x00A0;this&#x00A0;run&#x00A0;are&#x00A0;probably&#x00A0;ok&#x00A0;*/
&#x00A0;<br />#define&#x00A0;CCTK_WARN_PICKY&#x00A0;&#x00A0;&#x00A0;&#x00A0;3&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;this&#x00A0;is&#x00A0;for&#x00A0;small&#x00A0;problems&#x00A0;that&#x00A0;can&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;probably&#x00A0;be&#x00A0;ignored,&#x00A0;but&#x00A0;that&#x00A0;careful&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;people&#x00A0;may&#x00A0;want&#x00A0;to&#x00A0;know&#x00A0;about&#x00A0;*/
&#x00A0;<br />#define&#x00A0;CCTK_WARN_DEBUG&#x00A0;&#x00A0;&#x00A0;&#x00A0;4&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;these&#x00A0;messages&#x00A0;are&#x00A0;probably&#x00A0;useful&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;/*&#x00A0;only&#x00A0;for&#x00A0;debugging&#x00A0;purposes&#x00A0;*/
</div>
<!--l. 3304--><p class="nopar" >
<!--l. 3306--><p class="noindent" >For example, to provide a warning for a serious problem, which indicates that the results of the run are quite
likely wrong, and which will be printed to the screen by default, a level&#x00A0;<span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">CCTK_WARN_ALERT</span></span></span> warning should be
used.
<!--l. 3311--><p class="noindent" >The syntax from Fortran is
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-70">
&#x00A0;&#x00A0;call&#x00A0;CCTK_WARN(CCTK_WARN_ALERT,&#x00A0;"Your&#x00A0;warning&#x00A0;message")
</div>
<!--l. 3314--><p class="nopar" >
<!--l. 3316--><p class="noindent" >and from C
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-71">
&#x00A0;&#x00A0;CCTK_WARN(CCTK_WARN_ALERT,&#x00A0;"Your&#x00A0;warning&#x00A0;message");
</div>
<!--l. 3319--><p class="nopar" >
<!--l. 3321--><p class="noindent" >Note that <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_WARN </span>is just a macro which expands to a call to an internal function. The
macro automatically includes the thorn name, the source code file name and line number in the
message.<span class="footnote-mark"><a 
href="#fn3x9" id="fn3x9-bk"><sup class="textsuperscript">3</sup></a></span><a 
 id="x13-120002f3"></a>
(For this reason it is important for Fortran code that capital letters are always used in order to expand the
macro.)
<!--l. 3337--><p class="noindent" >If the flesh parameter <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_full</span><span 
class="cmtt-10">_warnings </span>is set to true, then the source file name and line number will be
printed to standard error along with the originating processor number, the thorn name and the warning message.
The default is to omit the source file name and line number.
<!--l. 3342--><p class="noindent" >Note that the routine <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VWarn() </span>can only be called from C, because Fortran doesn&#8217;t know about variable
argument lists. So including variables in the warning message using <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_WARN</span>, is currently more tricky, since
you need to build the string to be output.
<!--l. 3347--><p class="noindent" >For example, in C you would just write
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-72">
&#x00A0;&#x00A0;int&#x00A0;&#x00A0;&#x00A0;&#x00A0;myint;
&#x00A0;<br />&#x00A0;&#x00A0;double&#x00A0;myreal;
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;CCTK_VWarn(CCTK_WARN_ALERT,&#x00A0;__LINE__,&#x00A0;__FILE__,&#x00A0;CCTK_THORNSTRING,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"Your&#x00A0;warning&#x00A0;message,&#x00A0;including&#x00A0;%f&#x00A0;and&#x00A0;%d",
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;myreal,&#x00A0;myint);
</div>
<!--l. 3355--><p class="nopar" >
<!--l. 3357--><p class="noindent" >But in Fortran you have to do the following
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-73">
&#x00A0;&#x00A0;integer&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;myint
&#x00A0;<br />&#x00A0;&#x00A0;real&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;myreal
&#x00A0;<br />&#x00A0;&#x00A0;character*200&#x00A0;message
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;write&#x00A0;(message,&#x00A0;&#8217;("Your&#x00A0;warning&#x00A0;message,&#x00A0;including&#x00A0;",g12.7,"&#x00A0;and&#x00A0;",i8)&#8217;)&#x00A0;myreal,&#x00A0;myint
&#x00A0;<br />&#x00A0;&#x00A0;call&#x00A0;CCTK_WARN&#x00A0;(CCTK_WARN_ALERT,&#x00A0;message)
</div>
<!--l. 3365--><p class="nopar" >
<!--l. 3367--><p class="noindent" >In Fortran 90, you can also do
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-74">
&#x00A0;&#x00A0;integer&#x00A0;myint
&#x00A0;<br />&#x00A0;&#x00A0;real&#x00A0;myreal
&#x00A0;<br />&#x00A0;&#x00A0;character(200)&#x00A0;message
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;write&#x00A0;(message,&#x00A0;&#8217;("Your&#x00A0;warning&#x00A0;message,&#x00A0;including&#x00A0;",g12.7,"&#x00A0;and&#x00A0;",i8)&#8217;)&#x00A0;myreal,&#x00A0;myint
&#x00A0;<br />&#x00A0;&#x00A0;call&#x00A0;CCTK_WARN&#x00A0;(CCTK_WARN_ALERT,&#x00A0;message)
</div>
<!--l. 3375--><p class="nopar" >
<!--l. 3377--><p class="noindent" >Besides the default methods to handle warning and information messages, the flesh also implements
a callback scheme to let thorn writers get information and warning messages as they are
produced.<span class="footnote-mark"><a 
href="#fn4x9" id="fn4x9-bk"><sup class="textsuperscript">4</sup></a></span><a 
 id="x13-120003f4"></a>
<!--l. 3382--><p class="noindent" >For warning messages, a function with the following prototype
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-75">
void&#x00A0;my_warnfunc(int&#x00A0;level,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;line,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;char&#x00A0;*file,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;char&#x00A0;*thorn,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;char&#x00A0;*message,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;void&#x00A0;*data);
</div>
<!--l. 3390--><p class="nopar" > should be implemented, and then registered with
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-76">
CCTK_WarnCallbackRegister(int&#x00A0;minlevel,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;maxlevel,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;void&#x00A0;*data,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cctk_warnfunc&#x00A0;my_warnfunc);
</div>
<!--l. 3397--><p class="nopar" >
<!--l. 3399--><p class="noindent" >The data pointer can be used to pass arbitrary information to the registered function, e.g. a file descriptor or a
format string.
<!--l. 3402--><p class="noindent" >Multiple functions can be registered as above; when <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VWarn() </span>is called, all the registered functions will be
called, if the warning is within the minimum and maximum levels indicated.
<!--l. 3407--><p class="noindent" >The basic procedure is exactly the same for information messages.
<!--l. 3409--><p class="noindent" >A function registered for information messages will look like
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-77">
void&#x00A0;my_infofunc(const&#x00A0;char&#x00A0;*thorn,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;char&#x00A0;*message,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;void&#x00A0;*data);
</div>
<!--l. 3414--><p class="nopar" > while the registration function looks like
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-78">
CCTK_InfoCallbackRegister(void&#x00A0;*data,&#x00A0;cctk_infofunc&#x00A0;my_infofunc);
</div>
<!--l. 3418--><p class="nopar" >
<!--l. 3422--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.8.4   </span> <a 
 id="x13-121000C1.8.4"></a>Adding Documentation</h4>
<!--l. 3425--><p class="noindent" >Documentation is a vital part of your thorn, helping to ensure its ease of use and longevity, not only for others,
but also for the thorn authors. Although any kind of independent documentation can be added to a thorn
(ideally in the <span 
class="cmtt-10">doc </span>directory), there are two standard places for adding thorn documentation, a <span 
class="cmtt-10">README </span>and a
<span 
class="cmtt-10">doc/documentation.tex </span>file for including in Thorn Guides.
<!--l. 3432--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-122000C1.8.4"></a><span 
class="cmtt-10">README</span></h5>
<!--l. 3434--><p class="noindent" >The <span 
class="cmtt-10">README</span>, in the top level of a thorn, should contain brief and essential details about the thorn, such as the
authors, any copyright details, and a synopsis of what the thorn does.
<!--l. 3438--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-123000C1.8.4"></a>Contribution to Thorn Guide</h5>
<!--l. 3440--><p class="noindent" >The LaTeX file, <span 
class="cmtt-10">doc/documentation.tex</span>, is included in Thorn Guides built by the Cactus make system.
(e.g.&#x00A0;by <span 
class="cmtt-10">gmake </span><span 
class="cmmi-10">&#x003C;</span><span 
class="cmsltt-10">config</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmtt-10">-ThornGuide</span>). Ideally this file should contain complete (and <span 
class="cmti-10">up-to-date</span>) details about
the thorn, exactly what is relevant is for the authors to decide, but remember that the Cactus make system
automatically parses the thorn CCL files to include information about all parameters, variables and scheduling.
Suggested sections include:
     <ul class="itemize1">
     <li class="itemize"><span 
class="cmbx-10">Model. </span>A description of the system which the thorn is modelling, including the equations, etc.,
     which are being solved or implemented.
     </li>
     <li class="itemize"><span 
class="cmbx-10">Numerical implementation. </span>Details about how the model is numerically implemented in the
     thorn.
                                                                                       
                                                                                       
     </li>
     <li class="itemize"><span 
class="cmbx-10">Using the thorn. </span>Any special details needed for using the thorn, tricky parameters, particular
     operating systems or additional required software, interactions with other thorns and examples of
     use.
     </li>
     <li class="itemize"><span 
class="cmbx-10">History. </span>Here is where you should describe why the thorn was written, any previous software or
     experience which was made use of, the authors of the thorn source code and documentation, how
     to get hold of the thorn, etc.
     </li>
     <li class="itemize"><span 
class="cmbx-10">References. </span>A bibliography can be included, referencing papers published using or about this
     thorn, or additional information about the model or numerics used.
     </li></ul>
<!--l. 3472--><p class="noindent" >A LaTeX template for the Thorn Guide documentation can be found in the flesh distribution at
<!--l. 3475--><p class="noindent" ><span 
class="cmtt-10">doc/ThornGuide/template.tex</span>,
<!--l. 3477--><p class="noindent" >this file is automatically copied to the correct location in a new thorn which is created with <span 
class="cmtt-10">gmake</span>
<span 
class="cmtt-10">newthorn</span>.
<!--l. 3480--><p class="noindent" >Since Cactus scripts need to parse this documentation, and since the LaTeX document should be consistent
across all thorns included in a Thorn Guide, please follow the guidelines below when filling in the
documentation:
     <ul class="itemize1">
     <li class="itemize">Use the Cactus Thorn Guide style file, located in the flesh distribution at <span 
class="cmtt-10">doc/latex/cactus.sty</span>. This
     should be included using a relative link, so that updates to the style file are applied to all
     thorns.
                                                                                       
                                                                                       
     <div class="verbatim" id="verbatim-79">
     \usepackage{../../../../doc/latex/cactus}
</div>
     <!--l. 3494--><p class="nopar" >
     </li>
     <li class="itemize">Aside from the <span 
class="cmtt-10">date</span>, <span 
class="cmtt-10">author</span>, and <span 
class="cmtt-10">title </span>fields, all of the documentation to be included in a Thorn Guide
     should be placed between the lines
     <!--l. 3501--><p class="noindent" ><span 
class="cmtt-10">% START CACTUS THORNGUIDE</span>
     <!--l. 3503--><p class="noindent" >and
     <!--l. 3505--><p class="noindent" ><span 
class="cmtt-10">% END CACTUS THORNGUIDE</span>
     </li>
     <li class="itemize">The command <span 
class="cmsy-10">\</span><span 
class="cmtt-10">def </span>can be used to define macros, but all such definitions must lie between the <span 
class="cmtt-10">START </span>and
     <span 
class="cmtt-10">END </span>line. Do not redefine any standard LaTeX command
     </li>
     <li class="itemize">Do not use the <span class="obeylines-h"><span 
class="cmsy-10">\</span><span 
class="cmtt-10">appendix</span></span> command, instead include any appendices you have as standard
     sections.
     </li>
     <li class="itemize">We only support PDF (<span 
class="cmtt-10">.pdf</span>) figures. Graphics figures should be included using the <span 
class="cmtt-10">includegraphics</span>
     command (not <span 
class="cmtt-10">epsffig</span>), with no file extension specified. For example,
                                                                                       
                                                                                       
     <div class="verbatim" id="verbatim-80">
     \begin{figure}[ht]
     &#x00A0;<br />&#x00A0;&#x00A0;\begin{center}
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;\includegraphics[width=6cm]{MyArrangement_MyThorn_MyFigure}
     &#x00A0;<br />&#x00A0;&#x00A0;\end{center}
     &#x00A0;<br />&#x00A0;&#x00A0;\caption{Illustration&#x00A0;of&#x00A0;this&#x00A0;and&#x00A0;that}
     &#x00A0;<br />&#x00A0;&#x00A0;\label{MyArrangement_MyThorn_MyLabel}
     &#x00A0;<br />\end{figure}
</div>
     <!--l. 3526--><p class="nopar" >
     </li>
     <li class="itemize">All <span 
class="cmbx-10">labels</span>, <span 
class="cmbx-10">citations</span>, <span 
class="cmbx-10">references</span>, and <span 
class="cmbx-10">graphic images </span>names should conform to the following
     guidelines: <span 
class="cmtt-10">ARRANGEMENT</span><span 
class="cmtt-10">_THORN</span><span 
class="cmtt-10">_LABEL</span>. For instance, if you arrangement is called CactusWave, your
     thorn WaveToyC, and your original image blackhole.eps, you should rename your image to be
     <span 
class="cmtt-10">CactusWave</span><span 
class="cmtt-10">_WaveToyC</span><span 
class="cmtt-10">_blackhole.eps</span>
     </li>
     <li class="itemize">References should be formatted with the standard LaTeX <span 
class="cmbx-10">bibitem </span>command, for example, a bibliography
     section should look like:
                                                                                       
                                                                                       
     <div class="verbatim" id="verbatim-81">
     \begin{thebibliography}{9}
     &#x00A0;<br />&#x00A0;&#x00A0;\bibitem{MyArrangement_MyThorn_Author99}
     &#x00A0;<br />&#x00A0;&#x00A0;{J.&#x00A0;Author,&#x00A0;\textit{The&#x00A0;Title&#x00A0;of&#x00A0;the&#x00A0;Book,&#x00A0;Journal,&#x00A0;or&#x00A0;periodical},&#x00A0;1&#x00A0;(1999),
     &#x00A0;<br />&#x00A0;&#x00A0;1--16.&#x00A0;\url{http://www.nowhere.com/}}
     &#x00A0;<br />\end{thebibliography}
</div>
     <!--l. 3545--><p class="nopar" >
     </li></ul>
<!--l. 3551--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.8.5   </span> <a 
 id="x13-124000C1.8.5"></a>Adding a Test Suite</h4>
<!--l. 3554--><p class="noindent" >To add a test suite to your thorn, devise a series of parameter files which use as many aspects of your thorn as
possible. Make sure that the parameter files produce ASCII output to files, and that these files are in the
directory <span 
class="cmtt-10">./&#x003C;parameter file base name&#x003E;</span>.
<!--l. 3560--><p class="noindent" >Run Cactus on each of the parameter files, and move the parameter files, and the output directories they
produced, to the <span 
class="cmtt-10">test </span>directory in your thorn.
<!--l. 3564--><p class="noindent" >Document carefully any situations or architectures in which your test suite does not give the correct
answers.
<!--l. 3567--><p class="noindent" >You can also specify options for running your testsuite by adding an optional configuration file called <span 
class="cmtt-10">test.ccl</span>
in the <span 
class="cmtt-10">test </span>directory. These are simple text files and may contain comments introduced by the hash &#8216;<span 
class="cmtt-10">#</span>&#8217;
character, which indicates that the rest of the line is a comment. If the last non-blank character of a line in
a config file is a backslash &#8216;<span 
class="cmsy-10">\</span>&#8217;, the following line is treated as a continuation of the current line.
Options include test specific absolute and relative tolerances, thorn specific absolute and relative
tolerances, the number of procesors required to run, and file extensions. The configuration file has the
form:
<div class="alltt">
<!--l. 3578--><p class="noindent" ><div class="obeylines-v">
<span 
class="cmtt-10">ABSTOL</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">thorn_absolute_tolerance</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmtt-10">RELTOL</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">thorn_relative_tolerance</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmtt-10">NPROCS</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">thorn_nprocs</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmtt-10">EXTENSIONS</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">extension_1</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmsltt-10">extension_2</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmsltt-10">extension_3</span><span 
class="cmtt-10">&#x003E;</span>
<br />
<br /><span 
class="cmtt-10">TEST</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">test_example</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmsy-10">{</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;ABSTOL</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">absolute_tol</span><span 
class="cmtt-10">&#x003E;</span>
                                                                                       
                                                                                       
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;RELTOL</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">relative_tol</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;NPROCS</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">nprocs</span><span 
class="cmtt-10">&#x003E;</span>
<br /><span 
class="cmsy-10">}</span>
</div>
</div>
<!--l. 3592--><p class="noindent" >which states that when comparing files of test <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">test_example</span></span></span>, both <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">absolute_tol</span></span></span> and <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">relative_tol</span></span></span> should be
used as the absolute and relative tolerances. For all other tests in the thorn, the default value of absolute and
relative tolerances are set to <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">thorn_absolute_tolerance</span></span></span> and <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">thorn_relative_tolerance</span></span></span>. The <span 
class="cmtt-10">NPROCS</span>
option specifies the number of processors required to run a given testsuite <span 
class="cmsltt-10">test</span><span 
class="cmsltt-10">_example </span>or all
testsuites of a thorn successfully. If no <span 
class="cmtt-10">NPROCS </span>option is present, the testsuite(s) is (are) assumed to
run with any number of processors. The <span 
class="cmtt-10">EXTENSIONS </span>option adds <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">extension_1</span></span></span>, <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">extension_2</span></span></span> and
<span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">extension_3</span></span></span> to the list of file extensions that are compared. This list is global over all tests in a
configuration.
<!--l. 3606--><p class="noindent" >Test specific tolerances have precedence over all tolerances, next come thorn wide tolerances, and
then cactus default tolerances. Absolute and relative tolerances are independent: you can choose to
use test specific absolute tolerance and thorn specific relative tolerance when running a test. For
example,
<div class="alltt">
<!--l. 3612--><p class="noindent" ><div class="obeylines-v">
<span 
class="cmtt-10">TEST</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmsltt-10">test_rad</span>
<br /><span 
class="cmsy-10">{</span>
<br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;ABSTOL</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmsltt-10">1e-5</span>
<br /><span 
class="cmsy-10">}</span>
<br />
<br /><span 
class="cmtt-10">ABSTOL</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmsltt-10">1e-8</span>
<br /><span 
class="cmtt-10">RELTOL</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmsltt-10">1e-12</span>
</div>
</div>
<!--l. 3622--><p class="noindent" >would use an absolute tolerance of 10<sup><span 
class="cmsy-7">-</span><span 
class="cmr-7">5</span></sup> and a relative tolerance of 10<sup><span 
class="cmsy-7">-</span><span 
class="cmr-7">12</span></sup> when running <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">test_rad</span></span></span> and an
absolute tolerance of 10<sup><span 
class="cmsy-7">-</span><span 
class="cmr-7">8</span></sup> and a relative tolerance of 10<sup><span 
class="cmsy-7">-</span><span 
class="cmr-7">12</span></sup> when running all other tests.
<!--l. 3626--><p class="noindent" >For details on running the test suites, see Section&#x00A0;<a 
href="UsersGuidech6.html#x9-34000B2.6">B2.6<!--tex4ht:ref: sec:testing --></a>.
<!--l. 3628--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-125000C1.8.5"></a>Best Practices for Test Suites</h5>
<!--l. 3630--><p class="noindent" >When writing a test suite, there are a few things you should keep in mind:
     <ul class="itemize1">
                                                                                       
                                                                                       
     <li class="itemize">The test suite will be run together with many other test suites. It should, therefore, finish quickly
     (say, in under two minutes), and not use too much memory (so that it can run on a &#8220;normal&#8221;
     workstation).
     </li>
     <li class="itemize">The test suite will be run automatically, often in situations where no one checks the screen output.
     All important output should be via grid variables that are written to files. Alternatively, if the test
     suite tests some low-level infrastructure, it may just abort the simulation if it fails; that will also
     be detected.
     </li>
     <li class="itemize">Downloading many files is slow on many systems. A test suite should normally not have more than,
     say, hundred output files, and normally the output files should be small, so that there are not more
     than a few Megabytes of output files per test suite.
     </li>
     <li class="itemize">The test suite output files should always be the same. That means that they should not contain
     time stamps, etc. It is, therefore, best to use the option <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">IO::out_fileinfo="none"</span></span></span>.
     </li>
     <li class="itemize">Norms are unfortunately quite insensitive to changes to a few grid points only, even if the changes
     are significant. It is necessary to output grid point values directly, not only norms.
     </li>
     <li class="itemize">Try to use as few thorns as possible in a test case. For example, do not active 3D output thorns
     (unless you use it). The fewer thorns you use, the easier it is to run the test suite.
     </li>
     <li class="itemize">It is not necessary that a test suite result is &#8220;physically correct&#8221;, or that it uses parameters that
     ensure a stable time evolution. A test suite will usually take only a few time steps, so that a grid
     size of, e.g.&#x00A0;20<sup><span 
class="cmr-7">3</span></sup> grid points <span 
class="cmti-10">without </span>dissipation can be sufficient. Test suites cannot test whether
     the result of a simulation is physically feasible; they only test whether anything changed at all.
     Ensuring that the physics is still correct has to be handled by different mechanisms.</li></ul>
<!--l. 3669--><p class="noindent" >
<h3 class="sectionHead"><span class="titlemark">C1.9   </span> <a 
 id="x13-126000C1.9"></a>Advanced Thorn Writing</h3>
<!--l. 3673--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.9.1   </span> <a 
 id="x13-127000C1.9.1"></a>Using Cactus Timers</h4>
<!--l. 3676--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-128000C1.9.1"></a>What are Timers?</h5>
                                                                                       
                                                                                       
<!--l. 3681--><p class="noindent" >Cactus provides a flexible mechanism for timing different sections of your thorns using various <span 
class="cmti-10">clocks </span>which have
been registered with the flesh. By default, the flesh provides two clocks that measure time in different ways
(provided the underlying functionality is available on your system):
<!--l. 3686--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">GetTimeOfDay</span>      </dt><dd 
class="list">
                  <!--l. 3688--><p class="noindent" >Provides &#8220;wall clock time&#8221; via the unix <span 
class="cmtt-10">gettimeofday </span>function.
                  </dd><dt class="list">
<span 
class="cmtt-10">GetrUsage</span>         </dt><dd 
class="list">
                  <!--l. 3690--><p class="noindent" >Provides CPU usage time via the unix <span 
class="cmtt-10">getrusage </span>function.</dd></dl>
<!--l. 3694--><p class="noindent" >Additional clocks can be implemented by thorns and registered with the flesh (see Chapter <a 
href="UsersGuidech10.html#x14-181000C2.9">C2.9<!--tex4ht:ref: chap:clocks --></a>).
<!--l. 3697--><p class="noindent" >To use Cactus timing, you create a <span 
class="cmti-10">timer</span>, which provides time information for all the registered
clocks.
<!--l. 3700--><p class="noindent" >You can add any number of timers to your thorn source code, providing each with a name of your choice, and
then use Cactus timing functions to switch on the timers, stop or reset them, and recover timing
information.
<!--l. 3704--><p class="noindent" >Setting the flesh parameter <span 
class="cmtt-10">cactus::cctk</span><span 
class="cmtt-10">_timer</span><span 
class="cmtt-10">_output = "full" </span>will cause some summary timing
information to be printed at the end of a run. Some other thorns have their own timer printing parameters as
well.
<!--l. 3708--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-129000C1.9.1"></a>Timing Calls</h5>
<!--l. 3710--><p class="noindent" >Many of the timing calls come in two versions, one whose name ends with the letter <span 
class="cmtt-10">I</span>, and one without. The
calls whose names end with the letter <span 
class="cmtt-10">I </span>refer to the timer or clock by index, which is a non-negative <span 
class="cmtt-10">int </span>value;
the other calls refer to a timer by name. If a timer is created without a name, it can be referred to only by its
index, otherwise, it can be referred to by name or by index.
<!--l. 3717--><p class="noindent" >Typically, a negative return value from a timer function indicates an error.
<!--l. 3719--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerCreate</span></span><span 
class="cmss-10">, </span><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerCreateI</span></span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3721--><p class="noindent" >
                  <!--l. 3723--><p class="noindent" >Create a timer with a given name, or with no name (respectively) and return a
                  timer index or an error code. Negative return values indicate errors. Only one timer
                  with a given name can exist at any given time.
                                                                                       
                                                                                       
                  </dd><dt class="list">
<span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerDestroy</span></span><span 
class="cmss-10">, </span><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerDestroyI</span></span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3729--><p class="noindent" >
                  <!--l. 3731--><p class="noindent" >Reclaim resources used by a timer.
                  </dd><dt class="list">
<span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerStart</span></span><span 
class="cmss-10">, </span><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerStartI</span></span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3733--><p class="noindent" >
                  <!--l. 3735--><p class="noindent" >Start the given timer, using all registered clocks.
                  </dd><dt class="list">
<span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerStop</span></span><span 
class="cmss-10">, </span><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerStopI</span></span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3737--><p class="noindent" >
                  <!--l. 3739--><p class="noindent" >Stop the given timer on all registered clocks.
                  </dd><dt class="list">
<span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerReset</span></span><span 
class="cmss-10">, </span><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerResetI</span></span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3741--><p class="noindent" >
                  <!--l. 3743--><p class="noindent" >Reset the given timer on all registered clocks.
                  </dd><dt class="list">
<span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerCreateData</span></span><span 
class="cmss-10">, </span><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerDestroyData</span></span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3745--><p class="noindent" >
                  <!--l. 3747--><p class="noindent" >Allocate and reclaim (respectively) resources for a <span class="obeylines-h"><span 
class="cmtt-10">cTimerData</span></span> structure, which
                  will be used to hold clock values.
                  </dd><dt class="list">
<span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Timer</span></span><span 
class="cmss-10">, </span><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerI</span></span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3750--><p class="noindent" >
                  <!--l. 3752--><p class="noindent" >Fill  the  given  <span class="obeylines-h"><span 
class="cmtt-10">cTimerData</span></span> structure  with  clock  values  as  of  the  last  call  to
                  <span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerStop</span></span>.
                  </dd><dt class="list">
<span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_NumTimers</span></span>    </dt><dd 
class="list">
                  <!--l. 3755--><p class="noindent" >
                  <!--l. 3757--><p class="noindent" >Return the number of created timers
                  </dd><dt class="list">
<span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerName</span></span>    </dt><dd 
class="list">
                  <!--l. 3759--><p class="noindent" >
                  <!--l. 3761--><p class="noindent" >Return the name of the timer for a given timer index (or <span class="obeylines-h"><span 
class="cmtt-10">NULL</span></span> if the timer is
                  unnamed or any other error occurs).
                                                                                       
                                                                                       
                  </dd><dt class="list">
<span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_NumTimerClocks</span></span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3764--><p class="noindent" >
                  <!--l. 3766--><p class="noindent" >Take a pointer to <span class="obeylines-h"><span 
class="cmtt-10">cTimerData</span></span> and return the number of clocks recorded in a timer
                  measurement
                  </dd><dt class="list">
<span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_GetClockValue</span></span><span 
class="cmss-10">, </span><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_GetClockValueI</span></span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3769--><p class="noindent" >
                  <!--l. 3771--><p class="noindent" >Given a clock referred to by name or index, respectively, and a <span class="obeylines-h"><span 
class="cmtt-10">cTimerData</span></span> pointer,
                  return a <span class="obeylines-h"><span 
class="cmtt-10">cTimerVal</span></span> pointer representing the value of the clock when the timer was
                  stopped
                  </dd><dt class="list">
<span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerClockName</span></span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3775--><p class="noindent" >
                  <!--l. 3777--><p class="noindent" >Return the name of the clock given by the <span class="obeylines-h"><span 
class="cmtt-10">cTimerVal</span></span> pointer argument.
                  </dd><dt class="list">
<span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerClockResolution</span></span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3779--><p class="noindent" >
                  <!--l. 3781--><p class="noindent" >Return the floating-point value of the resolution in seconds of the clock referred to
                  by the <span class="obeylines-h"><span 
class="cmtt-10">cTimerVal</span></span> pointer argument. This is a lower bound for the smallest non-zero
                  difference in values between calls of <span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerClockSeconds</span></span>.
                  </dd><dt class="list">
<span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerClockSeconds</span></span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3786--><p class="noindent" >
                  <!--l. 3788--><p class="noindent" >Return the floating-point value of the measurement in seconds from the <span class="obeylines-h"><span 
class="cmtt-10">cTimerVal</span></span>
                  pointer argument.
                  </dd></dl>
<!--l. 3793--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-130000C1.9.1"></a>How to Insert Timers in your Code</h5>
<!--l. 3795--><p class="noindent" >The function prototypes and structure definitions are contained in the include file <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_Timers.h</span>, which is
included in the standard thorn header file <span 
class="cmtt-10">cctk.h</span>. At the moment, the timer calls are only available from
C.
<!--l. 3800--><p class="noindent" >The following example, which uses a timer to instrument a section of code, illustrates how timers are used by
application thorns. A working example is available in the thorn <span 
class="cmtt-10">CactusTest/TestTimers</span>.
<!--l. 3805--><p class="noindent" ><span 
class="cmbx-10">Creating a timer</span>
                                                                                       
                                                                                       
<!--l. 3807--><p class="noindent" >The first action for any timer is to create it, using <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerCreate</span>. This can be performed at any time prior
to use of the timer:
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-82">
#include&#x00A0;"cctk_Timers.h"
&#x00A0;<br />index&#x00A0;=&#x00A0;CCTK_TimerCreate("TimeMyStuff");
</div>
<!--l. 3814--><p class="nopar" >
<!--l. 3816--><p class="noindent" ><span 
class="cmbx-10">Instrumenting a section of code</span>
<!--l. 3818--><p class="noindent" >Code sections are instrumented using the Start, Stop and Reset functions. These functions are applied to the
chosen timer using all the registered clocks.
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-83">
ierr&#x00A0;=&#x00A0;CCTK_TimerStart("TimeMyStuff");
&#x00A0;<br />do_procedure_to_be_timed();
&#x00A0;<br />ierr&#x00A0;=&#x00A0;CCTK_TimerStop("TimeMyStuff");
</div>
<!--l. 3824--><p class="nopar" >
<!--l. 3826--><p class="noindent" ><span 
class="cmbx-10">Accessing the timer results</span>
<!--l. 3828--><p class="noindent" >After calling <span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_TimerStop</span></span>, you then get the time value from any of the registered clocks.
<!--l. 3831--><p class="noindent" >The procedure is to allocate a <span class="obeylines-h"><span 
class="cmtt-10">cTimerData</span></span> structure, and read the information from your timer into this
structure using <span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Timer</span></span>, then to extract time data of the desired clock from this structure. After using the
structure, you should destroy it.
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-84">
&#x00A0;&#x00A0;cTimerData&#x00A0;*info&#x00A0;=&#x00A0;CCTK_TimerCreateData();
&#x00A0;<br />&#x00A0;&#x00A0;int&#x00A0;ierr&#x00A0;=&#x00A0;CCTK_Timer("TimeMyStuff",info);
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;/*&#x00A0;&#x00A0;You&#x00A0;can&#x00A0;refer&#x00A0;to&#x00A0;a&#x00A0;particular&#x00A0;clock&#x00A0;by&#x00A0;name.&#x00A0;&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;const&#x00A0;cTimerVal&#x00A0;&#x00A0;&#x00A0;*clock&#x00A0;=&#x00A0;CCTK_GetClockValue(&#x00A0;"gettimeofday",&#x00A0;info&#x00A0;);
&#x00A0;<br />&#x00A0;&#x00A0;if(&#x00A0;clock&#x00A0;){
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;printf&#x00A0;("\t%s:&#x00A0;%.3f&#x00A0;%s\n",&#x00A0;"gettimeofday",
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;CCTK_TimerClockSeconds(&#x00A0;clock&#x00A0;),&#x00A0;"secs"&#x00A0;);
&#x00A0;<br />&#x00A0;&#x00A0;}
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;/*&#x00A0;&#x00A0;To&#x00A0;get&#x00A0;results&#x00A0;from&#x00A0;all&#x00A0;available&#x00A0;clocks,&#x00A0;refer&#x00A0;to&#x00A0;them&#x00A0;by&#x00A0;index.*/
&#x00A0;<br />&#x00A0;&#x00A0;nclocks&#x00A0;=&#x00A0;CCTK_NumTimerClocks(&#x00A0;info&#x00A0;);
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;for&#x00A0;(i&#x00A0;=&#x00A0;0;&#x00A0;i&#x00A0;&#x003C;&#x00A0;numclocks;&#x00A0;i++)&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;const&#x00A0;cTimerVal&#x00A0;&#x00A0;&#x00A0;*clock&#x00A0;=&#x00A0;CCTK_GetClockValueI(&#x00A0;i,&#x00A0;info&#x00A0;);
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;printf&#x00A0;("\t%s:&#x00A0;%.3f&#x00A0;%s\n",&#x00A0;CCTK_TimerClockName(&#x00A0;clock&#x00A0;),
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;CCTK_TimerClockSeconds(&#x00A0;clock&#x00A0;),&#x00A0;"secs"&#x00A0;);
&#x00A0;<br />&#x00A0;&#x00A0;}
&#x00A0;<br />&#x00A0;&#x00A0;CCTK_TimerDestroyData&#x00A0;(info);
</div>
<!--l. 3856--><p class="nopar" >
<!--l. 3860--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.9.2   </span> <a 
 id="x13-131000C1.9.2"></a>Include Files</h4>
<!--l. 3863--><p class="noindent" >Cactus provides a mechanism for thorns to add code to include files which can be used by any other thorn. Such
include files can contain executable source code, or header/declaration information. A distinction is made
between these two cases, since included executable code is protected from being run if a thorn is compiled, but
not active by being wrapped by a call to <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_IsThornActive</span>.
<!--l. 3870--><p class="noindent" >Any thorn which uses the include file must declare this in its <span 
class="cmtt-10">interface.ccl </span>with the line
<div class="alltt">
<!--l. 3874--><p class="noindent" ><div class="obeylines-v">
<span 
class="cmtt-10">USES</span><span 
class="cmtt-10">&#x00A0;INCLUDE</span><span 
class="cmtt-10">&#x00A0;[SOURCE|HEADER]:</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">file_name</span><span 
class="cmtt-10">&#x003E;</span>
</div>
</div>
<!--l. 3878--><p class="noindent" >(If the optional <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">[SOURCE|HEADER]</span></span></span> is omitted, <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">HEADER</span></span></span> is assumed. Note that this can be dangerous, as included
                                                                                       
                                                                                       
<span 
class="cmti-10">source </span>code, which is incorrectly assumed to be <span 
class="cmti-10">header </span>code, will be executed in another thorn
<span 
class="cmti-10">even if the providing thorn is inactive</span>. Thus, it is recommended to always include the optional
<span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">[SOURCE|HEADER]</span></span></span> specification.) Any thorn that wishes to add to this include file, declares in its own
<span 
class="cmtt-10">interface.ccl</span>
<div class="alltt">
<!--l. 3886--><p class="noindent" ><div class="obeylines-v">
<span 
class="cmtt-10">INCLUDE</span><span 
class="cmtt-10">&#x00A0;[SOURCE|HEADER]:</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">file_to_include</span><span 
class="cmtt-10">&#x003E;</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;&#x003C;</span><span 
class="cmsltt-10">file_name</span><span 
class="cmtt-10">&#x003E;</span>
</div>
</div>
<!--l. 3890--><p class="noindent" ><span class="paragraphHead"><a 
 id="x13-132000C1.9.2"></a><span 
class="cmbx-10">Example</span></span>
As an example of this in practice, for the case of Fortran code, consider a thorn A, which wants to gather terms
for a calculation from any thorn that wishes to provide them. Thorn A could have the lines in its source
code
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-85">
c&#x00A0;Get&#x00A0;source&#x00A0;code&#x00A0;from&#x00A0;other&#x00A0;thorns
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;allterms&#x00A0;=&#x00A0;0d0
&#x00A0;<br />#include&#x00A0;"AllSources.inc"
</div>
<!--l. 3902--><p class="nopar" > and would then add to <span 
class="cmtt-10">interface.ccl </span>the line
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-86">
USES&#x00A0;INCLUDE&#x00A0;SOURCE:&#x00A0;AllSources.inc
</div>
<!--l. 3906--><p class="nopar" >
<!--l. 3908--><p class="noindent" >If thorn B wants to add terms for the calculation, it would create a file, say <span 
class="cmtt-10">Bterms.inc </span>with the
lines
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-87">
c&#x00A0;Add&#x00A0;this&#x00A0;to&#x00A0;AllSources.inc
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;allterms&#x00A0;=&#x00A0;allterms&#x00A0;+&#x00A0;1d0
</div>
<!--l. 3913--><p class="nopar" > and would add to its own <span 
class="cmtt-10">interface.ccl</span>
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-88">
INCLUDE&#x00A0;SOURCE:&#x00A0;Bterms.inc&#x00A0;in&#x00A0;AllSources.inc
</div>
<!--l. 3918--><p class="nopar" >
<!--l. 3920--><p class="noindent" >The final file for thorn A which is compiled, will contain the code
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-89">
c&#x00A0;Get&#x00A0;source&#x00A0;code&#x00A0;from&#x00A0;other&#x00A0;thorns
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;allterms&#x00A0;=&#x00A0;0d0
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;if&#x00A0;(CCTK_IsThornActive("B").ne.0)&#x00A0;then
&#x00A0;<br />c&#x00A0;Add&#x00A0;this&#x00A0;to&#x00A0;AllSources.inc
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;allterms&#x00A0;=&#x00A0;allterms&#x00A0;+&#x00A0;1d0
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;end&#x00A0;if
</div>
<!--l. 3928--><p class="nopar" >
<!--l. 3930--><p class="noindent" >Any Fortran thorn routines which include source code must include the declaration <span 
class="cmtt-10">DECLARE</span><span 
class="cmtt-10">_CCTK</span><span 
class="cmtt-10">_FUNCTIONS</span>.
<!--l. 3935--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.9.3   </span> <a 
 id="x13-133000C1.9.3"></a>Memory Tracing</h4>
<!--l. 3938--><p class="noindent" >Cactus provides a mechanism for overriding the standard C memory allocation routines (<span 
class="cmtt-10">malloc, free, </span>&#x2026;) with
Cactus specific routines that track the amount of memory allocated, and from where, the allocation call was
made. This information can be accessed by the user to provide an understanding of the memory consumption
between two instances, and to track down possible memory leaks. This feature is available in C
only.
<!--l. 3946--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-134000C1.9.3"></a>Activating Memory Tracing</h5>
<!--l. 3949--><p class="noindent" >Memory tracing has to be activated at configure time. The standard <span 
class="cmtt-10">malloc </span>statements are overridden with
macros (<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_MALLOC</span>). To activate memory tracing use either
<!--l. 3953--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">DEBUG=all</span>         </dt><dd 
class="list">
                  <!--l. 3954--><p class="noindent" >Enables all debug options (compiler debug flags, redefines <span 
class="cmtt-10">malloc</span>)
                  </dd><dt class="list">
<span 
class="cmtt-10">DEBUG=memory</span>      </dt><dd 
class="list">
                  <!--l. 3956--><p class="noindent" >Redefine <span 
class="cmtt-10">malloc </span>only.</dd></dl>
<!--l. 3959--><p class="noindent" >The <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_MALLOC </span>statements can also be used directly in the C code. But by employing them this way, only a
fraction of the total memory consumption is traced. Also, they cannot be turned off at configure time. For
example:
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-90">
machine&#x003E;&#x00A0;gmake&#x00A0;bigbuild&#x00A0;DEBUG=yes
&#x00A0;<br />
&#x00A0;<br />machine&#x003E;&#x00A0;gmake&#x00A0;bigbuild-config&#x00A0;DEBUG=memory
</div>
<!--l. 3967--><p class="nopar" > The new configuration <span 
class="cmtt-10">bigbuild </span>is configured with all debugging features turned on. The already existing
configuration <span 
class="cmtt-10">bigbuild </span>is reconfigured with memory tracing only.
<!--l. 3972--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-135000C1.9.3"></a>Using Memory Tracing</h5>
<!--l. 3975--><p class="noindent" >You can request Cactus to store the memory consumption at a certain instance in the program flow, and return
the difference in memory allocation some time later.
<!--l. 3979--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">int CCTK</span><span 
class="cmtt-10">_MemTicketRequest(void)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3980--><p class="noindent" >Request a ticket: save the current total memory to a database. Return an integer
                  (ticket). Use the ticket to calculate the difference in memory allocation between the
                  two instances in <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_MemTicketCash</span>.
                  </dd><dt class="list">
<span 
class="cmtt-10">long int CCTK</span><span 
class="cmtt-10">_MemTicketCash(int your</span><span 
class="cmtt-10">_ticket)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3986--><p class="noindent" >Cash in your ticket: return the memory difference between now and the time the
                  ticket was requested. Tickets can be cashed in several times. See example below.
                  This only tracks the real data memory, which is the same as in undebug mode. It
                  does not keep track of the internal allocations done to provide the database, the
                  motivation is that this is not allocated either if you compile undebugged.
                  </dd><dt class="list">
<span 
class="cmtt-10">int CCTK</span><span 
class="cmtt-10">_MemTicketDelete(int your</span><span 
class="cmtt-10">_ticket)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 3995--><p class="noindent" >Delete the memory ticket. The ticket ID will not be reused, since it&#8217;s incremented
                  with  every  ticket  request,  but  the  memory  of  the  memory  datastructure  is
                  deallocated.
                  </dd><dt class="list">
<span 
class="cmtt-10">unsigned long int CCTK</span><span 
class="cmtt-10">_TotalMemory(void)</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 4000--><p class="noindent" >Returns the total allocated memory (not including the tracing data structures).
                                                                                       
                                                                                       
                  </dd><dt class="list">
<span 
class="cmtt-10">void CCTK</span><span 
class="cmtt-10">_MemStat</span> </dt><dd 
class="list">
                  <!--l. 4004--><p class="noindent" >Prints  an  info  string,  stating  the  current,  past,  and  total  memory  (in  bytes)
                  allocation between two successive calls to this routine, as well as the difference.</dd></dl>
<!--l. 4009--><p class="noindent" >Sample C code demonstrating the ticket handling. Two tickets are requested during <span 
class="cmtt-10">malloc </span>operations. The
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_MALLOC </span>statement is used directly. They are cashed in, and the memory difference is printed. Ticket 1 is
cashed twice. The tickets are deleted at the end.
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-91">
&#x00A0;<br />int&#x00A0;ticket1;
&#x00A0;<br />int&#x00A0;ticket2;
&#x00A0;<br />
&#x00A0;<br />/*&#x00A0;store&#x00A0;current&#x00A0;memstate,&#x00A0;ticket:&#x00A0;t1*/
&#x00A0;<br />t1&#x00A0;=&#x00A0;CCTK_MemTicketRequest();
&#x00A0;<br />
&#x00A0;<br />/*&#x00A0;allocate&#x00A0;data&#x00A0;*/
&#x00A0;<br />hi&#x00A0;=&#x00A0;(int*)&#x00A0;CCTK_MALLOC(10*sizeof(int));
&#x00A0;<br />
&#x00A0;<br />/*&#x00A0;store&#x00A0;current&#x00A0;memstate,&#x00A0;ticket:&#x00A0;t2*/
&#x00A0;<br />t2&#x00A0;=&#x00A0;CCTK_MemTicketRequest();
&#x00A0;<br />
&#x00A0;<br />/*&#x00A0;cash&#x00A0;ticket&#x00A0;t1,&#x00A0;print&#x00A0;mem&#x00A0;difference&#x00A0;*/
&#x00A0;<br />printf("NOW1a:&#x00A0;%+d&#x00A0;\n",CCTK_MemTicketCash(t1));
&#x00A0;<br />
&#x00A0;<br />/*&#x00A0;allocte&#x00A0;some&#x00A0;more&#x00A0;data&#x00A0;*/
&#x00A0;<br />wo&#x00A0;=&#x00A0;(CCTK_REAL*)CCTK_MALLOC(10*sizeof(CCTK_REAL));
&#x00A0;<br />
&#x00A0;<br />/*&#x00A0;cash&#x00A0;ticket&#x00A0;t1&#x00A0;and&#x00A0;t2,&#x00A0;print&#x00A0;mem&#x00A0;difference&#x00A0;*/
&#x00A0;<br />printf("NOW1b:&#x00A0;%+d&#x00A0;\n",CCTK_MemTicketCash(t1));
&#x00A0;<br />printf("NOW2&#x00A0;:&#x00A0;%+d&#x00A0;\n",CCTK_MemTicketCash(t2));
&#x00A0;<br />
&#x00A0;<br />/*&#x00A0;delete&#x00A0;the&#x00A0;tickets&#x00A0;from&#x00A0;the&#x00A0;database&#x00A0;*/
&#x00A0;<br />CCTK_MemTicketDelete(t1);
&#x00A0;<br />CCTK_MemTicketDelete(t2);
&#x00A0;<br />
</div>
<!--l. 4042--><p class="nopar" >
<!--l. 4046--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.9.4   </span> <a 
 id="x13-136000C1.9.4"></a>Calls between Different Programming Languages</h4>
<!--l. 4049--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-137000C1.9.4"></a>Calling C Routines from Fortran</h5>
<!--l. 4052--><p class="noindent" >To make the following C routine,
<!--l. 4055--><p class="noindent" ><span 
class="cmtt-10">int &#x003C;routine name&#x003E;(&#x003C;argument list&#x003E;)</span><br 
class="newline" /><br 
class="newline" /><span 
class="cmtt-10">...</span><br 
class="newline" />
<!--l. 4061--><p class="noindent" >also callable from Fortran, a new routine must be added, which is declared using the <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_FCALL </span>and
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_FNAME </span>macros:
<!--l. 4065--><p class="noindent" ><span 
class="cmtt-10">void CCTK</span><span 
class="cmtt-10">_FCALL CCTK</span><span 
class="cmtt-10">_FNAME(&#x003C;routine name&#x003E;)(int *ierr, &#x003C;argument list&#x003E;)</span><br 
class="newline" /><span 
class="cmtt-10">&#x003C;rewrite routine code, or call C routine itself&#x003E;</span>
<!--l. 4069--><p class="noindent" >The convention used in Cactus, is that <span 
class="cmtt-10">&#x003C;routine name&#x003E; </span>be the same as any C routine name, and that this is
mixed-case. The macros change the case and number of underscores of the routine name to match that expected
by Fortran.
<!--l. 4074--><p class="noindent" >All arguments passed by Fortran to the routine (except strings) are pointers in C, e.g.&#x00A0;a call from
Fortran
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-92">
CCTK_INT&#x00A0;arg1
&#x00A0;<br />CCTK_REAL&#x00A0;arg2
&#x00A0;<br />CCTK_REAL&#x00A0;arg3(30,30,30)
&#x00A0;<br />
&#x00A0;<br />...
&#x00A0;<br />
&#x00A0;<br />call&#x00A0;MyCRoutine(arg1,arg2,arg3)
</div>
<!--l. 4085--><p class="nopar" >
<!--l. 4087--><p class="noindent" >should appear in C as
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-93">
void&#x00A0;CCTK_FCALL&#x00A0;CCTK_FNAME(MyCRoutine)(CCTK_INT&#x00A0;*arg1,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;CCTK_REAL&#x00A0;*arg2,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;CCTK_REAL&#x00A0;*arg3)
&#x00A0;<br />{
&#x00A0;<br />...
&#x00A0;<br />}
</div>
<!--l. 4096--><p class="nopar" >
<!--l. 4098--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-138000C1.9.4"></a>String Arguments from Fortran</h5>
<!--l. 4100--><p class="noindent" >Fortran passes string arguments in a special, compiler-dependent, way. To facilitate this, the CCTK provides a
set of macros to enable the translation to C strings. The macros are defined in <span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_FortranString.h</span>, which
should be included in your C file.
<!--l. 4106--><p class="noindent" >String arguments <span 
class="cmti-10">must always come last </span>in the argument list for these macros to be effective (some Fortran
compilers automatically migrate the strings to the end, so there is no portable workaround).
<!--l. 4110--><p class="noindent" >The macros to use depend upon the number of string arguments&#8211;we currently support up to three. The
macros are <span 
class="cmtt-10">&#x003C;ONE|TWO|THREE&#x003E;</span><span 
class="cmtt-10">_FORTSTRING</span><span 
class="cmtt-10">_ARG</span>. Corresponding to each of these are two macros
<span 
class="cmtt-10">&#x003C;ONE|TWO|THREE&#x003E;</span><span 
class="cmtt-10">_FORTSTRING</span><span 
class="cmtt-10">_CREATE </span>and <span 
class="cmtt-10">&#x003C;ONE|TWO|THREE&#x003E;</span><span 
class="cmtt-10">_FORTSTRING</span><span 
class="cmtt-10">_PTR</span>, which take one, two, or three
arguments depending on the number of strings. The latter set is only necessary if a string is to be modified. In
more detail:
<!--l. 4120--><p class="noindent" >
                  <dl class="list1"><dt class="list">
<span 
class="cmtt-10">&#x003C;ONE|TWO|THREE&#x003E;</span><span 
class="cmtt-10">_FORTSTRING</span><span 
class="cmtt-10">_ARG</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 4122--><p class="noindent" >Used in the argument list of the C routine to which the Fortran strings are passed.
                  </dd><dt class="list">
<span 
class="cmtt-10">&#x003C;ONE|TWO|THREE&#x003E;</span><span 
class="cmtt-10">_FORTSTRING</span><span 
class="cmtt-10">_CREATE</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 4126--><p class="noindent" >Used in the declaration section of the C routine to which the Fortran strings are
                  passed. These macros have one, two or three arguments which are the variable
                  names you choose to use for the strings in the C routine, created by null-terminating
                  the passed-in Fortran strings. The <span 
class="cmtt-10">CREATE </span>macros create new strings with the names
                  you provide, and thus should be treated as read-only and freed after use.
                  </dd><dt class="list">
<span 
class="cmtt-10">&#x003C;ONE|TWO|THREE&#x003E;</span><span 
class="cmtt-10">_FORTSTRING</span><span 
class="cmtt-10">_PTR</span><br 
class="newline" />                  </dt><dd 
class="list">
                                                                                       
                                                                                       
                  <!--l. 4135--><p class="noindent" >These macros, used in the declaration section of the C routine <span 
class="cmti-10">after </span>the <span 
class="cmtt-10">CREATE</span>
                  macro, should be used if you need to modify one of the passed-in strings. They
                  declare and define pointers to the passed-in strings.
                  </dd><dt class="list">
<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_strlen&#x003C;1|2|3&#x003E;</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 4141--><p class="noindent" >These  integer  variables,  automatically  defined  by  the  <span 
class="cmtt-10">CREATE </span>macro,  hold  the
                  lengths of the passed in Fortran strings.</dd></dl>
<!--l. 4147--><p class="noindent" >The use of the macros is probably best explained with examples. For read-only access to the strings,
only the first two macros are needed, the following example compares two strings passed in from
Fortran.
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-94">
#include&#x00A0;&#x003C;stdlib.h&#x003E;
&#x00A0;<br />#include&#x00A0;&#x003C;string.h&#x003E;
&#x00A0;<br />#include&#x00A0;&#x003C;cctk_FortranString.h&#x003E;
&#x00A0;<br />
&#x00A0;<br />int&#x00A0;CCTK_FCALL&#x00A0;CCTK_FNAME(CompareStrings)(TWO_FORTSTRING_ARG)
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;&#x00A0;int&#x00A0;retval;
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;/*&#x00A0;Allocate&#x00A0;and&#x00A0;create&#x00A0;C&#x00A0;strings&#x00A0;with&#x00A0;\0&#x00A0;at&#x00A0;end.&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;/*&#x00A0;This&#x00A0;makes&#x00A0;variable&#x00A0;declarations,&#x00A0;so&#x00A0;it&#x00A0;must&#x00A0;be&#x00A0;before
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;any&#x00A0;executable&#x00A0;statements.*/
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;TWO_FORTSTRING_CREATE(arg1,arg2)
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;/*&#x00A0;Do&#x00A0;some&#x00A0;work&#x00A0;with&#x00A0;the&#x00A0;strings&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;retval&#x00A0;=&#x00A0;strcmp(arg1,arg2);
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;/*&#x00A0;Important,&#x00A0;these&#x00A0;must&#x00A0;be&#x00A0;freed&#x00A0;after&#x00A0;use&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;free(arg1);
&#x00A0;<br />&#x00A0;&#x00A0;free(arg2);
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;return&#x00A0;retval;
&#x00A0;<br />}
&#x00A0;<br />
</div>
<!--l. 4176--><p class="nopar" >
<!--l. 4178--><p class="noindent" >Since the null terminated strings may be copies of the strings passed from Fortran, they should be treated as
read-only.
<!--l. 4181--><p class="noindent" >To change the data in a string passed from Fortran, you need to use the <span 
class="cmtt-10">FORTSTRING</span><span 
class="cmtt-10">_PTR </span>macros, which declare
and set up pointers to the strings passed from C. Note that this macro must be used <span 
class="cmti-10">after </span>the
<span 
class="cmtt-10">FORTSTRING</span><span 
class="cmtt-10">_CREATE </span>macro. For example, the following routine copies the contents of the second string to the
first string
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-95">
#include&#x00A0;&#x003C;stdlib.h&#x003E;
&#x00A0;<br />#include&#x00A0;&#x003C;string.h&#x003E;
&#x00A0;<br />#include&#x00A0;&#x003C;cctk_FortranString.h&#x003E;
&#x00A0;<br />
&#x00A0;<br />int&#x00A0;CCTK_FCALL&#x00A0;CCTK_FNAME(CopyStrings)(TWO_FORTSTRING_ARG)
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;&#x00A0;int&#x00A0;retval;
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;/*&#x00A0;Allocate&#x00A0;and&#x00A0;create&#x00A0;C&#x00A0;strings&#x00A0;with&#x00A0;\0&#x00A0;at&#x00A0;end.&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;/*&#x00A0;This&#x00A0;makes&#x00A0;variable&#x00A0;declarations,&#x00A0;so&#x00A0;it&#x00A0;must&#x00A0;be&#x00A0;before
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;any&#x00A0;executable&#x00A0;statements.&#x00A0;*/
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;TWO_FORTSTRING_CREATE(arg1,arg2)
&#x00A0;<br />&#x00A0;&#x00A0;TWO_FORTSTRING_PTR(farg1,farg2)
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;/*&#x00A0;Do&#x00A0;some&#x00A0;work&#x00A0;with&#x00A0;the&#x00A0;strings&#x00A0;*/
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;retval&#x00A0;=&#x00A0;strncpy(farg1,arg2,cctk_strlen1);
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;/*&#x00A0;Important,&#x00A0;these&#x00A0;must&#x00A0;be&#x00A0;freed&#x00A0;after&#x00A0;use&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;free(arg1);
&#x00A0;<br />&#x00A0;&#x00A0;free(arg2);
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;return&#x00A0;retval;
&#x00A0;<br />}
&#x00A0;<br />
</div>
<!--l. 4215--><p class="nopar" >
<!--l. 4217--><p class="noindent" >Note that in the example above, two new variables, pointers to the Fortran strings, were created. These are just
pointers and <span 
class="cmti-10">should not be freed</span>. The example also illustrates the automatically-created variables,
e.g.&#x00A0;<span 
class="cmtt-10">cctk</span><span 
class="cmtt-10">_strlen1</span>, which hold the sizes of original Fortran strings. When writing to a string its length should
never be exceeded.
<!--l. 4224--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-139000C1.9.4"></a>Calling Fortran Routines from C</h5>
<!--l. 4227--><p class="noindent" >To call a utility Fortran routine from C, use <div class="alltt">
<!--l. 4228--><p class="noindent" ><div class="obeylines-v">
                                                                                       
                                                                                       
<span 
class="cmtt-10">void</span><span 
class="cmtt-10">&#x00A0;CCTK_FCALL</span><span 
class="cmtt-10">&#x00A0;CCTK_FNAME(&#x003C;</span><span 
class="cmsltt-10">Fortran</span><span 
class="cmsltt-10">&#x00A0;routine</span><span 
class="cmsltt-10">&#x00A0;name</span><span 
class="cmtt-10">&#x003E;)(&#x003C;</span><span 
class="cmsltt-10">argument</span><span 
class="cmsltt-10">&#x00A0;list</span><span 
class="cmtt-10">&#x003E;)</span>
</div>
</div>
<!--l. 4232--><p class="noindent" >Note that Fortran expects all arguments (apart from strings) to be pointers, so any non-array data should be
passed by address.
<!--l. 4235--><p class="noindent" >Currently, we have no support for calling Fortran routines which expect strings from C. However, passing
routines is supported when you use function aliasing, see Section <a 
href="#x13-140000C1.9.5">C1.9.5<!--tex4ht:ref: sec:function_aliasing --></a>.
<!--l. 4240--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.9.5   </span> <a 
 id="x13-140000C1.9.5"></a>Function aliasing</h4>
<!--l. 4243--><p class="noindent" >Like calling functions in a different language, Cactus offers a mechanism for calling a function in a different
thorn where you don &#8217;t need to know which thorn is actually providing the function, nor what
language the function is provided in. The idea of <span 
class="cmti-10">function aliasing </span>is similar to that of thorns; the
routine that calls a function should not need to know anything about it, except that the function
exists.
<!--l. 4251--><p class="noindent" >Function aliasing is quite restrictive, because of the problems involved in inter-language calling, as seen in the
previous section. Function aliasing is also comparatively inefficient, and should not be used in a part of your
code where efficiency is important.
<!--l. 4257--><p class="noindent" >Function aliasing is language-neutral, however, the syntax is strongly based on C. In the future, the function
aliasing declarations may go into a new <span 
class="cmtt-10">functions.ccl </span>file, and will have a format more similar to that of
variable group and parameter declarations.
<!--l. 4263--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-141000C1.9.5"></a>Using an Aliased Function</h5>
<!--l. 4265--><p class="noindent" >To use an aliased function you must first declare it in your <span 
class="cmtt-10">interface.ccl </span>file. Declare the prototype as, for
example,
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-96">
CCTK_REAL&#x00A0;FUNCTION&#x00A0;SumStuff(CCTK_REAL&#x00A0;IN&#x00A0;x,&#x00A0;CCTK_REAL&#x00A0;IN&#x00A0;y)
</div>
<!--l. 4269--><p class="nopar" > and that this function will be either required in your thorn by
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-97">
REQUIRES&#x00A0;FUNCTION&#x00A0;SumStuff
</div>
<!--l. 4273--><p class="nopar" > or optionally used in your thorn by
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-98">
USES&#x00A0;FUNCTION&#x00A0;SumStuff
</div>
<!--l. 4277--><p class="nopar" > A prototype of this function will be available to any C routine that includes the <span 
class="cmtt-10">cctk.h </span>header file. In a Fortran
file, the declaration of the function will be included in the <span 
class="cmtt-10">DECLARE</span><span 
class="cmtt-10">_CCTK</span><span 
class="cmtt-10">_FUNCTIONS </span>macro, which is
available after the statement <span 
class="cmtt-10">#include "cctk</span><span 
class="cmtt-10">_Functions.h"</span>. The keywords <span 
class="cmtt-10">IN</span>, <span 
class="cmtt-10">OUT</span>, and <span 
class="cmtt-10">INOUT </span>work
in the same fashion as <span 
class="cmtt-10">INTENT </span>statements in Fortran 90. That is, the C prototype will expect an
argument with intent <span 
class="cmtt-10">IN </span>to be a value and one with intent <span 
class="cmtt-10">OUT </span>or <span 
class="cmtt-10">INOUT </span>to be a pointer. There also
exists the <span 
class="cmtt-10">ARRAY </span>keyword for passing arrays of any dimension. Functions which are required by
some thorn (which doesn&#8217;t provide it itself) are checked at startup to be provided by some other
thorn.
<!--l. 4293--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-142000C1.9.5"></a>Providing a Function</h5>
<!--l. 4295--><p class="noindent" >To provide an aliased function you must again add the prototype to your <span 
class="cmtt-10">interface.ccl </span>file. A statement
containing the name of the providing function and the language it is provided in, must also be given. For
example,
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-99">
CCTK_REAL&#x00A0;FUNCTION&#x00A0;SumStuff(CCTK_REAL&#x00A0;IN&#x00A0;x,&#x00A0;CCTK_REAL&#x00A0;IN&#x00A0;y)
&#x00A0;<br />PROVIDES&#x00A0;FUNCTION&#x00A0;SumStuff&#x00A0;WITH&#x00A0;AddItUp&#x00A0;LANGUAGE&#x00A0;C
</div>
<!--l. 4302--><p class="nopar" > The appropriate function must then be provided somewhere in this thorn. Multiple thorns providing the same
function can be compiled into the same configuration; however, only one providing thorn may be activated at
runtime, otherwise, an error message is printed and the run is aborted.
<!--l. 4308--><p class="noindent" >It is necessary to specify the language of the providing function; no default will be assumed.
<!--l. 4312--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-143000C1.9.5"></a>Conventions and Restrictions</h5>
<!--l. 4314--><p class="noindent" >Various restrictions are necessary to make function aliasing work. These are
     <ul class="itemize1">
     <li class="itemize">The return type of any function must be either <span 
class="cmtt-10">void </span>or one of the Cactus data types <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT </span>or
     <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL</span>. Standard types such as <span 
class="cmtt-10">int </span>are not allowed.
     </li>
     <li class="itemize">The type of an argument must be one of scalar types <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT, CCTK</span><span 
class="cmtt-10">_REAL, CCTK</span><span 
class="cmtt-10">_COMPLEX,</span>
     <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STRING, CCTK</span><span 
class="cmtt-10">_POINTER, CCTK</span><span 
class="cmtt-10">_FPOINTER</span>,  or  an  array  or  pointer  type  <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT ARRAY,</span>
     <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL ARRAY, CCTK</span><span 
class="cmtt-10">_COMPLEX ARRAY, CCTK</span><span 
class="cmtt-10">_POINTER ARRAY</span>.<span class="footnote-mark"><a 
href="#fn5x9" id="fn5x9-bk"><sup class="textsuperscript">5</sup></a></span><a 
 id="x13-143001f5"></a>
     The scalar types are assumed to be not modifiable. Any changes made to a scalar argument by a
     providing function may be silently lost, or may not; it is dependent on the language of the providing
     and calling function. If you wish to modify an argument, then it must have intent <span 
class="cmtt-10">OUT </span>or <span 
class="cmtt-10">INOUT</span>
     (and hence must be either a <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT</span>, a <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL</span>, or a <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX</span>, or an array of one of
     these types).
     </li>
     <li class="itemize">The name of both, the aliased and providing function, are restricted. They must follow the standard
     C semantics (start with a letter, contain only letters, numbers or underscores). Additionally, they
     must be mixed case (that is, contain at least one uppercase and one lowercase letter). The names
     of the aliased and providing functions must be distinct.
     </li>
     <li class="itemize">If an argument is a function pointer, then the syntax looks like
                                                                                       
                                                                                       
     <div class="verbatim" id="verbatim-100">
     CCTK_REAL&#x00A0;Integrate(CCTK_REAL&#x00A0;CCTK_FPOINTER&#x00A0;&#x00A0;func(CCTK_REAL&#x00A0;IN&#x00A0;x),&#x00A0;\
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;CCTK_REAL&#x00A0;IN&#x00A0;xmin,&#x00A0;CCTK_REAL&#x00A0;IN&#x00A0;xmax)
</div>
     <!--l. 4346--><p class="nopar" > It is assumed that the function pointer argument has the same language as the calling function. Function
     pointer arguments may not be nested.
     </li>
     <li class="itemize"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STRING </span>arguments follow the same conventions as in the previous section. That is, they must
     appear at the end of the argument list, there must be at most three, and a function with a
     <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STRING </span>argument can only be provided in C, not Fortran, although they may be called from
     either.</li></ul>
<!--l. 4358--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-144000C1.9.5"></a>Examples</h5>
     <ul class="itemize1">
     <li class="itemize">A C function is provided to add together two real numbers. The <span 
class="cmtt-10">interface.ccl </span>should read
                                                                                       
                                                                                       
     <div class="verbatim" id="verbatim-101">
     &#x00A0;&#x00A0;&#x00A0;&#x00A0;CCTK_REAL&#x00A0;FUNCTION&#x00A0;SumStuff(CCTK_REAL&#x00A0;IN&#x00A0;x,&#x00A0;CCTK_REAL&#x00A0;IN&#x00A0;y)
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;PROVIDES&#x00A0;FUNCTION&#x00A0;SumStuff&#x00A0;WITH&#x00A0;AddItUp&#x00A0;LANGUAGE&#x00A0;C
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;USES&#x00A0;FUNCTION&#x00A0;SumStuff
</div>
     <!--l. 4367--><p class="nopar" >
     </li>
     <li class="itemize">A Fortran function is provided to invert a real number. The <span 
class="cmtt-10">interface.ccl </span>should read
                                                                                       
                                                                                       
     <div class="verbatim" id="verbatim-102">
     &#x00A0;&#x00A0;&#x00A0;&#x00A0;SUBROUTINE&#x00A0;Invert(CCTK_REAL&#x00A0;INOUT&#x00A0;x)
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;PROVIDES&#x00A0;FUNCTION&#x00A0;Invert&#x00A0;WITH&#x00A0;FindInverse&#x00A0;LANGUAGE&#x00A0;Fortran
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;USES&#x00A0;FUNCTION&#x00A0;Invert
</div>
     <!--l. 4375--><p class="nopar" > Note that <span 
class="cmtt-10">SUBROUTINE </span>has the same meaning as <span 
class="cmtt-10">void FUNCTION</span>.
     </li>
     <li class="itemize">A Fortran function is provided to integrate any function over an interval. The <span 
class="cmtt-10">interface.ccl </span>should
     read
                                                                                       
                                                                                       
     <div class="verbatim" id="verbatim-103">
     &#x00A0;&#x00A0;&#x00A0;&#x00A0;CCTK_REAL&#x00A0;Integrate(CCTK_REAL&#x00A0;CCTK_FPOINTER&#x00A0;&#x00A0;func(CCTK_REAL&#x00A0;IN&#x00A0;x),&#x00A0;\
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;CCTK_REAL&#x00A0;IN&#x00A0;xmin,&#x00A0;CCTK_REAL&#x00A0;IN&#x00A0;xmax)
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;PROVIDES&#x00A0;FUNCTION&#x00A0;Integrate&#x00A0;WITH&#x00A0;SimpsonsRule&#x00A0;LANGUAGE&#x00A0;Fortran
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;USES&#x00A0;FUNCTION&#x00A0;Integrate
</div>
     <!--l. 4386--><p class="nopar" >
     </li></ul>
<!--l. 4390--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-145000C1.9.5"></a>Testing Aliased Functions</h5>
<!--l. 4392--><p class="noindent" >The calling thorn does not know if an aliased function is even provided by another thorn. Calling an aliased
function that has not been provided, will lead to a level 0 warning message, stopping the code. In order to check
if a function has been provided by some thorn, use the <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_IsFunctionAliased </span>function described in the
function reference section.
<!--l. 4401--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.9.6   </span> <a 
 id="x13-146000C1.9.6"></a>Naming Conventions</h4>
     <ul class="itemize1">
     <li class="itemize"> Thorn names must not start with the word &#8220;Cactus&#8221; (in any case).
     </li>
     <li class="itemize"> Arrangements will be ignored if their names start with a hash mark &#8216;<span 
class="cmtt-10">#</span>&#8217; or dot &#8216;<span 
class="cmtt-10">.</span>&#8217;, or end with a
     tilde &#8216;<span 
class="cmtt-10">~</span>&#8217;, <span 
class="cmtt-10">.bak </span>or <span 
class="cmtt-10">.BAK</span>.
     </li>
     <li class="itemize"> Thorns will be ignored if they are called doc or start with a hash mark &#8216;<span 
class="cmtt-10">#</span>&#8217; or dot &#8216;<span 
class="cmtt-10">.</span>&#8217;, or end with
     a tilde &#8216;<span 
class="cmtt-10">~</span>&#8217;, <span 
class="cmtt-10">.bak </span>or <span 
class="cmtt-10">.BAK</span>.
     </li>
     <li class="itemize"> Routine names have to be unique among all thorns.
     </li></ul>
                                                                                       
                                                                                       
<!--l. 4419--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.9.7   </span> <a 
 id="x13-147000C1.9.7"></a>General Naming Conventions</h4>
<!--l. 4421--><p class="noindent" >The following naming conventions are followed by the flesh and the supported Cactus arrangements. They are
not compulsory, but if followed, will allow for a homogeneous code.
     <ul class="itemize1">
     <li class="itemize">Parameters: lower case (except for acronyms) with words separated by an underscore. Examples:
     <span 
class="cmtt-10">my</span><span 
class="cmtt-10">_first</span><span 
class="cmtt-10">_parameter</span>, <span 
class="cmtt-10">solve</span><span 
class="cmtt-10">_PDE</span><span 
class="cmtt-10">_equation</span>.
     </li>
     <li class="itemize">Filenames and routine names: Prefixed by thorn name with an underscore, then capitalised words,
     with no spaces. Examples: <span 
class="cmtt-10">MyThorn</span><span 
class="cmtt-10">_StartUpRoutine</span>, <span 
class="cmtt-10">BestSolver</span><span 
class="cmtt-10">_InitialDataForPDE</span>.
     </li></ul>
<!--l. 4438--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.9.8   </span> <a 
 id="x13-148000C1.9.8"></a>Data Types and Sizes</h4>
<!--l. 4442--><p class="noindent" >Cactus knows about the following fixed size data types:
<div class="center" 
>
<!--l. 4444--><p class="noindent" >
<div class="tabular"> <table id="TBL-3" class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
><colgroup id="TBL-3-1g"><col 
id="TBL-3-1"></colgroup><colgroup id="TBL-3-2g"><col 
id="TBL-3-2"></colgroup><colgroup id="TBL-3-3g"><col 
id="TBL-3-3"></colgroup><colgroup id="TBL-3-4g"><col 
id="TBL-3-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-1-1"  
class="td11">Data Type       </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-1-2"  
class="td11">Size (bytes)</td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-1-3"  
class="td11">Variable Type                  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-1-4"  
class="td11">Fortran Equivalent</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-2-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_BYTE</span></span>     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-2-2"  
class="td11">1              </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-2-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_BYTE</span></span>     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-2-4"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">integer*1</span></span>       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-3-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT1</span></span>     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-3-2"  
class="td11">1              </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-3-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_INT1</span></span>     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-3-4"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">integer*1</span></span>       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-4-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT2</span></span>     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-4-2"  
class="td11">2              </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-4-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_INT2</span></span>     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-4-4"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">integer*2</span></span>       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-5-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT4</span></span>     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-5-2"  
class="td11">4              </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-5-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_INT4</span></span>     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-5-4"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">integer*4</span></span>       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-6-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-6-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT8</span></span>     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-6-2"  
class="td11">8              </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-6-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_INT8</span></span>     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-6-4"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">integer*8</span></span>       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-7-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-7-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL4</span></span>    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-7-2"  
class="td11">4              </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-7-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_REAL4</span></span>    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-7-4"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">real*4</span></span>          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-8-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-8-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL8</span></span>    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-8-2"  
class="td11">8              </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-8-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_REAL8</span></span>    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-8-4"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">real*8</span></span>          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-9-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-9-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL16</span></span>   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-9-2"  
class="td11">16            </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-9-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_REAL16</span></span>   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-9-4"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">real*16</span></span>         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-10-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-10-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX8</span></span> </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-10-2"  
class="td11">8              </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-10-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_COMPLEX8</span></span> </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-10-4"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">complex*8</span></span>       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-11-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-11-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX16</span></span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-11-2"  
class="td11">16            </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-11-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_COMPLEX16</span></span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-11-4"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">complex*16</span></span>      </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-12-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-12-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX32</span></span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-12-2"  
class="td11">32            </td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-12-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_COMPLEX32</span></span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-3-12-4"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">complex*32</span></span>      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-13-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-13-1"  
class="td11">              </td>
</tr></table></div></div>
<!--l. 4464--><p class="noindent" >The availability of these types, and the corresponding C data types, are platform-dependent. For each fixed-size
data type, there exists a corresponding preprocessor macro <span class="obeylines-h"><span 
class="cmtt-10">HAVE</span><span 
class="cmtt-10">_&#x003C;data type&#x003E;</span></span>, which should be used to check
whether the given CCTK data type is supported, e.g.&#x00A0;
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-104">
&#x00A0;&#x00A0;/*&#x00A0;declare&#x00A0;variable&#x00A0;with&#x00A0;extended-precision&#x00A0;complex&#x00A0;data&#x00A0;type&#x00A0;if&#x00A0;available,
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;otherwise,&#x00A0;with&#x00A0;default&#x00A0;CCTK&#x00A0;precision&#x00A0;*/
&#x00A0;<br />&#x00A0;&#x00A0;#ifdef&#x00A0;HAVE_CCTK_COMPLEX32
&#x00A0;<br />&#x00A0;&#x00A0;CCTK_COMPLEX32&#x00A0;var;
&#x00A0;<br />&#x00A0;&#x00A0;#else
&#x00A0;<br />&#x00A0;&#x00A0;CCTK_COMPLEX&#x00A0;&#x00A0;&#x00A0;var;
&#x00A0;<br />&#x00A0;&#x00A0;#endif
</div>
<!--l. 4477--><p class="nopar" >
<!--l. 4479--><p class="noindent" >In addition, Cactus provides three generic numeric data types which map onto the compilers&#8217; native data types
used to represent integer, real, and complex values. The size for these generic types can be chosen at
configuration time (see Section <a 
href="UsersGuidech6.html#x9-20000B2.1.1">B2.1.1<!--tex4ht:ref: subsec:Compilation-Available_Options --></a>). This is to allow the code to be run easily at different precisions. Note
that the effectiveness of running the code, at a lower or higher precision, depends crucially on all thorns being
used making consistent use of the these generic data types:
<div class="center" 
>
<!--l. 4487--><p class="noindent" >
<div class="tabular"> <table id="TBL-4" class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
><colgroup id="TBL-4-1g"><col 
id="TBL-4-1"></colgroup><colgroup id="TBL-4-2g"><col 
id="TBL-4-2"></colgroup><colgroup id="TBL-4-3g"><col 
id="TBL-4-3"></colgroup><colgroup id="TBL-4-4g"><col 
id="TBL-4-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-1-1"  
class="td11">Data Type    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-1-2"  
class="td11">Variable Type              </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-1-3"  
class="td11">Configuration Option </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-2-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT</span></span>    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-2-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_INT</span></span>    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-2-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">INTEGER</span><span 
class="cmtt-10">_PRECISION</span></span> </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-3-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL</span></span> </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-3-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_REAL</span></span> </td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-3-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">REAL</span><span 
class="cmtt-10">_PRECISION</span></span></td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-4-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX</span></span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-4-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_COMPLEX</span></span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-4-4-3"  
class="td11">Same as real precision</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-4-5-1"  
class="td11">            </td>
</tr></table></div></div>
<!--l. 4500--><p class="noindent" >These variable types must be used by thorn writers to declare variables in the thorn interface files, and may be
used to declare variables in the thorn routines. Note that variable declarations in thorns should obviously match
the definitions in the interface files where appropriate.
<!--l. 4506--><p class="noindent" >A set of macros, which are interpreted by the preprocessor at compile time, to signify which data size is being
used, are also provided:
<div class="center" 
>
<!--l. 4510--><p class="noindent" >
                                                                                       
                                                                                       
<div class="tabular"> <table id="TBL-5" class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
><colgroup id="TBL-5-1g"><col 
id="TBL-5-1"></colgroup><colgroup id="TBL-5-2g"><col 
id="TBL-5-2"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-5-1-1"  
class="td11">Data Type       </td><td  style="white-space:nowrap; text-align:left;" id="TBL-5-1-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">#define</span></span>                  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-5-2-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT1</span></span>     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-5-2-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT</span><span 
class="cmtt-10">_PRECISION</span><span 
class="cmtt-10">_1</span></span>     </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-5-3-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT2</span></span> </td><td  style="white-space:nowrap; text-align:left;" id="TBL-5-3-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT</span><span 
class="cmtt-10">_PRECISION</span><span 
class="cmtt-10">_2</span></span></td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-5-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-5-4-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT4</span></span>     </td><td  style="white-space:nowrap; text-align:left;" id="TBL-5-4-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT</span><span 
class="cmtt-10">_PRECISION</span><span 
class="cmtt-10">_4</span></span>     </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-5-5-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT8</span></span> </td><td  style="white-space:nowrap; text-align:left;" id="TBL-5-5-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT</span><span 
class="cmtt-10">_PRECISION</span><span 
class="cmtt-10">_8</span></span></td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-5-6-"><td  style="white-space:nowrap; text-align:left;" id="TBL-5-6-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL4</span></span>    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-5-6-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL</span><span 
class="cmtt-10">_PRECISION</span><span 
class="cmtt-10">_4</span></span>    </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-7-"><td  style="white-space:nowrap; text-align:left;" id="TBL-5-7-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL8</span></span> </td><td  style="white-space:nowrap; text-align:left;" id="TBL-5-7-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL</span><span 
class="cmtt-10">_PRECISION</span><span 
class="cmtt-10">_8</span></span></td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-5-8-"><td  style="white-space:nowrap; text-align:left;" id="TBL-5-8-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL16</span></span>   </td><td  style="white-space:nowrap; text-align:left;" id="TBL-5-8-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_REAL</span><span 
class="cmtt-10">_PRECISION</span><span 
class="cmtt-10">_16</span></span>   </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-5-9-"><td  style="white-space:nowrap; text-align:left;" id="TBL-5-9-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX8</span></span> </td><td  style="white-space:nowrap; text-align:left;" id="TBL-5-9-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX</span><span 
class="cmtt-10">_PRECISION</span><span 
class="cmtt-10">_8</span></span> </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-5-10-"><td  style="white-space:nowrap; text-align:left;" id="TBL-5-10-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX16</span></span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-5-10-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX</span><span 
class="cmtt-10">_PRECISION</span><span 
class="cmtt-10">_16</span></span></td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-5-11-"><td  style="white-space:nowrap; text-align:left;" id="TBL-5-11-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX32</span></span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-5-11-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_COMPLEX</span><span 
class="cmtt-10">_PRECISION</span><span 
class="cmtt-10">_32</span></span></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-12-"><td  style="white-space:nowrap; text-align:left;" id="TBL-5-12-1"  
class="td11">              </td>
</tr></table></div></div>
<!--l. 4529--><p class="noindent" >Cactus also provides generic data and function pointers, which can be used from either C or Fortran:
<div class="center" 
>
<!--l. 4532--><p class="noindent" >
<div class="tabular"> <table id="TBL-6" class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
><colgroup id="TBL-6-1g"><col 
id="TBL-6-1"></colgroup><colgroup id="TBL-6-2g"><col 
id="TBL-6-2"></colgroup><colgroup id="TBL-6-3g"><col 
id="TBL-6-3"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-6-1-1"  
class="td11">Data Type                  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-6-1-2"  
class="td11">Variable Type                             </td><td  style="white-space:nowrap; text-align:left;" id="TBL-6-1-3"  
class="td11">C equivalent               </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-6-2-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_POINTER</span></span>         </td><td  style="white-space:nowrap; text-align:left;" id="TBL-6-2-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_POINTER</span></span>         </td><td  style="white-space:nowrap; text-align:left;" id="TBL-6-2-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">void *data</span><span 
class="cmtt-10">_ptr</span></span>      </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-6-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-6-3-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_POINTER</span><span 
class="cmtt-10">_TO</span><span 
class="cmtt-10">_CONST</span></span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-6-3-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_POINTER</span><span 
class="cmtt-10">_TO</span><span 
class="cmtt-10">_CONST</span></span></td><td  style="white-space:nowrap; text-align:left;" id="TBL-6-3-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">const void *data</span><span 
class="cmtt-10">_ptr</span></span></td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-6-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-6-4-1"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_FPOINTER</span></span>        </td><td  style="white-space:nowrap; text-align:left;" id="TBL-6-4-2"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_VARIABLE</span><span 
class="cmtt-10">_FPOINTER</span></span>        </td><td  style="white-space:nowrap; text-align:left;" id="TBL-6-4-3"  
class="td11"><span class="obeylines-h"><span 
class="cmtt-10">void (*fn</span><span 
class="cmtt-10">_ptr)(void)</span></span></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-6-5-1"  
class="td11">                     </td>
</tr></table></div></div>
<!--l. 4555--><p class="noindent" >
<h5 class="subsubsectionHead"><a 
 id="x13-149000C1.9.8"></a>Fortran Thorn Writers</h5>
<!--l. 4557--><p class="noindent" >Cactus provides the data types <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_POINTER </span>and <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_POINTER</span><span 
class="cmtt-10">_TO</span><span 
class="cmtt-10">_CONST </span>for use in Fortran code to declare a
pointer passed from C. For example, the variable <span 
class="cmtt-10">cctkGH </span>is of the type <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_POINTER</span>. The data type
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_STRING </span>is, in Fortran, also an opaque type; it corresponds to a C pointer, and one has to use the function
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_FortranString </span>to convert it to a Fortran string, or the <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_Equals </span>to compare it to a Fortran
String.
<!--l. 4566--><p class="noindent" >Since the data types, <span 
class="cmtt-10">integer </span>in Fortran and <span 
class="cmtt-10">int </span>in C, may be
different<span class="footnote-mark"><a 
href="#fn6x9" id="fn6x9-bk"><sup class="textsuperscript">6</sup></a></span><a 
 id="x13-149001f6"></a>,
many routines that can be called from both, C and Fortran, take arguments of the type <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT</span>. This type can
be different from the type <span 
class="cmtt-10">integer</span>. Fortran does not convert routine arguments automatically, and it is,
therefore, necessary to pay attention to the exact argument types that a routine expects, and to convert between
<span 
class="cmtt-10">integer </span>and <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT</span>, accordingly. Currently, most flesh functions take <span 
class="cmtt-10">integer </span>arguments, while all aliased
functions take <span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT </span>arguments.
<!--l. 4578--><p class="noindent" >
     <div class="quote">
     <!--l. 4579--><p class="noindent" >NOTE:  If  you  make  errors  in  passing  Fortran  arguments,  and  if  there  are  no  interfaces
     (&#8220;prototypes&#8221;) available for the routines that are called, then the compiler cannot detect these
     errors. Be careful, when you write Fortran code yourself, consider placing routines in modules,
     which implicitly define interfaces for all contained routines.</div>
                                                                                       
                                                                                       
<!--l. 4587--><p class="noindent" >There are two convenient ways to convert between these types. An easy way, is to define parameters or to declare
variables of the desired type, assign a value to these parameters or variables, and then pass the parameter or
value. This makes for very readable code, since the name of the parameter or variable serves as additional
documentation:
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-105">
CCTK_INT,&#x00A0;parameter&#x00A0;:&#x00A0;jtwo&#x00A0;=&#x00A0;2
&#x00A0;<br />integer&#x00A0;&#x00A0;::&#x00A0;vindex_gxx,&#x00A0;vindex_kxx
&#x00A0;<br />CCTK_INT&#x00A0;::&#x00A0;syncvars(jtwo)
&#x00A0;<br />
&#x00A0;<br />call&#x00A0;CCTK_VarIndex&#x00A0;(vindex_gxx,&#x00A0;"ADMBase::gxx")
&#x00A0;<br />call&#x00A0;CCTK_VarIndex&#x00A0;(vindex_kxx,&#x00A0;"ADMBase::kxx")
&#x00A0;<br />
&#x00A0;<br />syncvars(1)&#x00A0;=&#x00A0;vindex_gxx
&#x00A0;<br />syncvars(2)&#x00A0;=&#x00A0;vindex_kxx
&#x00A0;<br />call&#x00A0;CCTK_SyncGroupsI&#x00A0;(cctkGH,&#x00A0;jtwo,&#x00A0;syncvars)
</div>
<!--l. 4604--><p class="nopar" >
<!--l. 4606--><p class="noindent" >(You have probably seen the strange Fortran convention, where people introduce constants named <span 
class="cmtt-10">zero </span>or
<span 
class="cmtt-10">two</span>&#8212;it is a convenient way to make sure that the constant has the correct type.)
<!--l. 4610--><p class="noindent" >Another possibility are explicit type conversions. They can rather easily be added to existing code:
                                                                                       
                                                                                       
<div class="verbatim" id="verbatim-106">
!&#x00A0;Boilerplate&#x00A0;code&#x00A0;to&#x00A0;determine&#x00A0;type&#x00A0;kinds
&#x00A0;<br />integer,&#x00A0;&#x00A0;parameter&#x00A0;::&#x00A0;izero&#x00A0;=&#x00A0;0&#x00A0;&#x00A0;&#x00A0;!&#x00A0;A&#x00A0;dummy&#x00A0;variable&#x00A0;of&#x00A0;type&#x00A0;integer
&#x00A0;<br />CCTK_INT,&#x00A0;parameter&#x00A0;::&#x00A0;jzero&#x00A0;=&#x00A0;0&#x00A0;&#x00A0;&#x00A0;!&#x00A0;A&#x00A0;dummy&#x00A0;variable&#x00A0;of&#x00A0;type&#x00A0;CCTK_ITN
&#x00A0;<br />integer,&#x00A0;&#x00A0;parameter&#x00A0;::&#x00A0;ik&#x00A0;=&#x00A0;kind&#x00A0;(izero)&#x00A0;&#x00A0;&#x00A0;!&#x00A0;The&#x00A0;kind&#x00A0;of&#x00A0;"integer"
&#x00A0;<br />integer,&#x00A0;&#x00A0;parameter&#x00A0;::&#x00A0;jk&#x00A0;=&#x00A0;kind&#x00A0;(jzero)&#x00A0;&#x00A0;&#x00A0;!&#x00A0;The&#x00A0;kind&#x00A0;of&#x00A0;"CCTK_INT"
&#x00A0;<br />
&#x00A0;<br />integer&#x00A0;::&#x00A0;syncvars(2)
&#x00A0;<br />
&#x00A0;<br />call&#x00A0;CCTK_VarIndex&#x00A0;(syncvars(1),&#x00A0;"ADMBase::gxx")
&#x00A0;<br />call&#x00A0;CCTK_VarIndex&#x00A0;(syncvars(2),&#x00A0;"ADMBase::kxx")
&#x00A0;<br />
&#x00A0;<br />call&#x00A0;CCTK_SyncGroupsI&#x00A0;(cctkGH,&#x00A0;int(2,jk),&#x00A0;int(syncvars,jk))
</div>
<!--l. 4626--><p class="nopar" >
<!--l. 4628--><p class="noindent" >Fortran distinguishes between different integer <span 
class="cmti-10">kinds</span>. These kinds are what is different between <span 
class="cmtt-10">integer </span>and
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT</span>. The expression <span 
class="cmtt-10">int(EXPR,KIND) </span>converts <span 
class="cmtt-10">EXPR </span>to an integer of kind <span 
class="cmtt-10">KIND</span>. Above, we use the
convention that the prefix <span 
class="cmtt-10">i </span>denotes things having to do with <span 
class="cmtt-10">integer</span>, and the prefix <span 
class="cmtt-10">j </span>denotes
<span 
class="cmtt-10">CCTK</span><span 
class="cmtt-10">_INT</span>.
<!--l. 4636--><p class="noindent" >Note that we declare the array <span 
class="cmtt-10">syncvars </span>with the type that is necessary to set its values. Type conversions are
only possible if variables are read, not when they are written to.
<!--l. 4644--><p class="noindent" >
<h3 class="sectionHead"><span class="titlemark">C1.10   </span> <a 
 id="x13-150000C1.10"></a>Telling the Make system What to Do</h3>
<!--l. 4648--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.10.1   </span> <a 
 id="x13-151000C1.10.1"></a>Basic Recipe</h4>
<!--l. 4652--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.10.2   </span> <a 
 id="x13-152000C1.10.2"></a>Make Concepts</h4>
                                                                                       
                                                                                       
<!--l. 4656--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.10.3   </span> <a 
 id="x13-153000C1.10.3"></a>The Four Files</h4>
<!--l. 4660--><p class="noindent" >
<h4 class="subsectionHead"><span class="titlemark">C1.10.4   </span> <a 
 id="x13-154000C1.10.4"></a>How your code is built</h4>
                                                                                       
                                                                                       
                                                                                       
                                                                                       
                                                                                       
                                                                                       
<div class="footnotes"><!--l. 355--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn1x9-bk" id="fn1x9"><sup class="textsuperscript">1</sup></a></span><span 
class="cmr-8">The beginning brace (</span><span 
class="cmsy-8">{</span><span 
class="cmr-8">) must sit on a line by itself; the ending brace (</span><span 
class="cmsy-8">}</span><span 
class="cmr-8">) must be preceded by a carriage return.</span>
<!--l. 3280--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn2x9-bk" id="fn2x9"><sup class="textsuperscript">2</sup></a></span><span 
class="cmr-8">As discussed in Section</span><span 
class="cmr-8">&#x00A0;</span><a 
href="UsersGuidech7.html#x10-36000B3.1"><span 
class="cmr-8">B3.1</span><!--tex4ht:ref: sec:command_line_options --></a> <span 
class="cmr-8">of this manual, the Cactus warning level threshold is set with the </span><span 
class="cmtt-8">-W </span><span 
class="cmr-8">or </span><span 
class="cmtt-8">-warning-level</span>
<span 
class="cmr-8">command-line option when running Cactus; see Section</span><span 
class="cmr-8">&#x00A0;</span><a 
href="UsersGuidech7.html#x10-36000B3.1"><span 
class="cmr-8">B3.1</span><!--tex4ht:ref: sec:command_line_options --></a><span 
class="cmr-8">.</span>
<!--l. 3333--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn3x9-bk" id="fn3x9"><sup class="textsuperscript">3</sup></a></span><span 
class="cmr-8">In calling </span><span 
class="cmtt-8">CCTK</span><span 
class="cmtt-8">_VWarn()</span><span 
class="cmr-8">, you need to provide this information yourself. Cactus provides the macro </span><span 
class="cmtt-8">CCTK</span><span 
class="cmtt-8">_THORNSTRING</span><span 
class="cmr-8">, which is</span>
<span 
class="cmr-8">the character-string name of the current thorn. In C, you can get the source file name and line number from the predefined</span>
<span 
class="cmr-8">preprocessor macros </span><span 
class="cmtt-8">_</span><span 
class="cmtt-8">_FILE</span><span 
class="cmtt-8">_</span><span 
class="cmtt-8">_ </span><span 
class="cmr-8">and </span><span 
class="cmtt-8">_</span><span 
class="cmtt-8">_LINE</span><span 
class="cmtt-8">_</span><span 
class="cmtt-8">_</span><span 
class="cmr-8">, respectively. In Fortran you&#8217;re out of luck. :(</span>
<!--l. 3380--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn4x9-bk" id="fn4x9"><sup class="textsuperscript">4</sup></a></span><span 
class="cmr-8">For the moment, these functions can only be used from C.</span>
<!--l. 4327--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn5x9-bk" id="fn5x9"><sup class="textsuperscript">5</sup></a></span><span 
class="cmr-8">Unfortunately, neither </span><span 
class="cmtt-8">CCTK</span><span 
class="cmtt-8">_FPOINTER ARRAY</span><span 
class="cmr-8">, nor </span><span 
class="cmtt-8">CCTK</span><span 
class="cmtt-8">_STRING ARRAY </span><span 
class="cmr-8">will work.</span>
<!--l. 4568--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn6x9-bk" id="fn6x9"><sup class="textsuperscript">6</sup></a></span><span 
class="cmr-8">This is only a theoretical possibility, in practice, they have to be the same type for Cactus to work at all.</span>         </div> <!--l. 17--><div class="crosslinks"><p class="noindent">[<a 
href="UsersGuidech10.html" >next</a>]
[<a 
href="UsersGuidech9.html" >front</a>] [<a 
href="UsersGuidepa3.html#UsersGuidech9.html" >up</a>] </p></div>
<!--l. 17--><p class="noindent" ><a 
 id="tailUsersGuidech9.html"></a>   
</body></html> 
